\documentclass[12pt]{article}

\usepackage{amsfonts}
\usepackage{amsmath,amsthm,amssymb}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{color}
\usepackage{tikz}
\usepackage{framed}
\usepackage{setspace}
\usepackage{mdframed}
\usepackage{float}
\usepackage[font={footnotesize},labelfont={bf}]{caption}
\usepackage{nicefrac}
\usepackage[gen]{eurosym}

%\usepackage{amsmath,amsthm,amscd,amssymb}
\usepackage[noBBpl,sc]{mathpazo}
\usepackage[papersize={7.2in, 10.0in}, left=.5in, right=.5in, top=.6in, bottom=.9in]{geometry}
\linespread{1.05}
\sloppy
\raggedbottom
\pagestyle{plain}

% these include amsmath and that can cause trouble in older docs.
\input{../helpers/cmrsum}
\input{../helpers/fix-underbrace.tex}

\usepackage[small]{titlesec}
\usepackage{cite}
\usepackage{microtype}

% hyperref last because otherwise some things go wrong.
\usepackage[colorlinks=true
,breaklinks=true
,urlcolor=blue
,anchorcolor=blue
,citecolor=blue
,filecolor=blue
,linkcolor=blue
,menucolor=blue
,linktocpage=true]{hyperref}
\hypersetup{
bookmarksopen=true,
bookmarksnumbered=true,
bookmarksopenlevel=10
}

% make sure there is enough TOC for reasonable pdf bookmarks.
\setcounter{tocdepth}{3}

%\usepackage[dotinlabels]{titletoc}
%\titlelabel{{\thetitle}.\quad}
%\input{../helpers/psu-plain-titles.tex}
%\input{../helpers/psu-sc-headers.tex}
%\input{../helpers/fix-revtex-12.tex}
%\DeclareSymbolFont{CMlargesymbols}{OMX}{cmex}{m}{n}
%\DeclareMathSymbol{\sum}{\mathop}{CMlargesymbols}{"50}
%\pdfbookmark[1]{Introduction}{Introduction}

\captionsetup[sub]{font={footnotesize},labelfont={bf},labelformat=empty}

\floatstyle{plaintop}
\newfloat{floatbox}{thp}{lob}
\floatname{floatbox}{Box}

\newcommand{\cmark}{\text{\ding{51}}}
\newcommand{\xmark}{\text{\ding{55}}}

\newtheoremstyle{mystyle}%                % Name
  {}%                                     % Space above
  {}%                                     % Space below
  {}%                                     % Body font
  {}%                                     % Indent amount
  {\itshape}%                            % Theorem head font
  {:}%                                    % Punctuation after theorem head
  { }%                                    % Space after theorem head, ' ', or \newline
  {}%                                     % Theorem head spec (can be left empty, meaning `normal')
\theoremstyle{mystyle}
\newtheorem{theorem}{Theorem}
\theoremstyle{definition}

\colorlet{shadecolor}{orange!15}
  
   \newmdenv[ %
 linewidth = 0pt, %
  %roundcorner = 10pt, %
  leftmargin = -5, %
  rightmargin = -5, %
  backgroundcolor = orange!15, % 
  %outerlinecolor = blue!70!black, %
  innertopmargin = \topskip, %
   innerbottommargin = \topskip, %
  splittopskip = \topskip, %
  footnoteinside = true, %
  ]{emphbox}
  
\newcommand{\oline}[2]{{\mkern#2mu\overline{\protect\vphantom{t}\mkern-#2mu\smash{#1}\mkern-#2mu}\mkern#2mu}}

\newcommand*{\cB}{\mathcal{B}}
\newcommand*{\cC}{\mathcal{C}}
\newcommand*{\cD}{\mathcal{D}}
\newcommand*{\cE}{\mathcal{E}}
\newcommand*{\cF}{\mathcal{F}}
\newcommand*{\cG}{\mathcal{G}}
\newcommand*{\cH}{\mathcal{H}}
\newcommand*{\cI}{\mathcal{I}}
\newcommand*{\cN}{\mathcal{N}}
\newcommand*{\cP}{\mathcal{P}}
\newcommand*{\cQ}{\mathcal{Q}}
\newcommand*{\cR}{\mathcal{R}}
\newcommand*{\cS}{\mathcal{S}}
\newcommand*{\cT}{\mathcal{T}}
\newcommand*{\cU}{\mathcal{U}}
\newcommand*{\cV}{\mathcal{V}}
\newcommand*{\cW}{\mathcal{W}}
\newcommand*{\cX}{\mathcal{X}}
\newcommand*{\cY}{\mathcal{Y}}
\newcommand*{\cZ}{\mathcal{Z}}

\newcommand*{\id}{\mathbf{1}}
\newcommand*{\tr}{\mathrm{tr}}
\newcommand*{\ket}[1]{{| #1 \rangle}}
\newcommand*{\bra}[1]{{\langle #1 |}}
\newcommand*{\spr}[2]{\langle #1 | #2 \rangle}
\newcommand{\proj}[1]{|#1\rangle\!\langle #1|}

\newcommand*{\Friend}{\mathrm{F}}
\newcommand*{\Friendone}{\mathrm{\bar{F}}}
\newcommand*{\Friendtwo}{\mathrm{F}}
\newcommand*{\Lab}{\mathrm{L}}
\newcommand*{\Labone}{\mathrm{\bar{L}}}
\newcommand*{\Labtwo}{\mathrm{L}}
\newcommand*{\Assistant}{\mathrm{\bar{W}}}
\newcommand*{\Wigner}{\mathrm{W}}
\newcommand*{\Agent}{\mathrm{A}}
\newcommand*{\Agentp}{\mathrm{A'}}
\newcommand*{\System}{\mathrm{S}}
\newcommand*{\Spin}{\mathrm{S}}
\newcommand*{\Coin}{\mathrm{R}}
\newcommand*{\wb}{\bar{w}}
\newcommand*{\Theory}{\mathrm{T}}
\newcommand*{\FriendoneS}{\bar{\mathrm{F}}}
\newcommand*{\FriendtwoS}{\mathrm{F}}
\newcommand*{\AssistantS}{\mathrm{\bar{W}}}
\newcommand*{\WignerS}{\mathrm{W}}
\newcommand*{\FriendoneEnv}{\mathrm{\bar{D}}}
\newcommand*{\FriendtwoEnv}{\mathrm{D}}
\newcommand*{\AssistantEnv}{\mathrm{\bar{E}}}
\newcommand*{\WignerEnv}{\mathrm{E}}
\newcommand*{\Qstate}{\mathrm{Q}}

\newcommand*{\spinup}{\ket{{\hspace{-0.1ex}\uparrow\hspace{-0.1ex}}}}
\newcommand*{\spinupb}{\bra{{\hspace{-0.1ex}\uparrow\hspace{-0.1ex}}}}
\newcommand*{\spindown}{\ket{{\hspace{-0.1ex}\downarrow\hspace{-0.1ex}}}}
\newcommand*{\spindownb}{\bra{{\hspace{-0.1ex}\downarrow\hspace{-0.1ex}}}}
\newcommand*{\spinright}{\ket{{\hspace{-0.2ex}\rightarrow\hspace{-0.4ex}}}}
\newcommand*{\spinrightb}{\bra{{\hspace{-0.3ex}\rightarrow\hspace{-0.3ex}}}}
\newcommand*{\spinleft}{\ket{{\hspace{-0.2ex}\leftarrow\hspace{-0.4ex}}}}
\newcommand*{\sminus}{{\textstyle - \frac{1}{2}}}
\newcommand*{\splus}{{\textstyle + \frac{1}{2}}}

\newcommand*{\QT}{\mathsf{(Q)}}
\newcommand*{\SW}{\mathsf{(S)}}
\newcommand*{\SelfCons}{\mathsf{(C)}}

\newcommand*{\ok}{\mathsf{ok}}
\newcommand*{\fail}{\mathsf{fail}}
\newcommand*{\okb}{\oline{\ok}{2.8}}
\newcommand*{\failb}{\oline{\fail}{5}}
\newcommand*{\head}{\mathsf{heads}}
\newcommand*{\tail}{\mathsf{tails}}
\newcommand*{\heads}{\bar{\mathsf{h}}}
\newcommand*{\tails}{\bar{\mathsf{t}}}

\newcommand*{\asn}[1]{``#1''}
\newcommand*{\asmn}[1]{``#1''}
\newcommand*{\sT}[1]{{\text{\emph{Statement} $#1$\emph{:} }}}
\newcommand*{\hT}[1]{{\text{\emph{History $#1$: }}}}

\newcommand*{\sTM}[1]{\begin{minipage}{14cm} \hangindent=8.6em  #1 \end{minipage}}

\begin{document}

\title{Quantum theory cannot consistently describe the use of itself}

\author{Daniela Frauchiger and Renato Renner\thanks{renner@ethz.ch} \\[1ex]
ETH Zurich}

\date{}


\maketitle

\begin{abstract}
Quantum theory provides an extremely accurate description of fundamental processes in physics. It thus seems likely that the theory is applicable beyond the, mostly microscopic, domain in which it has been tested experimentally.  Here we propose a Gedankenexperiment to investigate the question whether quantum theory can, in principle, have universal validity. The idea is that, if the answer was yes, it must be possible to employ quantum theory  to model complex systems that include agents who are themselves using quantum theory.  Analysing the experiment under this presumption, we find that one agent, upon observing a particular measurement outcome, must conclude that another agent has predicted the opposite outcome with certainty. The agents' conclusions, although all derived within quantum theory, are thus inconsistent.  This indicates that quantum theory cannot be extrapolated to complex systems, at least not in a straightforward manner.
\end{abstract}


\section{Introduction} \label{sec_intro}

Direct experimental tests of quantum theory are mostly restricted to microscopic domains. Nevertheless, quantum theory is  commonly regarded as being (almost) universally valid. It is not only used to describe fundamental processes in particle and solid state physics, but also, for instance, to explain the cosmic microwave background or the radiation of black holes. 

The presumption that the validity of quantum theory extends to larger scales has remarkable consequences, as noted already in 1935 by  Schr\"odinger~\cite{Schroedinger35}. His famous example consisted of a cat that is brought into a state corresponding to a superposition of two macroscopically entirely different states, one in which it is dead and one in which it is alive.  Schr\"odinger pointed out, however, that such macroscopic superposition states do not represent anything contradictory in themselves. 

This view was not shared by everyone.  In 1967, Wigner proposed an argument, known as the \emph{Wigner's friend paradox}, which should show that  ``quantum mechanics cannot have unlimited validity''~\cite{Wigner67}. His idea was to consider the views of two different observers  in an experiment analogous to the one depicted by Fig.~\ref{fig_WFStandard}. One observer, called agent~$\Friend$,\footnote{We will later take the term \emph{agent}  to mean a ``user'' of quantum theory. This may as well be a computer that gets observations (measurement outcomes) as input and outputs conclusions drawn from the theory.} measures the vertical polarisation~$z$ of a spin one-half particle~$\Spin$, such as a silver atom.  Upon observing the outcome, which is either  $z=\sminus$ or $z=\splus$, agent~$\Friend$ would thus say that  $\Spin$ is  in state
\begin{align} \label{eq_stateFriend}
  \psi_{\Spin} = \spindown_{\Spin} \qquad \text{or } \qquad \psi_{\Spin} = \spinup_{\Spin}   \ ,
\end{align} 
respectively.  The other observer, agent~$\Wigner$,   has no direct access to the outcome~$z$ observed by his friend~$\Friend$. Agent~$\Wigner$  could instead model agent $\Friend$'s lab  as a big quantum system, $\Lab \equiv \Spin \otimes \mathrm{D} \otimes \mathrm{F}$, which contains~$\Spin$ as a subsystem, another subsystem, $\mathrm{D}$, for the friend's measurement devices  and everything else connected to them, as well as a subsystem, $\mathrm{F}$, that includes the friend herself. Assume that, from agent $\Wigner$'s perspective, the lab $\Lab$ is initially in a pure state and that it remains isolated during agent~$\Friend$'s spin measurement experiment.\footnote{One may object that this assumption is unrealistic~\cite{Hepp72}. Crucially, however, the laws of quantum theory do not preclude that it be satisfied to arbitrarily good approximation~\cite{Bell75}.}  Translated to quantum mechanics, this assumption means that the  dependence of the final state of~$\Lab$ on the initial state of~$\Spin$ is described by a linear map  of the form 
\begin{align} \label{eq_Labstate}
   U_{\Spin \to \Lab} \, = \, \begin{cases}  \, \, \spindown_{\Spin} \, \,  \mapsto  \, \,  \ket{\sminus}_{\Lab}  \equiv \spindown_{\Spin} \otimes \ket{\text{\footnotesize ``$z \!\! = \! \sminus$''}}_{\mathrm{D}} \otimes \ket{\text{\footnotesize ``$\psi_{\Spin} \!\! = \! \spindown$''}}_{\mathrm{F}}  \\ 
   \, \, \spinup_{\Spin} \,  \, \mapsto \, \,  \ket{\splus}_{\Lab} \equiv \spinup_{\Spin} \otimes \ket{\text{\footnotesize ``$z \!\! = \! \splus$''}}_{\mathrm{D}} \otimes \ket{\text{\footnotesize ``$\psi_{\Spin} \!\!= \! \spinup$''}}_{\mathrm{F}} \ .   \end{cases} 
\end{align} 
Here $\ket{\text{\footnotesize ``$z \!\! = \! \sminus$''}}_{\mathrm{D}}$ and $\ket{\text{\footnotesize ``$z \!\! = \! \splus$''}}_{\mathrm{D}}$ denote states of~$\mathrm{D}$ depending on the measurement outcome~$z$ shown by the devices within the lab.  Analogously, $\ket{\text{\footnotesize ``$\psi_{\Spin} \!\! = \! \spindown$''}}_{\mathrm{F}}$ and~$\ket{\text{\footnotesize ``$\psi_{\Spin} \!\!= \! \spinup$''}}_{\mathrm{F}}$ are states of~$\Friend$, which we label by the friend's own knowledge, cf.~\eqref{eq_stateFriend}. Now, suppose that agent~$\Wigner$ knew that the spin was initialised to~$\spinright_{\Spin} \equiv \smash{\sqrt{\nicefrac{1}{2}}(\spindown_{\Spin} + \spinup_{\Spin})}$ before agent~$\Friend$ measured it. Then, by linearity, the final state that agent~$\Wigner$ would assign to $\Lab$ is 
\begin{align} \label{eq_stateWigner}
   \Psi_{\Lab} = \sqrt{\nicefrac{1}{2}} \bigl( \ket{\sminus}_{\Lab} \, + \,  \ket{\splus}_{\Lab}  \bigr) \ ,
 \end{align}
 i.e., a linear superposition of the two macroscopically distinct  states defined in~\eqref{eq_Labstate}. To compare this to agent $\Friend$'s view~\eqref{eq_stateFriend}, one must consider the restriction of~\eqref{eq_stateWigner} to the subsystem~$\Spin$. The latter is a maximally mixed state, and thus  obviously different from agent $\Friend$'s pure state assignment~\eqref{eq_stateFriend}. But, crucially, the difference can be explained by the two agents' distinct level of knowledge: Agent~$\Friend$ has observed~$z$ and hence knows the final spin direction, whereas agent~$\Wigner$ is ignorant about it~\cite{Fuchs10}.   Consequently, although the superposition state~\eqref{eq_stateWigner} may appear ``absurd''~\cite{Wigner67}, it does not contradict~\eqref{eq_stateFriend}. For this reason, the Wigner's friend paradox cannot be regarded as an argument that rules out quantum mechanics as a universally valid theory.
 
%\smallskip 
 
In this work we propose a Gedankenexperiment that extends Wigner's setup. It consists of agents who are using quantum theory to reason about other agents who are also using quantum theory (Section~\ref{sec_experiment}). Our main finding is that such a self-referential use of the theory yields contradictory claims (Section~\ref{sec_analysis}). This result can be phrased as a no-go theorem (Section~\ref{sec_nogo}). It asserts that three natural-sounding assumptions, $\QT$, $\SelfCons$, and $\SW$, cannot all be valid.  Assumption~$\QT$ captures the universal validity of quantum theory (or, more specifically, that an agent can be certain that a given proposition holds whenever the quantum-mechanical Born rule assigns probability~$1$ to it).  Assumption~$\SelfCons$ demands consistency, in the sense that the different agents' predictions are not contradictory. Finally, $\SW$ is the requirement that, from  the viewpoint of an agent who carries out a particular measurement, this measurement has one single outcome. The  theorem itself is neutral in the sense that it does not tell us which of these three assumptions is wrong. However, it implies that any specific interpretation of quantum theory, when applied to the Gedankenexperiment, will necessarily conflict with at least one of them (Sections~\ref{sec_QTviolation}, \ref{sec_Cviolation}, and~\ref{sec_Sviolation}). This gives a way to test and categorise interpretations of quantum theory.
%  (cf.\ Table~\ref{tab_interpretations} below). 
 
  \begin{figure}[t]
\centering
\includegraphics[trim= 0.4cm  8.4cm 0cm 8cm, clip=true, scale=0.2]{WFStandardR.pdf}
\caption{{\bf Wigner's and Deutsch's arguments.} Agent $\Friend$ measures the spin of a silver atom~$\Spin$ in the vertical direction, obtaining outcome~$z$. From $\Friend$'s perspective, $\Spin$ is then in one of the two pure states  $\psi_{\Spin}$ given in~\eqref{eq_stateFriend}.  Agent~$\Wigner$, who is outside of $\Friend$'s lab, may instead regard that lab, including agent~$\Friend$, as a big quantum system~$\Lab$ (orange box). Wigner argued that, having no access to~$z$, he would assign a superposition state $\Psi_{\Lab}$ of the form~\eqref{eq_stateWigner} to the lab~$\Lab$~\cite{Wigner67}. Deutsch later noted that agent~$\Wigner$ could in principle test this state assignment by applying a carefully designed measurement to $\Lab$~\cite{Deutsch85}. 
\label{fig_WFStandard}
}
\end{figure} 

\section{Results}

\subsection{The Gedankenexperiment} \label{sec_experiment}

In the setup considered by Wigner,  agent~$\Friend$ carries out her measurement of~$\Spin$ in a perfectly isolated lab~$\Labtwo$, so that the outcome $z$ remains unknown to anyone else  (Fig.~\ref{fig_WFStandard}). The basic idea underlying the Gedankenexperiment we present here is to make some of the information about~$z$ available to the outside | but without lifting the isolation of~$\Labtwo$. Roughly, this is achieved by letting the initial state of $\Spin$ depend on a random value, $r$, which is known to another agent outside of~$\Labtwo$.

The box below specifies the proposed Gedankenexperiment as a step-wise procedure. The steps are to be executed by different agents | four in total. Two of them, the ``friends'' $\Friendtwo$ and $\Friendone$, are located in  separate labs, denoted by~$\Labtwo$ and $\Labone$, respectively. The two other agents, $\Wigner$ and $\Assistant$, are at the outside, from where they can apply measurements to $\Labtwo$ and $\Labone$, as shown in Fig.~\ref{fig_EWF}. We assume that $\Labtwo$ and $\Labone$ are, from the viewpoint of the agents $\Wigner$ and $\Assistant$, initially in a pure state, and that they remain isolated during the experiment unless the  protocol explicitly prescribes a communication step or a measurement applied to them. Note that the experiment can be described within standard quantum-mechanical formalism, with each step  corresponding to a fixed evolution map acting on particular subsystems (cf.\ the circuit diagram in Appendix~\ref{app_diagram}).

{
\newcommand*{\lb}{\\[1.4ex]}

\begin{framed}

\noindent {{\bf Experimental Procedure}}

\vspace{1.1ex}

{\footnotesize

\noindent The steps are repeated in rounds $n = 0, 1, 2, \ldots $  until the halting condition in the last step is satisfied.  The numbers on the left indicate the timing of the steps, and we assume that each step takes at most one unit of time.  (For example, in round $n=0$, agent~$\Friendtwo$ starts her measurement of $\Spin$ at time $\text{0:10}$ and completes it before time $\text{0:11}$.) Definitions of the relevant state and measurement basis vectors are provided in Tables~\ref{tab_evolution} and~\ref{tab_measurementvectors}. 

\vspace{-0.6ex}

\begin{center}

\begin{tabular}{p{3.7em} p{0.86\textwidth}}
At $n$:00 & Agent $\Friendone$ invokes a randomness generator (based on the measurement of a quantum system~$\Coin$ in state~$\ket{\mathsf{init}}_{\Coin}$ as defined in Table~\ref{tab_evolution}) that outputs $r=\head$ or $r=\tail$ with probabilities $\nicefrac{1}{3}$ and $\nicefrac{2}{3}$, respectively.  She sets the spin~$\Spin$ of a particle to  $\spindown_{\Spin}$ if $r =\head$ and to $\spinright_\Spin \equiv \smash{\sqrt{\nicefrac{1}{2}}(\spindown_{\Spin} + \spinup_{\Spin})}$ if $r = \tail$, and  sends it to~$\Friendtwo$. 
\lb
At $n$:10 & Agent $\Friendtwo$ measures $\Spin$ w.r.t.\ the basis $\{\spindown_\Spin, \spinup_\Spin\}$, recording the outcome $z \in \{\sminus, \splus\}$.  
\lb
At $n$:20 &  Agent $\Assistant$ measures lab $\Labone$ w.r.t.\ a basis containing the vector  $\ket{\okb}_{\Labone}$ (defined in Table~\ref{tab_measurementvectors}). If the outcome associated to this vector occurs he announces $\wb=\okb$ and else $\wb=\failb$. 
\lb
 At $n$:30 &  Agent $\Wigner$ measures lab $\Labtwo$ w.r.t.\ a basis containing the vector $\ket{\ok}_{\Labtwo}$ (defined in Table~\ref{tab_measurementvectors}). If the outcome associated to this vector occurs he announces $w=\ok$  and else $w=\fail$. 
 \lb
At $n$:40 & If $\wb = \okb$ and $w = \ok$ then the experiment is halted. \\[-1ex]
\end{tabular}
\end{center}
}

\end{framed}
}

 
\begin{figure}[t]
\centering
\includegraphics[trim= 0cm  4.2cm 0cm 2.3cm, clip=true, scale=0.2]{WFDiagramRW.pdf}
\caption{{\bf Illustration of the Gedankenexperiment.} In each round~$n = 0, 1, 2, \ldots$ of the experiment, agent~$\Friendone$ tosses a coin and, depending on the outcome~$r$, polarises a spin particle~$\Spin$ in a particular direction.  Agent~$\Friendtwo$ then measures the vertical polarisation~$z$ of~$\Spin$. Later, agents~$\Assistant$ and~$\Wigner$ measure the entire labs~$\Labone$ and $\Labtwo$ (where the latter includes~$\Spin$) to obtain outcomes $\wb$ and $w$, respectively, which they announce publicly. We assume that all agents are aware of the entire experimental procedure, but that they are located at different places and therefore make different observations.  Starting from these observations, they may reason about observations made by others (blue bubbles).  Agent~$\Friendtwo$, for instance, observes~$z$ and then uses quantum theory to infer~$r$. \vspace{-1.4ex}
\label{fig_EWF}
}
\end{figure}

As indicated by the term \emph{Gedankenexperiment}, we do not claim that the experiment is technologically feasible, at least not in the form presented here. Like other thought experiments, its purpose is not to probe nature, but rather to scrutinise the consistency of our currently best available theories that describe nature | in this case quantum theory.\footnote{One may compare this to, say, the Gedankenexperiment of letting an observer cross the event horizon of a black hole. Although we do not have the technology to carry out this experiment, reasoning about it provides us with insights on relativity theory.}

{
\newcommand*{\lb}{\\[-2.2ex]}

\newcommand*{\tC}[1]{\begin{minipage}{1.5cm}  \footnotesize \begin{flushleft} #1 \end{flushleft} \end{minipage}}

\newcommand*{\oC}[1]{
 {\begin{minipage}{3cm}

  \footnotesize
\begin{align*}  
 #1
  \end{align*} \end{minipage}}
}

\newcommand*{\uC}[1]{ \footnotesize \begin{minipage}{5.28cm}  {\begin{gather*} #1 \end{gather*}} \end{minipage} }

\newcommand*{\lC}[1]{\footnotesize {\begin{minipage}{4cm} \begin{center} #1 \end{center} \end{minipage}}}


\begin{table}
\begin{center}
\noindent \begin{tabular}{c c c}
\toprule
\footnotesize
 time  interval & {\footnotesize time evolution of } & {\footnotesize time evolution of }   \\[-1ex] 
 \footnotesize within round~$n$
   &  \footnotesize  $\Friendone$'s lab $\Labone$
   & \footnotesize $\Friendtwo$'s lab $\Labtwo$
 \\[0.25ex]
  \midrule 
 \\[-4.2ex]
      
 \tC{before $\text{$n$:00}$}  & \uC{ \text{set $\Coin$ to}   \\[-1.4ex] \ket{\mathsf{init}}_\Coin = \sqrt{\nicefrac{1}{3}} \ket{\head}_\Coin + \sqrt{\nicefrac{2}{3}} \ket{\tail}_\Coin}    & \lC{[irrelevant]} 
\lb
 
\tC{from $\text{$n$:00}$ \\ to $\text{$n$:10}$} &\uC{U_{\Coin \to \Labone \Spin}^{\text{00} \to \text{10}} = \begin{cases}
  \ket{\head}_\Coin  \mapsto \ket{\heads}_{\Labone} \otimes  \spindown_{\Spin} \\  \ket{\tail}_\Coin  \mapsto \ket{\tails}_{\Labone} \otimes \spinright_{\Spin}  
  \end{cases}}
& \lC{[irrelevant]}
\lb
\tC{from $\text{$n$:10}$  \\ to $\text{$n$:20}$} 
& \uC{U_{\Labone \to \Labone}^{\text{10} \to \text{20}} = \id_{\Labone} } 
& \uC{U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}} = \begin{cases}
\spindown_{\Spin}  \mapsto \ket{\sminus}_{\Labtwo} \\  \spinup_{\Spin}  \mapsto \ket{\splus}_{\Labtwo}   
\end{cases}}
\lb
\tC{from $\text{$n$:20}$ \\ to $\text{$n$:30}$} 
& \lC{[irrelevant]} & \uC{U_{\Labtwo \to \Labtwo}^{\text{20} \to \text{30}} =
\id_{\Labtwo}}
  \\[-1.5ex]
  
  \bottomrule
  \vspace{-5ex}
   
\end{tabular}
\end{center}

\caption{{\bf Time evolution.} The two labs, $\Labone$ and $\Labtwo$, are assumed to be  isolated quantum systems.  Technically, this means that their time evolution is described by norm-preserving linear maps, i.e., isometries. The second protocol step, for instance, in which~$\Friendtwo$ measures~$\Spin$, induces an isometry $U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}}$ from $\Spin$ to~$\Labtwo$. The vectors $\ket{\sminus}_{\Labtwo}$ and $\ket{\splus}_{\Labtwo}$ are defined as the outputs of this isometry, i.e.,  as the states of lab~$\Labtwo$ at the end of the protocol step depending on whether the incoming spin was $\spindown_{\Spin}$ or $\spinup_{\Spin}$, respectively.  For concreteness, one may think of them as states of the form~\eqref{eq_Labstate} | although their structure is irrelevant for the argument. Analogously, $\ket{\heads}_{\Labone}$ and $\ket{\tails}_{\Labone}$ are defined as the states of lab~$\Labone$ at the end of the first protocol step, depending on whether $r=\head$ or $r=\tail$, respectively. 
\vspace{0.2ex} %Needed to get later pagebreak right. 
 \label{tab_evolution}}
\end{table}
}

Before proceeding to the analysis of the experiment, a few comments about its relation to earlier proposals are in order. In the case where $r=\tail$,  agent~$\Friendtwo$ receives $\Spin$ prepared in state~$\spinright_{\Spin}$. The first part of the experiment, prior to the measurements carried out by the agents $\Assistant$ and $\Wigner$, is then equivalent to Wigner's original experiment as described in the introduction~\cite{Wigner67}. Furthermore, adding to this the measurement of agent~$\Friendtwo$'s lab by agent~$\Wigner$, one retrieves an extension of Wigner's experiment proposed by Deutsch~\cite{Deutsch85} (Fig.~\ref{fig_WFStandard}). The particular procedure of how agent~$\Friendone$ prepares the spin~$\Spin$ in the first step of the experiment, as well as the choice of measurements,  is motivated by a construction due to Hardy~\cite{Hardy92,Hardy93}, known as \emph{Hardy's paradox}.  The setup considered here is also similar to a proposal by Brukner~\cite{Brukner2017}, who used a modification of Wigner's argument  to obtain a strengthening of Bell's theorem~\cite{Bell66} (cf.\ Section~\ref{sec_discussion}). 



\subsection{Analysis of the Gedankenexperiment} \label{sec_analysis}

We analyse the experiment from the viewpoints of the four agents, $\Friendone$, $\Friendtwo$, $\Assistant$, and $\Wigner$, whom we assume to use quantum theory for their reasoning. While the agents have access to different pieces of information (Fig.~\ref{fig_EWF}), they shall be aware of the entire experimental procedure as described in Section~\ref{sec_experiment}. One may thus think of the agents as computers that, in addition to carrying out the steps of the experimental procedure,  are programmed to draw conclusions according to a given set of rules. In the following, we specify these rules as assumptions, called~$\QT$, $\SelfCons$, and $\SW$.


 Assumption~$\QT$ asserts that any agent~$\Agent$ ``uses quantum theory.'' By this we mean that  $\Agent$ may predict the outcome of a measurement on any system $\System$ around him via the quantum-mechanical Born rule. For our purposes, it suffices to consider the special case where the state $\ket{\psi}_{\System}$ that $\Agent$ assigns to~$\System$ lies  in the image of only one of the measurement operators~$\pi_{x}^{t_0}$, say the one with $x=\xi$. In this case, the Born rule says that the outcome~$x$ equals~$\xi$ with certainty.
 
 \newcommand{\nsb}{\vspace{-1.4ex}}
 
\begin{emphbox}

  \noindent \textbf{Assumption $\QT$}   
  
   \smallskip
 
\noindent 
Suppose that agent~$\Agent$ has established that \nsb
\begin{align*}
\sTM{\sT{\Agent^{\mathrm{(i)}}} \asn{System $\System$ is in state $\ket{\psi}_{\System}$ at time~$t_0$.}} 
\end{align*}
 Suppose furthermore that agent~$\Agent$ knows that \nsb
\begin{align*}
\sTM{\sT{{\Agent}^{\mathrm{(ii)}}}  \asn{The value $x$ is obtained by a measurement of $\System$  w.r.t.\ the family $\{\pi^{t_0}_x\}_{x \in \cX}$ of Heisenberg operators relative to time $t_0$, which is completed at time~$t$.}}
\end{align*} 
If $\bra{\psi} \pi_{\xi}^{t_0} \ket{\psi} = 1$ for some~$\xi \in \cX$ then agent~$\Agent$ can conclude that \nsb
\begin{align*}
\sTM{\sT{{\Agent}^{\mathrm{(iii)}}} \asn{I am certain that $x=\xi$ at time $t$.}}
\end{align*} \vspace{-4ex}

\end{emphbox}

Crucially, $\System$ may be a large and complex system,  even one that itself contains agents. In fact, to start our analysis, we take the system~$\System$ to be  the  entire lab~$\Labtwo$, which in any round~$n$ of the experiment is measured  with respect to the  Heisenberg operators  $\pi^{\text{$n$:10}}_{w=\ok}$ and $\pi^{\text{$n$:10}}_{w=\fail}$ defined in Table~\ref{tab_measurementoperators}.  Suppose that agent~$\Friendone$ wants to predict the outcome~$w$ of this measurement. To this aim, she may start her reasoning with a statement that describes the corresponding measurement. 
\begin{align*}
  \sTM{\sT{\Friendone^{\text{$n$:00}}} \asn{The value $w$ is obtained by a measurement of $\Labtwo$  w.r.t.\ $\{\pi^{\text{$n$:10}}_{w=\ok},  \pi^{\text{$n$:10}}_{w=\fail}\}$, which is completed at time $\text{$n$:31}$.}}
\end{align*}
Here and in the following, we specify for each statement a time, denoted as a superscript, indicating when the agent could have inferred the statement.  Agent $\Friendone$'s statement~$\Friendone^{\text{$n$:00}}$ above does not depend on any observations, so the time $\text{$n$:00}$ we have assigned to it is rather arbitrary.  This is however different for the next statement, which is based on knowledge of the value~$r$.  Suppose that agent~$\Friendone$ got $r=\tail$ as the output of the random number generator in round~$n$. According to the experimental instructions, she will then prepare the spin~$\Spin$ in state $\spinright_{\Spin}$. Now, after completing the preparation, say at time $\text{$n$:01}$, she may make a second statement, taking into account that $\Spin$ remains unchanged until $\Friendtwo$ starts her measurement at time~$\text{$n$:10}$.
\begin{align*}
  \sTM{\sT{{\Friendone}^{\text{$n$:01}}}  \asn{The spin $\System$ is in state~$\spinright_{\Spin}$ at time $\text{$n$:10}$.}} 
\end{align*}
Agent~$\Friendone$ could conclude from this that the   later state of~$\Labtwo$, $U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}}  \spinright_{\Spin} =\smash{\sqrt{\nicefrac{1}{2}} \bigl(\ket{\sminus}_{\Labtwo} \! + \!  \ket{\splus}_{\Labtwo}\bigr)}$,  will be orthogonal to $\ket{\ok}_{\Labtwo}$. An equivalent way to express this is that the state $\spinright_{\Spin}$ has no overlap with the  Heisenberg measurement operator corresponding to outcome $w=\ok$, i.e., 
 \begin{align}
\spinrightb \pi_{w=\fail}^{\text{$n$:10}} \spinright 
= 1 - \spinrightb \pi^{\text{$n$:10}}_{w=\ok} \spinright 
= 1 \ . \label{eq_Foneargument}
\end{align}
The two statements~$\smash{{\Friendone}^{\text{$n$:00}}}$ and~$\smash{\Friendone^{\text{$n$:01}}}$, inserted into~$\QT$, thus imply that $w=\fail$. We may assume that agent~$\Friendone$ draws this conclusion at time $\text{$n$:02}$ and, for later use, put it down as statement $\smash{\Friendone^{\text{$n$:02}}}$  in Table~\ref{tab_statements}.  Similarly, agent $\Friendtwo$'s reasoning may be based upon a description of her spin measurement, which is defined by the operators $\smash{\pi^{\text{$n$:10}}_{z=-\frac{1}{2}}}$ and $\smash{\pi^{\text{$n$:10}}_{z=+\frac{1}{2}}}$ given in Table~\ref{tab_measurementoperators}.
 \begin{align*}
  \sTM{\sT{{\Friendtwo}^{\text{$n$:10}}}   \asn{The value $z$ is obtained by a measurement of $\Spin$ w.r.t.\ $\{\smash{\pi^{\text{$n$:10}}_{z=-\frac{1}{2}}}, \smash{\pi^{\text{$n$:10}}_{z=+\frac{1}{2}}}\}$, which is completed at time $\text{$n$:11}$.}}
 \end{align*}
  Suppose now that agent~$\Friendtwo$ observed $z= \splus$ in round~$n$. Since, by definition, 
  \begin{align}
   \spindownb \pi^{\text{$n$:10}}_{z=-\frac{1}{2}} \spindown = 1
 \end{align}
it follows from~$\QT$ that~$\Spin$ was not in state $\spindown$ and hence that the random value $r$ was not  $\head$. This is statement~$\smash{{\Friendtwo}^{\text{$n$:12}}}$ of Table~\ref{tab_statements}.    We proceed with agent~$\Assistant$, who may base his reasoning upon his knowledge of how the random number generator was initialised. 
\begin{align*}
\sTM{\sT{\Assistant^{\text{$n$:21}}}  \asn{System~$\Coin$ is in state  $\ket{\mathsf{init}}_\Coin$ at time~$\text{$n$:00}$.}}
\end{align*}
Consider the event that $\wb = \okb$ and $z = \sminus$, as well as its complement. The Heisenberg operators of the corresponding measurement are given in Table~\ref{tab_measurementoperators}.  It is straightforward to verify that $U_{\Coin \to \Labone \Spin}^{\text{00} \to \text{10}} \ket{\mathsf{init}}_{\Coin} = \smash{\sqrt{\nicefrac{1}{3}} \ket{\heads}_{\Labone} \otimes \spindown_{\Spin}  \! + \!  \sqrt{\nicefrac{2}{3}} \ket{\tails}_{\Labone} \otimes \spinright_{\Spin}}$ is orthogonal to $\ket{\okb}_{\Labone} \otimes \spindown_{\Spin}$, which implies that 
\begin{align}
    \bra{\mathsf{init}} \pi^{\text{$n$:00}}_{(\wb,z) \neq (\okb, -\frac{1}{2})} \ket{\mathsf{init}} 
   = 
  1-  \bra{\mathsf{init}}\pi^{\text{$n$:00}}_{(\wb,z) = (\okb, -\frac{1}{2})} \ket{\mathsf{init}}
  =  1 \ . \label{eq_Assistantargument}
\end{align}
Agent~$\Assistant$, who also uses $\QT$, can hence be certain that $(\wb, z)  \neq (\okb, \sminus)$. This implies that statement~$\smash{{\Assistant}^{\text{$n$:22}}}$ of Table~\ref{tab_statements} holds whenever $\wb = \okb$.  Furthermore, because agent~$\Assistant$ announces~$\wb$, agent~$\Wigner$ can be certain about $\Assistant$'s knowledge, which justifies statement~$\smash{{\Wigner}^{\text{$n$:26}}}$ of the table. We have thus established all statements in the third column of Table~\ref{tab_statements}.  

For later use we also note that a simple calculation yields
\begin{align} \label{eq_overlap}
  \bra{\mathsf{init}} \pi^{\text{$n$:00}}_{(\wb, w) = (\okb, \ok)} \ket{\mathsf{init}}  = \nicefrac{1}{12} \ 
\end{align}
where $\smash{\pi^{\text{$n$:00}}_{(\wb, w) = (\okb, \ok)}}$  is the Heisenberg operator belonging to the event that $\wb=\okb$ and $w = \ok$, as defined in Table~\ref{tab_measurementoperators}. Hence, according to quantum mechanics, agent~$\Wigner$ can be certain that the outcome $(\wb, w) = (\okb, \ok)$ occurs after finitely many rounds. This corresponds to the following statement (which can indeed be derived using~$\QT$, as shown in Appendix~\ref{app_statementW}).
\begin{align*}
\sTM{\sT{{\Wigner}^{\text{0:00}}}  \asn{I am certain that there exists a round $n$ in which the halting condition at time $\text{$n$:40}$ is satisfied.}}
\end{align*}

\begin{table}
\refstepcounter{table}{\label{tab_measurements}}
\addtocounter{table}{-1}
\begin{subtable}[t]{1\textwidth}
\centering

{
\newcommand*{\lb}{\\[-4.1ex]}
\newcommand*{\lbb}{\\[0.1ex]}
\newcommand*{\tCs}[1]{
\footnotesize \begin{minipage}{0.7cm}  \begin{center}  \mbox{#1 \vphantom{lg}} \end{center} \end{minipage}
}
\newcommand*{\tC}[2]{
\footnotesize \begin{minipage}{#1}  \begin{center} #2  \end{center} \end{minipage}
}
\newcommand*{\tCw}[1]{
\footnotesize \begin{minipage}{3.4cm}  \begin{center} #1 \end{center} \end{minipage}
}
\newcommand*{\nC}[1]{  \centering \footnotesize #1}
\newcommand*{\bC}[1]{
    \begin{minipage}{4cm}  \footnotesize  \vspace{0.6ex} {\begin{align*}  #1 \end{align*}} \end{minipage}}
\newcommand*{\oC}[1]{
 {\begin{minipage}{3cm}
  \footnotesize
\begin{align*}  
 #1
  \end{align*} \end{minipage}}
}

\noindent \begin{tabular}{c c c c c} 
\toprule \\[-2.4ex]
\tC{1cm}{\mbox{agent \vphantom{lg}}} &
\tC{1cm}{\mbox{value \vphantom{lg} }} &  
\tC{1.28cm}{measured \\ system} &
\tC{2.3cm}{measurement \\ completed at}  &
\tC{6.0cm}{relevant vectors of \\ measurement basis}  \\[1.4ex]
   \midrule \\[-5.2ex]
   
 \nC{$\Friendone$} &
  \nC{$r$} & 
 \nC{$\Coin$} & 
  \nC{$\text{$n$:01}$} &
 \bC{ \ket{\head}_{\Coin} \qquad \ket{\tail}_{\Coin} }
  \lb 
 \nC{$\Friendtwo$} &
 \nC{$z$} & 
  \nC{$\Spin$} &
\nC{$\text{$n$:11}$} & 
 \bC{\spindown_{\Spin}  \qquad \spinup_{\Spin} }
  \lb
  \nC{$\Assistant$} &
 \nC{$\wb$} &  
  \nC{$\Labone} $ &
\nC{$\text{$n$:21}$} & 
\bC{\ket{\okb}_{\Labone} = \smash{\sqrt{\nicefrac{1}{2}} \bigl(\ket{\heads}_{\Labone} -  \ket{\tails}_{\Labone}\bigr)}}
 \lb 
  \nC{$\Wigner$} &
   \nC{$w$} & 
\nC{$\Labtwo$} &
\nC{$\text{$n$:31}$} & 
\bC{\ket{\ok}_{\Labtwo} = \smash{\sqrt{\nicefrac{1}{2}} \bigl(\ket{\sminus}_{\Labtwo} \! - \!  \ket{\splus}_{\Labtwo}\bigr)} }
 \\[-2.2ex]
  
  \bottomrule
  
  \end{tabular}
}

\caption{{\bf Table~\thetable{}\thesubtable{}: Measurements carried out by the agents.}  Each of the four agents observes a value, defined as the outcome of a measurement on a particular system at a particular time. The measurement basis vectors  $\smash{\ket{\okb}_{\Labone}}$ and $\smash{\ket{\ok}_{\Labtwo}}$ shown in the last two rows are expressed in terms of states, such as $\smash{\ket{\sminus}_{\Labtwo}}$ and $\smash{\ket{\splus}_{\Labtwo}}$, which are defined in Table~\ref{tab_evolution}. \label{tab_measurementvectors}}
\end{subtable} 

\bigskip

\begin{subtable}[t]{1\textwidth}
\centering
{
\newcommand*{\lb}{\\[-4.1ex]}
\newcommand*{\lbb}{\\[0.1ex]}
\newcommand*{\tCs}[1]{
\footnotesize \begin{minipage}{0.7cm}  \begin{center}  \mbox{#1 \vphantom{lg}} \end{center} \end{minipage}
}
\newcommand*{\tC}[2]{
\footnotesize \begin{minipage}{#1}  \begin{center} #2  \end{center} \end{minipage}
}
\newcommand*{\tCw}[1]{
\footnotesize \begin{minipage}{3.4cm}  \begin{center} #1 \end{center} \end{minipage}
}
\newcommand*{\nC}[1]{  \centering \footnotesize #1}
\newcommand*{\bC}[1]{
    \begin{minipage}{4cm}  \footnotesize  \vspace{-1.1ex} {\begin{align*}  #1 \end{align*}} \vspace{-2.8ex} \end{minipage}}
\newcommand*{\oC}[1]{
 {\begin{minipage}{3cm}
  \footnotesize
\begin{align*}  
 #1
  \end{align*} \end{minipage}}
}
\noindent \begin{tabular}{c c c} 
\toprule \\[-3.1ex]
\tC{1cm}{\mbox{agent \vphantom{lg}}} &
\multicolumn{2}{c}{\tC{8cm}{measurement operators}} \\[-0.1ex]
   \midrule \\[-3.4ex]
   
 \nC{$\Friendone$} &
 \bC{
  \pi^{\text{$n$:10}}_{w=\ok} & = \bigl[( U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}})^{\dagger}  \ket{\ok}_{\Labtwo}\bigr]\bigl[\, \cdot \, \bigr]^{\dagger}} & 
  \bC{\pi^{\text{$n$:10}}_{w=\fail}  & = \id -  \pi^{\text{$n$:10}}_{w=\ok} }
 \lbb
 \nC{$\Friendtwo$} &
 \bC{
\pi^{\text{$n$:10}}_{z=-\frac{1}{2}} & = \spindown\!\spindownb_{\Spin}} & 
\bC{\pi^{\text{$n$:10}}_{z=+\frac{1}{2}} & = \id - \pi^{\text{$n$:10}}_{z=-\frac{1}{2}}  = \spinup\!\spinupb_{\Spin}}
  \lbb
  \nC{$\Assistant$} & 
  \bC{
   \pi^{\text{$n$:00}}_{(\wb,z) = (\okb, -\frac{1}{2})} & = \bigl[(U_{\Coin \to \Labone \Spin}^{\text{00} \to \text{10}} )^{\dagger}  \ket{\okb}_{\Labone}    \spindown_{\Spin}\bigr]\bigl[\, \cdot \, \bigr]^{\dagger}} & 
   \bC{
   \pi^{\text{$n$:00}}_{(\wb,z) \neq (\okb, -\frac{1}{2})} & = \id -   \pi^{\text{$n$:00}}_{(\wb,z) = (\okb, -\frac{1}{2})}
}
 \lbb
  \nC{$\Wigner$} &
   \bC{
 \pi^{\text{$n$:00}}_{(\wb, w) = (\okb, \ok)} 
   = \bigl[( U_{\Coin \to \Labone \Spin}^{\text{00} \to \text{10}} )^{\dagger}  (  U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}} )^{\dagger} \ket{\okb}_{\Labone} \ket{\ok}_{\Labtwo}\bigr]\bigl[\, \cdot \,\bigr]^{\dagger} } & {\footnotesize (see Appendix~\ref{app_statementW})}
 \\[0.8ex]
  
  \bottomrule



\end{tabular}
}
\caption{{\bf Table~\thetable{}\thesubtable{}: Measurement operators in the Heisenberg picture.} The measurements carried out by the individual agents are specified in terms of operators, each of which corresponds to a possible measurement outcome; cf.\ Assumption~$\QT$. They are given in the Heisenberg picture, referring to the system's state at a particular time, which is indicated in the superscript. The bracket $[\, \cdot \,]^{\dagger}$ stands for the adjoint of the preceding expression. \label{tab_measurementoperators} }
\end{subtable}
\end{table}

The agents may now obtain further statements by reasoning about how they would reason from the viewpoint of other agents, as illustrated by Fig.~\ref{fig_selfreference}. To enable such nested reasoning we need another assumption, Assumption~$\SelfCons$.\footnote{Assumption~$\SelfCons$ has some vague similarities with a transitivity relation. However, although the expression ``knows that'' indeed defines a binary relation, it is not transitive (for its domain and codomain are different sets).} It captures the idea that the theory used by the agents for their reasoning should be consistent, in the sense that they do not arrive at contradictory claims.

  \begin{figure}
\centering
\includegraphics[trim= 0.4cm  11.2cm 0.4cm 0.4cm, clip=true, scale=0.2]{SelfRefR.pdf}
\caption{{\bf Consistent reasoning as required by Assumption~$\SelfCons$.} If a theory~$\Theory$ (such as quantum theory) enables consistent reasoning~$\SelfCons$ then it must allow any agent $\Agent$ to promote the conclusions drawn by another agent $\Agentp$ to his own conclusions, provided that $\Agentp$ has the same initial knowledge about the experiment and reasons within the same theory~$\Theory$. A classical example of  such recursive reasoning is the muddy children puzzle (in which case~$\Theory$ is just standard logic; see~\cite{FHMV04} for a detailed account).  The idea of using a physical theory~$\Theory$ to describe agents who themselves use~$\Theory$ has also appeared in thermodynamics, notably in discussions around Maxwell's demon~\cite{Bennett82}.
\label{fig_selfreference}} 
\end{figure} 

\begin{emphbox}
  \noindent \textbf{Assumption $\SelfCons$} 
  
   \smallskip 
  
\noindent Suppose that agent~$\Agent$ has established that
\nsb
\begin{align*}
\sTM{\sT{{\Agent}^{\mathrm{(i)}}}  \asn{I am certain  that agent~$\Agentp$, upon reasoning within the same theory as the one I am using, is certain that $x=\xi$ at time $t$.} }
\end{align*}
 Then agent~$\Agent$ can conclude that \nsb
 \begin{align*}
\sTM{\sT{{\Agent}^{\mathrm{(ii)}}}  \asn{I am certain that $x=\xi$ at time $t$.}}
\end{align*}
\vspace{-4ex}
\end{emphbox}

Agent~$\Friendtwo$ may insert agent~$\Friendone$'s statement $\Friendone^{\text{$n$:02}}$ into $\Friendtwo^{\text{$n$:12}}$, obtaining statement $\Friendtwo^{\text{$n$:13}}$ of Table~\ref{tab_statements}. By virtue of Assumption~$\SelfCons$, she may then conclude  that statement  $\Friendtwo^{\text{$n$:14}}$ holds, too.
Similarly, $\Assistant$  may combine this latter statement with his statement $\Assistant^{\text{$n$:22}}$ to obtain
$\Assistant^{\text{$n$:23}}$.  He could then, again using~$\SelfCons$, conclude that statement $\Assistant^{\text{$n$:24}}$ holds.  Finally, agent~$\Wigner$ can insert this into his statement~$\Wigner^{\text{$n$:26}}$ to obtain statement $\Wigner^{\text{$n$:27}}$ and, again with~$\SelfCons$, statement $\Wigner^{\text{$n$:28}}$. This completes the derivation of all statements of Table~\ref{tab_statements}. 

For the last part of our analysis, we take again agent~$\Wigner$'s perspective. According to statement~$\Wigner^{\text{0:00}}$, the experiment has a final round~$n$ in which the halting condition will be satisfied, meaning in particular that agent~$\Assistant$ announces $\wb = \okb$. Agent~$\Wigner$ infers from this that statement~$\Wigner^{\text{$n$:28}}$ of Table~\ref{tab_statements} holds in that round, i.e., he is certain that he will observe $w = \fail$ at time $\text{$n$:31}$. However, in this final round, he will nevertheless observe $w=\ok$! We have thus reached a contradiction | unless agent~$\Wigner$ would accept that $w$ simultaneously admits multiple values. For our discussion below, it will be useful to introduce an explicit assumption, termed Assumption~$\SW$, which disallows this.

\begin{emphbox}

  \noindent \textbf{Assumption $\SW$} 
  
   \smallskip 
  
\noindent Suppose that agent~$\Agent$ has established that \nsb
\begin{align*}
\sTM{\sT{{\Agent}^{\mathrm{(i)}}} \asn{I am certain that $x=\xi$ at time $t$.} }
\end{align*}
Then agent~$\Agent$ must necessarily deny that \nsb
\begin{align*}
\sTM{\sT{{\Agent}^{\mathrm{(ii)}}} \asn{I am certain  that $x \neq \xi$ at time $t$.}}
\end{align*}
\vspace{-4ex}
\end{emphbox}

{
\newcommand*{\tC}[2]{
\footnotesize \begin{minipage}{#2}  \begin{center} #1 \end{center} \end{minipage}
}
\newcommand*{\sC}[1]{
{\begin{minipage}{3.299cm}
\vspace{2.6ex} 
\footnotesize #1 
\end{minipage}}
}

\newcommand*{\aC}[1]{
  {  \begin{minipage}{0.4cm} 
     \begin{center} 
     \footnotesize   #1 
    \end{center}
  \end{minipage}}
}

\newcommand*{\bC}[1]{
  {  \begin{minipage}{1.7cm} 
     \begin{center} 
     \vspace{1.8ex} 
     \footnotesize   #1 
    \end{center}
  \end{minipage}}
}

\newcommand*{\lb}{\\[-0.4ex]}

\begingroup
\setlength{\tabcolsep}{4pt}
 \begin{table}
 \begin{center}
\noindent 
\begin{tabular}{c c c c c}
\toprule
\tC{agent}{0.8cm}
& \tC{assumed \\ observation}{2.4cm}
& \tC{statement inferred via~$\QT$}{2.4cm}
& \tC{further implied statement}{2.4cm}
& \tC{statement inferred via~$\SelfCons$}{2.4cm}
\\[0.25ex] \midrule \\[-4.6ex]
\aC{$\Friendone$ }
& \bC{$r=\tail$  \\ at time $\text{$n$:01}$}
& \sC{$\sT{\smash{\Friendone}^{\text{$n$:02}}}$ \asmn{I am certain that $\Wigner$ will observe $w=\fail$ at time $\text{$n$:31}$.}} 
&
 \lb
 \aC{$\Friendtwo$}
 & \bC{$z=\splus$ \\ at time $\text{$n$:11}$}
&  \sC{$\sT{\smash{\Friendtwo}^{\text{$n$:12}}}$ \asmn{I am certain that $\Friendone$ knows that $r=\tail$ at time $\text{$n$:01}$.}}
& \sC{$\sT{\smash{\Friendtwo}^{\text{$n$:13}}}$ \asmn{I am certain that $\Friendone$ is certain that $\Wigner$ will observe $w = \fail$ at time $\text{$n$:31}$.}}
& \sC{$\sT{\smash{\Friendtwo}^{\text{$n$:14}}}$  \asmn{I am certain that $\Wigner$ will observe $w = \fail$ at time $\text{$n$:31}$.}}
\lb
\aC{$\Assistant$}
& \bC{$\wb = \okb$ \\  at time $\text{$n$:21}$}
&  \sC{$\sT{\smash{\Assistant}^{\text{$n$:22}}}$  \asmn{I am certain that $\Friendtwo$ knows that $z=\smash{\splus}$ at time $\text{$n$:11}$.}}
& \sC{$\sT{{\smash\Assistant}^{\text{$n$:23}}}$ \asmn{I am certain that $\Friendtwo$ is certain that $\Wigner$ will observe $w = \fail$ at time $\text{$n$:31}$.}}
& \sC{\sT{{\Assistant}^{\text{$n$:24}}}  \asmn{I am certain that $\Wigner$ will observe $w = \fail$ at time $\text{$n$:31}$.}}
\lb
\aC{$\Wigner$}
& \bC{announcement  \\ by agent~$\Assistant$ \\ that $\wb = \okb$ \\ at time $\text{$n$:21}$}
& \sC{$\sT{\smash{\Wigner^{\text{$n$:26}}}}$ \asmn{I am certain that $\Assistant$ knows that $\wb = \okb$ at time $\text{$n$:21}$.}}
& \sC{$\sT{\smash{\Wigner^{\text{$n$:27}}}}$ \asmn{I am certain that $\Assistant$ is  certain that I will observe $w = \fail$ at time $\text{$n$:31}$.}}
& \sC{$\sT{\smash{\Wigner^{\text{$n$:28}}}}$ \asmn{I am certain that I will observe $w = \fail$ at time $\text{$n$:31}$.}}
\\[4.7ex]
\bottomrule
\vspace{-5ex}
\end{tabular}
\end{center}
\caption{{\bf The agents' observations and conclusions.} The statements that the individual agents can derive from quantum theory depend on the information accessible to them (cf.\ Fig.~\ref{fig_EWF}).  Agent~$\Friendone$, for instance, if she observes~$r=\tail$, can use this information to infer the value~$w$, which will later be observed and announced by agent~$\Wigner$.      \label{tab_statements}}
\end{table}
\endgroup
}


\pagebreak[3]
 
\subsection{No-go theorem} \label{sec_nogo}

The conclusion of the above analysis may be phrased as a no-go theorem. 

\begin{emphbox}
  \noindent \textbf{Theorem.} 
 \noindent Any theory that satisfies assumptions~$\QT$, $\SelfCons$, and $\SW$ yields contradictory statements when applied to the Gedankenexperiment described in Section~\ref{sec_experiment}.
\end{emphbox}

To illustrate the theorem, we consider in the following different interpretations and modifications of quantum theory. The no-go theorem implies that any of them must violate either~$\QT$, $\SelfCons$, or $\SW$. This yields a natural categorisation as shown in Table~\ref{tab_interpretations} and discussed in the following subsections.  


\subsection{Theories that violate Assumption~$\QT$} \label{sec_QTviolation}

Assumption~$\QT$ corresponds to the quantum-mechanical Born rule. Since the assumption is concerned with the special case of probability-$1$ predictions only, it is largely independent of interpretational questions, such as the meaning of probabilities in general. However, the non-trivial aspect of~$\QT$ is that it regards the Born rule as a universal law. That is, it demands that an agent~$\Agent$ can apply the rule to arbitrary systems~$\System$ around her, including large ones that may contain other agents. The specifier ``around'' is crucial, though: Assumption~$\QT$ does not demand that agent $\Agent$ can describe herself as a quantum system. Such a requirement  would indeed be overly restrictive (see~\cite{DallaChiara77}) for it would immediately rule out  interpretations in the spirit of Copenhagen, according to which the observed quantum system and the observer must be distinct from each other~\cite{Heisenberg35,Bohr49}. 

{
\newcommand*{\lC}[1]{{\footnotesize #1}}
\begin{table}
\begin{center}
\begin{tabular}{p{5.5cm}ccc}
\toprule
 & $\QT$ & $\SelfCons$ & $\SW$ \\[0.1ex]
\midrule
\lC{Copenhagen interpretation} & $\checkmark$ & $\times$ & $\checkmark$ \\[-0.5ex]
\lC{HV theory applied to subsystems} & $\checkmark$ & $\times$ & $\checkmark$ \\[-0.5ex]
\lC{HV theory applied to entire universe} & $\times$ & $\checkmark$ & $\checkmark$  \\[-0.5ex]
\lC{Many-worlds interpretations} & ? & ? & $\times$ \\[-0.5ex]
\lC{Collapse theories} & $\times$ & $\checkmark$ & $\checkmark$ \\[-0.5ex]
\lC{Consistent histories} & $\checkmark$ & $\times$ & $\checkmark$ \\[-0.5ex]
\lC{QBism} & $\checkmark$ & $\times$ & $\checkmark$ \\[-0.5ex]
\lC{Relational quantum mechanics} & $\checkmark$ & $\times$ & $\checkmark$ \\[-0.5ex]
\lC{CSM approach} & $\times$ & $\checkmark$ & $\checkmark$ \\[-0.5ex]
\lC{ETH approach} & $\times$ & $\checkmark$ & $\checkmark$ \\[-0.1ex]
  \bottomrule
\end{tabular}
  \vspace{-2ex}
\end{center}
\caption{{\bf Interpretations of quantum theory.}  The proposed Gedankenexperiment can be employed to study the various interpretations of quantum theory. Our no-go theorem implies that each of them must violate at least one of the Assumptions~$\QT$, $\SelfCons$, and $\SW$ (indicated by~$\times$). For hidden variable (HV) theories,  it is relevant whether agents who are using the theory apply its laws  (e.g., the guiding equation in the case of Bohmian mechanics)  to subsystems around them or to the universe as a whole.\label{tab_interpretations}}

\end{table}
}

Assumption~$\QT$ is manifestly violated by theories that postulate a modification of  standard quantum mechanics, such as spontaneous~\cite{GhRiWe86,Gisin89,Pearle89, Tumulka06,Weinberg12} and gravity-induced~\cite{Karolyhazy66,Diosi89,Penrose96} collapse models (cf.\ \cite{Bassietal13} for a review).
These deviate from the standard theory already on microscopic scales, although the effects of the deviation typically only become noticeable in larger systems. 

In some approaches to quantum mechanics, it is simply postulated that large systems are ``classical'', but the physical mechanism that explains the absence of quantum features remains unspecified~\cite{LanLif13}. In the view described in~\cite{Hepp72}, for instance, the postulate says that measurement devices are infinite-dimensional systems whereas observables are finite. This ensures that coherent and incoherent superpositions in the state of a measurement device are indistinguishable. Similarly, according to the  \emph{ETH} approach~\cite{FroSch15}, the algebra of available observables is time-dependent and does not allow one to distinguish coherent from incoherent superpositions once a measurement has been completed. General measurements on systems that count themselves as measurement devices are thus ruled out.  Another example is the \emph{CSM} ontology~\cite{AufGra15}, according to which measurements must always be carried out in a ``context'', which includes the measurement devices. It is then postulated that this context cannot itself be treated as a quantum system. Within all these interpretations, the Born rule still holds ``for all practical purposes'', but is no longer a universally applicable law in the sense of Assumption~$\QT$ (see the discussion in~\cite{Bell75}).

Another class of theories that violate~$\QT$, although in a less obvious manner, are particular \emph{hidden variable (HV)} interpretations~\cite{Neuman32}, with \emph{Bohmian mechanics} as the most prominent example~\cite{deBroglie27,Bohm52,DuTe09}. According to the common understanding, Bohmian mechanics is a ``theory of the universe'' rather than a theory about subsystems~\cite{DuGoZa92}. This means that agents who apply the theory must in principle always take an  outside perspective on the entire universe, describing themselves as part of it. This outside perspective is identical for all agents,  which ensures consistency and hence the validity of Assumption~$\SelfCons$. However, because $\SW$ is satisfied, too, it follows from our no-go theorem that $\QT$ must be violated (see Appendix~\ref{app_Bohm} for more details).   

\smallskip

\subsection{Theories that violate Assumption~$\SelfCons$} \label{sec_Cviolation}

A violation of $\SelfCons$ is unavoidable whenever a theory  satisfies both $\QT$ and $\SW$. This conclusion applies to a wide range of common readings of quantum mechanics, including most variants of the \emph{Copenhagen interpretation}.  One concrete example is the \emph{consistent histories (CH)} formalism \cite{Griffiths84,Omnes92,Griffiths02}, which is also similar to the \emph{decoherent histories} approach \cite{GelHar90,Hartle11}. Another class of examples are subjectivistic interpretations, which regard statements about outcomes of measurements  as personal to an agent, such as \emph{relational quantum mechanics}~\cite{Rovelli96},  \emph{QBism}~\cite{FucSch13,FuMeSc14}, or  the approach proposed in~\cite{Brukner2017} (see Appendices~\ref{app_conshistories} and~\ref{app_QBism}   for a discussion of the CH formalism and QBism, respectively).
  
The same conclusion applies to hidden variable interpretations of quantum mechanics, provided that we use them to describe systems around us rather than the universe as a whole (contrasting the paradigm of Bohmian mechanics discussed above).  In this case, both $\QT$ and~$\SW$ hold by construction. This adds another item to the long list of no-go results for HV interpretations: they cannot  be local~\cite{Bell66}, they must be contextual~\cite{Bell64,KocSpe67}, and they violate freedom of choice~\cite{ColRen11,ColRen13}. That HV theories also violate~$\SelfCons$ means that, in a multi-agent scenario like the one considered here, even just assigning values to the hidden variables that are consistent with the agents' conclusions is impossible in general.

\smallskip

\subsection{Theories that violate Assumption~$\SW$} \label{sec_Sviolation}

Although intuitive, $\SW$ is not implied by the bare mathematical formalism of quantum mechanics.  Among the theories that abandon the assumption are  the \emph{relative state formulation} and \emph{many-worlds interpretations}~\cite{Everett57,Wheeler57,DeWitt70,Deutsch85,Deutsch97}. According to the latter, any quantum measurement results in a branching into different ``worlds'', in each of which one of the possible measurement outcomes occurs. Further developments and variations include the \emph{many-minds interpretation}~\cite{Zeh70, AlbLoe88} and the \emph{parallel lives} theory~\cite{Brassard13}. A related concept is  \emph{quantum Darwinism}~\cite{Zurek07}, whose purpose is to explain the perception of classical measurement outcomes in a unitarily evolving universe.  

While many-worlds interpretations manifestly violate~$\SW$, their compatibility with~$\QT$ and $\SelfCons$ depends on how one defines the branching. If one regards it as an objective process, $\QT$ may be violated  (cf.\ the example in Sec.~10 of~\cite{Vaidman98}).  It is also questionable whether~$\QT$ can be upheld if branches do not persist over time (cf.\ the \emph{no-histories} view described in~\cite{Butterfield95}).

\smallskip
 
\subsection{Implicit assumptions}

Any no-go result, as for example Bell's theorem~\cite{Bell66}, is phrased within a particular framework that comes with a set of built-in assumptions. Hence it is always possible that a theory evades the conclusions of the no-go result by not fulfilling these implicit assumptions. Here we briefly discuss how our no-go theorem compares in this respect to other results in the literature. 

Bell's original work~\cite{Bell66} treats probabilities as a primitive notion. Similarly, many of the modern arguments in quantum foundations  employ  probabilistic frameworks~\cite{Barrett07,Hardy11,ChDaPe11,MasMul11,ColRen12,PuBaRu12,LeiSpe13,BarWil16}.  In contrast, probabilities are not used in the argument presented here | although Assumption~$\QT$ is of course motivated by the idea that a statement can be regarded as ``certain'' if the Born rule assigns probability~$1$ to it. In particular, our no-go result does not depend  on how probabilities different from~$1$ are interpreted.  

Another distinction is that the framework used here treats all statements about observations as subjective, i.e., they are always defined relative to an agent. This avoids the  \emph{a priori} assumption that  measurement outcomes obtained by  different agents simultaneously have definite values.\footnote{Consider for example Wigner's original setup described in the introduction. Even when Assumptions~$\SelfCons$ and~$\SW$ hold,  agent~$\Wigner$ is not  forced to assign a definite value to the outcome~$z$ observed by agent~$\Friend$.} The assumption of simultaneous definiteness is otherwise rather common. It not only enters the proof of Bell's theorem~\cite{Bell66} but also the aforementioned arguments based on probabilistic frameworks. 

Nevertheless, in our considerations, we used concepts such as that of an ``agent'' or of ``time''. It is conceivable that the conclusions of or no-go theorem can be avoided by theories that provide a non-standard understanding of these concepts. We are however not aware of any concrete examples of such theories. 


\section{Discussion} \label{sec_discussion}

In the Gedankenexperiment proposed in this article, multiple agents have access to different pieces of information, and draw conclusions by reasoning about the information held by others. In the general context of quantum theory, the rules for such nested reasoning may be ambiguous, for the information held by one agent can, from the viewpoint of another agent, be in a superposition of different ``classical'' states. Crucially, however,  in the argument presented here, the agents' conclusions are all restricted to  supposedly unproblematic ``classical'' cases. For example, agent~$\Assistant$ only needs to derive a statement about agent~$\Friendtwo$ in the case where, conditioned on his own information~$\wb$, the information~$z$ held by~$\Friendtwo$ has a well-defined value  (Table~\ref{tab_statements}). Nevertheless, as we have shown, the agents arrive at contradictory statements.

Current interpretations of quantum theory do not agree on the origin of this contradiction (Table~\ref{tab_interpretations}). To compare the different views, it may therefore be useful to rephrase the experiment as a concrete game-theoretic decision problem.  Suppose that a casino offers the following gambling game.  One round of the experiment described in Section~\ref{sec_experiment} is played, with the gambler in the role of agent~$\Wigner$, and the roles of $\Friendone$, $\Friendtwo$, and $\Assistant$ taken by employees of the casino. The casino promises to pay \euro{1000} to the gambler if  $\Friendone$'s random value was $r=\head$. Conversely, if $r=\tail$, the gambler must pay \euro{500} to the casino.  It could now happen that, at the end of the game, $w=\ok$ and $\wb=\okb$, and that a judge can convince herself of this outcome. The gambler and the casino are then likely to end up in a dispute, putting forward arguments taken from Table~\ref{tab_statements}.

\smallskip

\noindent {\small \emph{Gambler:} ``The outcome $w=\ok$ proves, due to~\eqref{eq_Foneargument}, that $\Spin$ was not prepared in state $\spinright_{\Spin}$. This means that $r = \head$ and hence the casino must pay me \euro{1000}.''}

\smallskip

\noindent {\small \emph{Casino:} ``The outcome $\wb=\okb$ implies, due to~\eqref{eq_Assistantargument}, that our employee observed $z=\splus$. This in turn proves that $\Spin$ was not prepared in state $\spindown_{\Spin}$. But his means that  $r = \tail$, so the gambler must pay us \euro{500}.''}

\smallskip

How should the judge decide on this case? Could it even be that   both assertions must be accepted as two ``alternative facts'' about what the value~$r$ was? We leave it as a task for further research to explore what the different interpretations of quantum mechanics have to say about this game.

Our theorem (Section~\ref{sec_nogo}) may be compared to earlier no-go results, such as \cite{Bell64,KocSpe67,Bell66,Hardy92,Hardy93,ColRen11,Brukner2017}, which also use assumptions similar to~$\QT$ and $\SW$ (although the latter is often implicit).  These two assumptions are usually shown to be in conflict with additional assumptions about reality, locality, or freedom of choice. For example, the result of~\cite{Brukner2017}, which is as well based on an extension of Wigner's argument, asserts that no theory can fulfil all of the following properties: (i)~be compatible with quantum theory on all scales, (ii)~simultaneously assign definite truth values to measurement outcomes of all agents, (iii)~allow agents to freely choose measurement settings, and (iv)~be local. Here we have shown that  Assumptions~$\QT$ and $\SW$ are already problematic by themselves, in the sense that agents who use these assumptions to reason about each other as in  Fig.~\ref{fig_selfreference} will arrive at inconsistent conclusions.

Another noticeable difference to earlier no-go results is that the argument presented here does not employ counterfactual reasoning. That is, it does not refer to choices that could have been made but have not actually been made. In fact, in the proposed experiment, the agents never make any choices (also no delayed ones, as e.g., in \emph{Wheeler's delayed choice experiment}~\cite{Wheeler78}).  Furthermore, none of the agents' statements refers to values that are no longer available at the time when the statement is made (cf.\ Table~\ref{tab_statements}). 

We conclude by suggesting a modified variant of the experiment, which may be technologically feasible. The idea is to substitute the agents $\Friendone$ and $\Friendtwo$ by computers. Specifically, one would program them to follow the steps of the experimental procedure described in Section~\ref{sec_experiment},  process the information accessible to them, and output statements such as {``I am certain that $\Wigner$ will observe $w = \fail$ at $\text{1:31}$.''} To account for the requirement that $\Friendone$ and $\Friendtwo$'s labs be isolated, one would need to ensure that the computers used for their simulation do not leak any information to their environment | a property which is necessarily satisfied by quantum computers. Such an experiment could then be used to verify the statements in Table~\ref{tab_statements}. For example, aborting the experiment right after $\text{$1$:13}$, one could, in the case when $z=\splus$, read out  statement~$\Friendtwo^{\text{$1$:13}}$ made by agent~$\Friendtwo$ together with  statement~$\Friendone^{\text{$1$:02}}$ that agent~$\Friendone$ has made just before. This would be a test for the correctness of statement $\Friendtwo^{\text{$1$:13}}$. Note that all statements in the fourth column of Table~\ref{tab_statements} could in the same way be tested experimentally.  In this sense, quantum computers, motivated usually by applications in computing, may help us answering questions in fundamental research.  

\appendix

\section*{Appendix}

\setcounter{section}{1}

\subsection{Information-theoretic description} \label{app_diagram}

The experimental protocol described in Section~\ref{sec_experiment} may be represented as a circuit diagram, Fig.~\ref{fig_circuitdiagram}. The diagram emphasises the information-theoretic aspects of the experiment. While all agents have full information about the overall evolution (the circuit diagram itself), they have access to different data (corresponding to different wires in the diagram).

 
\subsection{Derivation of statement~$\Wigner^{\mathrm{0:00}}$ using Assumption~$\QT$} \label{app_statementW}

In the analysis of the Gedankenexperiment we argued that  the event $(\wb,w) = (\okb, \ok)$ must occur after finitely many rounds~$n$, which is statement~$\Wigner^{\text{0:00}}$ described shortly after~\eqref{eq_overlap}.  While this is a pretty obvious consequence of the Born rule, we now show that it already follows from Assumption~$\QT$, which corresponds to the special case of the Born rule when it gives probability-$1$ predictions. 

We consider Heisenberg operators relative to time $t_0=\text{0:00}$, i.e., right before the experiment starts. For any round~$n$, let $W^n$ be the isometry from $\mathbb{C}$ to $\Labone \otimes \Labtwo$ that includes the  initialisation of system~$\Coin$ in state $\ket{\mathsf{init}}_{\Coin}$ as well as $U_{\Coin \to \Labone \Spin}^{\text{00} \to \text{10}}$ and $U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}}$ (cf.\ Table~\ref{tab_evolution}), i.e., 
\begin{align}
  W_{\mathbb{C} \to \Labone \Labtwo}^n =(\id_{\Labone} \otimes U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}}) U_{\Coin \to \Labone \Spin}^{\text{00} \to \text{10}} \ket{\mathsf{init}}_{\Coin} \ .
\end{align}
The Heisenberg operator of the event $(\wb,w) =(\okb, \ok)$ in round~$n$ (relative to time~$t_0$) can thus be written as 
\begin{align}
  \pi^{(n)}_{(\wb,w) = (\okb, \ok)} = (W_{\mathbb{C} \to \Labone \Labtwo}^n)^{\dagger} (\proj{\okb}_{\Labone} \otimes \proj{\ok}_{\Labtwo}) (W_{\mathbb{C} \to \Labone \Labtwo}^n)  \ .
\end{align}
We may now specify a Heisenberg operator $\pi^{\text{0:00}}_{\mathrm{halt}}$ for the halting condition, i.e., that the event $(\wb, w) = (\okb,\ok)$  occurs in some round~$n$, 
\begin{align}
  \pi^{\text{0:00}}_{\mathrm{halt}} = \sum_{n=0}^\infty \pi^{(n)}_{(\wb,w)=(\okb, \ok)} \prod_{m=0}^{n-1} \bigl(\id_{\mathbb{C}}-\pi^{(m)}_{(\wb,w)=(\okb, \ok)}  \bigr) \ .
\end{align}
Note that these are operators on $\mathbb{C}$, i.e.,  $\smash{\pi^{(n)}_{(\wb,w)=(\okb, \ok)}} = p$ for some $p \in \mathbb{C}$. It follows directly from~\eqref{eq_overlap} that $p = \nicefrac{1}{12} > 0$. We thus have
\begin{align}
  \pi^{\text{0:00}}_{\mathrm{halt}} 
  = \sum_{n=0}^\infty p (1-p)^{n} = \id_{\mathbb{C}} \ .
\end{align}
Inserting this measurement operator into the corresponding statement of   Assumption~$\QT$ yields statement $\Wigner^{\text{0:00}}$.


\begin{figure*}[t]
\centering
{\footnotesize
\makebox[\textwidth][c]{
\begin{tikzpicture}[baseline=1cm,xscale=1.79,yscale=0.7] 
\draw[thin,->] (-1.1,1) -- (8.2,1) node[right] {$t$};
\draw (-0.05,0.95) node[below] {$\text{$n$:00}$} -- (-0.05,1.05); 
\draw [very thin,lightgray] (-0.05,1.1) -- (-0.05,10.6);
\draw (1.95,0.95) node[below] {$\text{$n$:10}$} -- (1.95,1.05); 
\draw [very thin,lightgray] (1.95,1.1) -- (1.95,10.6);
\draw (3.95,0.95) node[below] {$\text{$n$:20}$} -- (3.95,1.05); 
\draw [very thin,lightgray] (3.95,1.1) -- (3.95,10.6);
\draw (5.95,0.95) node[below] {$\text{$n$:30}$} -- (5.95,1.05); 
\draw [very thin,lightgray] (5.95,1.1) -- (5.95,10.6);
\draw (7.95,0.95) node[below] {$\text{$n$:40}$} -- (7.95,1.05); 
\draw [very thin,lightgray] (7.95,1.1) -- (7.95,10.6);
%
\draw (-1.1,7.5) rectangle (-0.4,8.5);
\draw (-0.75,8) node {$\bra{\mathsf{init}}_{\Coin}$};
% 
\draw (-0.4, 8) -- (0, 8); 
\draw (-0.2, 8) node[above] {$\Coin$};
\draw (0,10.5) rectangle (1.8,6.5);
\draw (0.9,6.5) node[below] {$(U^{\text{00} \to \text{10}}_{\Coin \to \Labone \Spin})^{\dagger}$};
\draw (1.8,10) -- (3.6,10) (1.8,9) -- (3.6,9) (1.8,8) -- (3.6,8);
\draw[thick] (3.6,10) -- (3.6,8);
\draw (2.1,10) node[above] {$\FriendoneEnv$};
\draw (2.1,9) node[above] {$\FriendoneS$};
\draw (2.1,8) node[above] {$\Coin$};
\draw (1.8,7) -- (1.9, 7) -- (1.9, 5) -- (2,5); 
\draw (1.9,6) node[left]  {$\Spin$};
\draw (0.9,8.5) node {\begin{minipage}{4cm} \scriptsize \begin{align*} & \proj{ \hspace{-0.1em} \head \hspace{-0.1em}}_{\Coin} \!\bra{ \hspace{-0.1em} \heads \hspace{-0.1em}}_{\FriendoneEnv} \! \bra{\heads}_{\FriendoneS} \spindownb_{\Spin} \\ +\hspace{-0.1em}  & \proj{\tail}_{\Coin} \! \bra{\tails}_{\FriendoneEnv} \! \bra{\tails}_{\FriendoneS} \spinrightb_{\Spin} \\\end{align*}  \end{minipage}};
%
\draw (2,2.5) rectangle (3.8,5.5);
\draw (2.9,2.5) node[below] {$(U^{\text{10} \to \text{20}}_{\Spin \to \Labtwo})^{\dagger}$};
\draw (3.8,5) -- (5.6,5) (3.8,4) -- (5.6,4) (3.8,3) -- (5.6,3);
\draw[thick] (5.6,5) -- (5.6,3);
\draw (4.1,5) node[above] {$\Spin$};
%\draw (4.7,5) node[below] {spin};
\draw (4.1,4) node[above] {$\FriendtwoS$};
%\draw (4.7,4) node[below]  {\begin{minipage}{2cm} information of agent $\Friendtwo$ \end{minipage}};
\draw (4.1,3) node[above] {$\FriendtwoEnv$};
%\draw (4.7,3) node[below] {\begin{minipage}{2cm} environment of agent $\Friendtwo$ \end{minipage}};
\draw (2.9,4) node {\begin{minipage}{4cm} \scriptsize \begin{align*} & \spindown \spindownb_{\Spin} \bra{\sminus}_{\FriendtwoEnv} \! \bra{\sminus}_{\FriendtwoS} \\ + \hspace{-0.1em}&  \spinup \spinupb_{\Spin} \bra{\splus}_{\FriendtwoEnv} \!\bra{\splus}_{\FriendtwoS} \\ \end{align*} \end{minipage}};
%
\draw[thick] (3.6,9) -- (4, 9);
\draw (3.8,9) node[above] {$\Labone$};
\draw (4,10.5) rectangle (5.8,7.5);
\draw (5.8,10) -- (8.2,10) (5.8,9) -- (8.2,9) (5.8,8) -- (8.2,8);
\draw (6.1,10) node[above] {$\AssistantEnv$};
\draw (6.1,9) node[above] {$\Labone$};
\draw (6.1,8) node[above] {$\AssistantS$};
\draw (4.9,9) node {\begin{minipage}{4cm} \scriptsize \begin{align*} & \proj{\okb}_{\Labone} \! \bra{\okb}_{\AssistantEnv}\!  \bra{\okb}_{\AssistantS} \\
+ \hspace{-0.1em} & \proj{\okb}^\perp_{\Labone} \! \bra{\hspace{-0.1em} \failb \hspace{-0.1em} }_{\AssistantEnv} \! \bra{\hspace{-0.1em} \failb \hspace{-0.1em} }_{\AssistantS} \\ \end{align*} \end{minipage}};
%
\draw[thick] (5.6,4) -- (6,4);
\draw (5.8,4) node[above] {$\Labtwo$};
\draw (6,2.5) rectangle (7.8,5.5);
\draw (7.8,5) -- (8.2,5) (7.8,4) -- (8.2,4) (7.8,3) -- (8.2,3);
\draw (8.1,5) node[above] {$\WignerS$};
\draw (8.1,4) node[above] {$\Labtwo$};
\draw (8.1,3) node[above] {$\WignerEnv$};
\draw (6.9,4) node {\begin{minipage}{4cm} \scriptsize \begin{align*} & \proj{\ok}_{\Labtwo} \! \bra{\ok}_{\WignerEnv} \! \bra{\ok}_{\WignerS} \\
+ \hspace{-0.1em} & \proj{\ok}^\perp_{\Labtwo} \! \bra{\hspace{-0.1em}  \fail \hspace{-0.1em} }_{\WignerEnv} \! \bra{\hspace{-0.1em}  \fail \hspace{-0.1em} }_{\WignerS} \\ \end{align*} \end{minipage}};
\end{tikzpicture}
}}

\caption{{\bf Circuit diagram representation of the Gedankenexperiment.} The actions of the agents during the protocol correspond to isometries (boxes) that act on particular subsystems (wires). For example, the measurement of $\Spin$ by agent~$\Friendtwo$ in the second protocol step, which starts at time~$\text{$n$:10}$, induces an isometry $U_{\Spin \to \Labtwo}^{\text{10} \to \text{20}}$  from $\Spin$ to $\Friendtwo$'s lab $\Labtwo$, analogous to the one defined by~\eqref{eq_Labstate}. The subsystems labelled by $\FriendoneS$, $\FriendtwoS$, $\AssistantS$, and $\WignerS$ contain the agents themselves. Similarly, $\FriendoneEnv$, $\FriendtwoEnv$, $\AssistantEnv$, and $\WignerEnv$ are ``environment'' subsystems, which include the agents' measurement devices. The states of these subsystems depend on the  measurement outcome, which is indicated by their label. For example, $\smash{\ket{\splus}_{\FriendtwoS}}$ is the state of~$\Friendtwo$ when the agent has observed $z=\splus$. 
\label{fig_circuitdiagram}
}
\end{figure*}


\subsection{Analysis within Bohmian mechanics} \label{app_Bohm}

According to Bohmian mechanics,  the state of a system of particles consists of  their quantum-mechanical wave function together with an additional set of variables that specify the particles' spatial positions. While the wave function evolves according to the Schr\"odinger equation, the time evolution of the additional position variables is governed by another equation of motion, sometimes referred to as the ``guiding equation''. The general understanding is that these equations of motion must always be applied to the universe as a whole. As noted in~\cite{DuGoZa92}, ``if we postulate that subsystems [rather than the  universe] must obey Bohmian mechanics, we `commit redundancy and risk inconsistency.'\hspace{0.08em}'' 

The Gedankenexperiment presented in this work shows that this risk is real. Indeed, if the agents applied the Bohmian equations of motion directly to the relevant systems around them, rather than to the universe as a whole, their reasoning would be the same as the one prescribed by~$\QT$.  But since Bohmian mechanics also satisfies~$\SW$, this would, by virtue of our no-go theorem, imply a violation of~$\SelfCons$, i.e., the agents' conclusions would contradict each other.\footnote{This finding should not be confused with the known fact that, if the spatial position of a particle is measured, the Bohmian position of the measurement device's pointer is sometimes incompatible with the Bohmian position of the  measured particle~\cite{ESSW92,CorMor02,KiuWer10,NaErVa12,Gisin18}.}

The directive of~\cite{DuGoZa92} that Bohmian mechanics should be applied to the entire universe means that the agents must model themselves from an outside perspective. This ensures that they all have the same view, so that reasoning according to~$\SelfCons$ is unproblematic.  But then our no-go theorem asserts that $\QT$ is necessarily violated. This is indeed confirmed by an explicit calculation in Bohmian mechanics, which reveals that statement~$\smash{\Friendone}^{\text{$n$:02}}$ of Table~\ref{tab_statements} does not hold there.  Furthermore, the time order of the measurements carried out by agents~$\Assistant$ and $\Wigner$ is relevant within Bohmian mechanics. If agent~$\Wigner$ measured before agent~$\Assistant$ then, according to Bohmian mechanics, statement~$\smash{\Assistant^{\text{$n$:22}}}$ would be invalid whereas $\smash{\Friendone}^{\text{$n$:02}}$ would hold. This is a clear departure from standard quantum mechanics, where the time order in which agents~$\Assistant$ and~$\Wigner$ carry out their measurements is irrelevant, because they act on separate systems. 

This violation of~$\QT$ raises the question under what circumstances Bohmian mechanics still endorses the use of the quantum-mechanical Born rule for predicting the outcome of a measurement.  A candidate criterion could be that such a prediction is only valid if a memory of the prediction is available upon completion of the measurement. One may then be tempted to argue that agent $\Friendone$'s statement $\smash{\Friendone}^{\text{$n$:02}}$, for instance, is invalid because $\Friendone$ is herself subject to a measurement, which may destroy her memory of the prediction for~$w$ before that value is measured.  This argument does however not work. The reason is that, in the relevant case when $\wb=\okb$, the value $r$ and hence also agent~$\Friendone$'s prediction for~$w$ is, by virtue of the statements $\smash{\Assistant^{\text{$n$:22}}}$ and $\smash{\Friendtwo^{\text{$n$:12}}}$, retrievable at the time when~$w$ is measured.


\subsection{Analysis within the CH formalism} \label{app_conshistories}

In the consistent histories (CH) formalism, statements about measurement outcomes are phrased in terms of ``histories''. These must, by definition, be elements of a whole family of histories, called a ``framework'', that satisfies certain consistency conditions.  In the Gedankenexperiment proposed in this work, a possible history would be
\begin{align*} 
  \sTM{\hT{h_1} \asn{In round~$n$ the outcomes $r \!=\!\tail$, $z\!=\!\splus$, $\wb\!=\!\okb$, and $w\!=\!\ok$ were observed.}}
\end{align*}
To verify that $h_1$ is indeed a valid history, one has to construct a framework containing this history. It is straightforward to check that one such framework is the set consisting of $h_1$  together with the additional histories
\begin{align*}
 \sTM{\hT{h_2} \asn{In round~$n$ the outcomes $r \!=\!\tail$, $z\!=\!\splus$, $\wb\!=\!\okb$, and $w\!=\!\fail$ were observed.}} \\
  \sTM{\hT{h_3} \asn{In round~$n$ the outcomes $r \!=\!\head$, $z\!=\!\splus$, and $\wb\!=\!\okb$ were observed.}} \\
   \sTM{\hT{h_4} \asn{In round~$n$ the outcomes $z\!=\!\sminus$ and $\wb\!=\!\okb$ were observed.}} \\
   \sTM{\hT{h_5} \asn{The outcome $\wb\!=\!\failb$ was observed.}}
\end{align*}
The CH formalism contains the Born rule as a special case and hence fulfils Assumption~$\QT$. Since it also satisfies~$\SW$, it follows from our no-go theorem that it violates $\SelfCons$. To illustrate how this violation manifests itself, we may consider a shortened version of history~$h_1$, which leaves the values $z$ and $\wb$ unmentioned:
 \begin{align*}
    \sTM{\hT{h_1' }  \asn{In round~$n$ the outcomes $r \!=\!\tail$ and  $w\!=\!\ok$ were observed.}}
 \end{align*}
The CH formalism provides a rule to assign probabilities to these histories, which turn out to be  
 \begin{align} \label{eq_probass}
  \Pr[h_1] = \nicefrac{1}{12} \quad \text{and} \quad  \Pr[h_1'] = 0 \ .
\end{align}
Note that these probabilities disagree with the fact that $h_1'$ is  just a part of history~$h_1$, i.e., $h_1 \implies h'_1$.\footnote{This finding may be compared to the  \emph{three box paradox}~\cite{AhaVai91}, where calculations in three different consistent frameworks yield mutually incompatible probability assignments (see Sec.~22 of~\cite{Griffiths02} as well as~\cite{Kent97} for a discussion).}

%  In that experiment,  statements about three different variants of an experiment are compared. In the first, $V_A$, a system is prepared in state~$(\ket{1}+\ket{2}+\ket{3})/\sqrt{3}$, then measured  with respect to observable $A= \proj{1}$, and finally projected onto the vector $\xi = (\ket{1} + \ket{2} - \ket{3})/\sqrt{3}$. In the second, $V_B$, observable $B=\proj{2}$ instead of~$A$ is measured. In the third variant, $V_{AB}$, both $A$ \emph{and} $B$ are measured. One can then for each variant derive a statement that holds with certainty conditioned on the event that the projection onto~$\xi$ is successful, namely $A=1$, $B=1$, and $A\neq B$, for $V_A$, $V_B$, and $V_{A B}$, respectively.} 

The CH formalism accounts for this disagreement by imposing the rule that logical reasoning must be constrained to histories that belong to a single framework, which is not the case for $h_1$ and~$h_1'$.  To illustrate what this means, it is useful to return to the  casino example described in  the discussion section above.  Within a framework that contains history~$h_1'$, the gambler's reasoning is correct, for $\Pr[h_1'] = 0$.  That is, $w= \ok$ implies that $r=\head$. Conversely, considering the framework above, which contains history~$h_1$, it is readily verified that the other histories, $h_2$, $h_3$, $h_4$, and $h_5$, have probabilities~$\nicefrac{1}{12}$, $0$, $0$, and $\nicefrac{5}{6}$, respectively. That is, all non-zero probability histories of this framework that agree with the observation $\wb=\okb$ also assert that $z = \splus$ and $r = \tail$. This seems to be in agreement with the casino's argument, i.e.,  $\wb = \okb$ implies that $z = \splus$ and $r = \tail$. However,  because the framework does not include a history that talks about $r$ alone, it disallows the | seemingly obvious | implication  $( r = \tail \text{ and } z = \splus ) \implies r = \tail$. In other words, within the CH formalism, the casino can prove that $r = \tail$ and $z = \splus$, but not that $r=\tail$. 

\subsection{Analysis within QBism} \label{app_QBism}

QBism is one of the most far-reaching subjectivistic interpretations of quantum mechanics.  It regards quantum states as representations of an agent's  personal knowledge, or rather beliefs, about the outcomes of future measurements, and it also views these outcomes as personal to the agent. 

To reflect these tenets of QBism in the analysis of the Gedankenexperiment, it is useful to imagine that the agents write their observations and conclusions into a personal notebook.  For example, according to Table~\ref{tab_statements}, when agent $\Friendone$ gets $r=\tail$ in round~$n=1$, she may put down the following 
\begin{align*}
  \sTM{\sT{\Friendone^{\text{1:02}}} \asn{$r=\tail$ at time $\text{1:01}$,  hence I am certain that we will hear $\Wigner$ announcing $w = \fail$ at the end of this round.}}
\end{align*}
Here the phrase ``is certain that'' expresses a degree of belief and may also be replaced by something like ``would bet an arbitrarily large amount on''. Similarly, agent $\Friendtwo$, when she gets $z=\splus$, may write into her notebook 
\begin{align*}
  \sTM{\sT{\Friendtwo^{\text{1:12}}} \asn{$z=\splus$ at time $\text{1:11}$, hence I am certain that, if I now checked $\Friendone$'s notebook, I would read that $r=\tail$ at time $\text{1:01}$.}}
\end{align*}
Agent~$\Friendtwo$ may as well write about agent~$\Friendone$'s conclusions, i.e., 
\begin{align*}
  \sTM{\sT{\Friendtwo^{\text{1:13}}} \asn{$z=\splus$ at time $\text{1:11}$, hence I am certain that, if I now checked $\Friendone$'s notebook, I would read that she is certain that we will hear $\Wigner$ announcing $w = \fail$ at the end of this round.}}
\end{align*}
 Agent~$\Friendtwo$ may now be tempted to conclude from the above that
\begin{align*}
  \sTM{\sT{\Friendtwo^{\text{1:14}}} \asn{$z=\splus$ at time $\text{1:11}$, hence I am certain that we will hear $\Wigner$ announcing $w = \fail$ at the end of this round.}}
\end{align*}

However, permitting such implications is akin to assuming~$\SelfCons$. Because QBism  satisfies~$\QT$ and~$\SW$, it would result in the agents issuing contradictory statements. The Gedankenexperiment is thus an example of a multi-agent scenario where,  to ensure consistency of QBism, implications of the type $\Friendtwo^{\text{1:13}} \implies \Friendtwo^{\text{1:14}}$ must be disallowed.  Nevertheless, there should be ways for  agents to  consistently reason about each other. One may therefore ask whether $\SelfCons$ could be substituted by another (weaker) rule that enables such reasoning but does not lead to contradictions. This question is currently being investigated~\cite{DFS18}.

\section*{Acknowledgments}

We would like to thank Yakir Aharonov, Mateus Ara\'ujo, Alexia Auff\`eves, Jonathan Barrett, Veronika Baumann, Serguei Beloussov, Charles Bennett, Hans Briegel, \v{C}aslav Brukner, Harry Buhrman, Ad\'an Cabello, Giulio Chiribella, Roger Colbeck, Patricia Contreras Tejada, Giacomo Mauro D'Ariano,  John DeBrota, L\'idia del Rio, David Deutsch, Artur Ekert, Michael Esfeld, Philippe Faist, Aaron Fenyes, Hugo Fierz, J\"urg Fr\"ohlich, Christopher Fuchs, Shan Gao, Svenja Gerhard, Edward Gillis, Nicolas Gisin,  Sheldon Goldstein, Sabrina Gonzalez Pasterski, Gian Michele Graf, Philippe Grangier, Bob Griffiths,  Arne Hansen, Lucien Hardy, Aram Harrow, Klaus Hepp, Pawe\l{} Horodecki, Angela Karanjai, Adrian Kent, Gijs Leegwater, Matthew Leifer, Seth Lloyd, John Loverain, Markus M\"uller, Thomas M\"uller, Hrvoje Nikoli\'c, Travis Norsen, Nuriya Nurgalieva, Jonathan Oppenheim, Sandu Popescu, Matthew Pusey, Gilles P\"utz, Joseph Renes, Jess Riedel, Valerio Scarani, R\"udiger Schack, Norman Sieroka, Robert Spekkens, Cristi Stoica, Antoine Suarez, Tony Sudbery, Stefan Teufel, Roderich Tumulka, Lev Vaidman, Vlatko Vedral, Mordecai Waegell, Andreas Winter, Stefan Wolf, Filip Wudarski,  Christa Zoufal, and Wojciech Zurek for comments and discussions.

This project was supported by the Swiss National Science Foundation (SNSF) via the National Centre of Competence in Research ``QSIT'', by the Kavli Institute for Theoretical Physics (KITP) at the University of California in Santa Barbara, by the Stellenbosch Institute for Advanced Study (STIAS) in South Africa,  by the US National Science Foundation (NSF) under grant No.\ PHY17-48958, by the European Research Council (ERC) under grant No.\ 258932,  and by the European Commission under the project ``RAQUEL''.  

\bibliographystyle{unsrt}
\bibliography{Foundations}

\end{document}

