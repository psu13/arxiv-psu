\def~{\unskip\nobreak\kern0.2778em\ignorespaces\nobreak\hskip0pt}
\renewcommand{\,}[1][1]{% 1/3 от стандарта \, = \mskip3mu = \thinspace
\ifmmode\mkern#1mu\else\kern#1\dimexpr0.05556em\fi\relax}% 1em = 18mu
\renewcommand{\!}[1][1]{\,[-#1]}
% метка пустого места в тексте; для корректной \pageref
\def\eLab#1{\hbox to0ex{\vbox to0ex{%
\equation\label{#1}\notag\endequation}}\relax}

\initiate@active@char{"} \bbl@activate{"} % сделать символ " активным
\defineshorthand{"=}{\nobreak-\hskip0pt}
\defineshorthand{"~}{\hbox{-}}
\defineshorthand{""}{\nobreak\hskip0pt}
%
\catcode`\’=\active
\def’’{^{\prime\mkern-1.5mu\prime}}
\def\initiate@active@char#1{\expandafter\ifx\csname
% active@char\string##1\endcsname\relax % это было
	active@char\string##1\endcsname\ignorespaces
	\bbl@afterfi{\@initiate@active@char{#1}}\fi}

\providecommand{\@listI}{}
\renewcommand{\@listI}{% настоять на своей версии \@listI
	\leftmargin=2.5em%
	\rightmargin=2em%
	\listparindent=1em%
	\topsep=6pt plus 2pt minus 3pt}

\newenvironment{Align}[1][{11}]% 11 колонок без пробелов между ними
	{\csname alignat\endcsname{#1}}{\csname endalignat\endcsname}
\newenvironment{Align*}[1][{11}]%
	{\csname alignat*\endcsname{#1}}{\csname endalignat*\endcsname}

\RequirePackage{amsmath}
\allowdisplaybreaks[4]% разрывать стр. на многострочных формулах

\def\@adjustvertspacing{%
 \bigskipamount.7\baselineskip plus.7\baselineskip
 \medskipamount\bigskipamount\divide\medskipamount\tw@
 \smallskipamount\medskipamount\divide\smallskipamount\tw@
 \abovedisplayskip\medskipamount
 \belowdisplayskip\abovedisplayskip
 \abovedisplayshortskip\abovedisplayskip
 \advance\abovedisplayshortskip-1\abovedisplayskip
 \belowdisplayshortskip\abovedisplayshortskip
 \advance\belowdisplayshortskip 1\smallskipamount
 \jot=1.3ex%
\relax}

\RequirePackage{relsize} % relscale/smaller/larger
\def\RSsmallest{4pt} % равномерное уменьшение при 10/11/12pt:
\newcommand{\Larger}[2][1]{\hbox{\larger[#1]$#2$}}% relsize Ok
\newcommand{\Smaller}[2][1]{\hbox{\relscale{0.% Ok для 10/11pt
	\ifcase#1 99\or9\or8\or7\or6\or5\else4\fi}$#2$}}

\def\ds {\displaystyle}
\def\ts {\textstyle}
\def\scs{\scriptstyle}
\def\sss{\scriptscriptstyle}
\def\bb {\mathbb}
\def\bo {\boldsymbol}
\def\cal{\mathcal}
\def\mbf{\mathbf}
\def\msf{\mathsf}
\def\scr{\mathscr}
\def\itsf#1{\textsf{\textit{#1}}} % работают курсивные поправки
\def\itbf#1{\textbf{\textit{#1}}}
\def\embf#1{\textbf{\emph{#1}}}
\def\frak{\mathfrak} % чтобы не было AMS-сообщения: obsolete \frak
\def\Courier  #1{\text{\usefont{OT1}{pcr}{m}{n} #1}}
\def\bfCourier#1{\text{\usefont{OT1}{pcr}{b}{n} #1}}

\def\bbC {{\mathbb C}}
\def\bbQ {{\mathbb Q}}
\def\bbR {{\mathbb R}}
\def\bbH {{\mathbb H}}
\def\eps {\varepsilon}
\def\ri{{\mathrm i}}
\def\const{\mathrm{const}}
\def\sp{{\vcenter{\hbox{$\sss+$}}}}
\def\sm{{\vcenter{\hbox{$\sss-$}}}}
\def\DEF{ \mathrel{\mathop:}=}
\def\FED{=\mathrel{\mathop:} }
% команды ниже страбатывают на \tsf, \ttt, \tbf, \tsc, \emph
\def\qm {{\smaller[1]QM}}
\def\qt {{\smaller[1]QT}}
\def\lvs{{\smaller[1]LVS}}
\def\qft{{\smaller[1]QFT}}

\def\circ  {\mathbin{\hbox{$\vcenter{\hbox{$\sss\mathchar"220E$}}$}}}
\def\Circ  {\mathbin{\mathchar"220E}}
\def\odot  {\mathbin{\hbox{$\vcenter{\hbox{$\scs\mathchar"220C$}}$}}}
\def\Odot  {\mathbin{\mathchar"220C}}
\def\oplus {\mathbin{\hbox{$\vcenter{\hbox{$\scs\mathchar"2208$}}$}}}
\def\Oplus {\mathbin{\mathchar"2208}}
\def\times {\mathbin{\hbox{$\vcenter{\hbox{$\scs\mathchar"0202$}}$}}}
\def\Times {\mathbin{\mathchar"0202}}
\def\otimes{\mathbin{\hbox{$\vcenter{\hbox{$\scs\mathchar"220A$}}$}}}
\def\Otimes{\mathbin{\mathchar"220A}}
\def\Vee   {\mathbin{\mathchar"225F}}

\def\ie{i.\kern0.1667em e.\@}
\def\etc{etc}
\def\eg{e.\kern0.1667em g.}
\def\thelike{and the like}

\def\point#1{\mathchoice{{\Smaller[1]{\mathcal#1}}}%
	{{\Smaller[1]{\mathcal#1}}}{{\mathcal#1}}{{\mathcal#1}}}
\def\lrceil#1{$\lceil$\nobreak\hskip0pt#1\nobreak\hskip0pt$\rceil$}
%%% simplification/improvement of \overset, \underset
\newcommand{\Over }[3][1.3]{% default: \Over[1.3]{*}{\mapsto}
	\setbox0=\hbox{$\scs#2$}
	\setbox1=\hbox{$#3$}
	\ifdim \wd0<\wd1 \setbox0=\hbox to\wd1{\hfil\box0\hfil}
	\else            \setbox1=\hbox to\wd0{\hfil\box1\hfil} \fi
	\hbox to0pt{\box1\hss} \raise#1ex\box0\relax}

\newcommand{\Under}[3][0.8]{% default: \Under[0.8]{*}{\mapsto}
	\setbox0=\hbox{$#3$}
	\setbox1=\hbox{$\scs#2$}
	\ifdim \wd0<\wd1 \setbox0=\hbox to\wd1{\hfil\box0\hfil}
	\else            \setbox1=\hbox to\wd0{\hfil\box1\hfil} \fi
	\hbox to0pt{\box0\hss} \lower#1ex\box1\relax}
%%%%%%%%%%
\newcommand{\oper}[2][0]{ % улучшенная ^ \hat; чуть пошире
	\setbox1=\hbox{$\m@th#2$} \dimen0=0.6\wd1
	\setbox2=\hbox{$\m@th\scs\skew{#1}\widehat{\vbox to1.06\ht1{}}$}
	\advance\dimen0 0.6\wd2 {}\kern\dimen0 \box2\kern-\dimen0{}#2}
%
\newcommand{\goto}[1][2]%
	{\mathrel{\REPEAT{\mathchar"439}{#1}\mathchar"044B}}
\def\hhence{\mathrel{\hbox{\scalebox{1.3}[1]{\hbox%
	{$\Leftarrow\mkern-13mu\Rightarrow$}}}}}
\newcommand{\hence}[1][1.3]{%
	\mathrel{\hbox{\scalebox{#1}[1]{\hbox{$\Rightarrow$}}}}}

\def\fboxsep{2.5\dimen36} % ~1.5ex; в 2.5 раза больше default

\newdimen{\upp} \newdimen{\Dim} \newdimen{\DDim}
\newcommand{\pow}[4][\displaystyle]{
\settowidth{\upp}{\hbox{$\m@th#1 {}^{#4}$}}%
\settowidth{\Dim}{\hbox{$\m@th#1{#2}$}}%
\settowidth{\DDim}{\hbox{$\m@th#1{#2}_{#3}$}}%
\addtolength{\DDim}{-\Dim} {#1{#2}_{#3}\kern-\DDim {}^{#4}}
\addtolength{\DDim}{-\upp}\ifdim\DDim>0pt \kern+\DDim \fi\relax}

\newcount\@Yn % мой  счетчик;
\def\REPEAT#1#2{\@Yn=0\loop\ifnum\@Yn<#2\advance\@Yn by1#1\repeat}

\def\red   {\color[rgb]{1,0,0}}
\def\blue  {\color[rgb]{0,0,1}}
\def\cyan  {\color[rgb]{0,1,1}}%  стандартный cyan=[cmyk]{1,0,0,0}
\RequirePackage{color}
\definecolor{magenta}{rgb}{1,0,1}% стандартная magenta=[cmyk]{0,1,0,0}
\def\magenta{\color[rgb]{1,0,1}}%  слишком красноватая в pdf
