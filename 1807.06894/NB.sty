% Утилиты для комментариев

% Вставить бокс нулевой ширины и высоты.
% Необязательный аргумент - поднять на ...mm
\newcommand{\INSERT}[2][0mm]{\text{$\smash{\hbox to0mm%
{\raisebox{#1}[0mm][0mm]{#2}}}$}}

% Использование цикла \loop ... \repeat
% Д.Кнут, Appendix A, упр: 20.20
\newcount\@Yn % мой  счетчик;
\def\REPEAT#1#2{\@Yn=0\loop\ifnum\@Yn<#2\advance\@Yn by1#1\repeat}

\def\see{\@ifnextchar[{\@with}{\@without}}
\def\@with[#1]#2{{\normalfont\relscale{0.8}$\bo[$%
\textsc{\textcolor{magenta}{#2:}} \usefont{T2A}{cmr}{m}{ui}%
\textcolor{magenta}{стр.\,[4]#1}$\bo]$}}
\def\@without #1{{\normalfont\relscale{0.8}$\bo[$%
\textsc{\textcolor{magenta}{#1}}$\bo]$}}

\def\example{\par\upshape\@ifnextchar[{\@exY}%
{\textblue{\itsf{Пример}}}}
\def\@exY[#1]{\textblue{\itsf{Пример~\textup{(#1)}}}}

\def\remark{\par\upshape\@ifnextchar[{\@remY}%
{\textblue{\textit{Замечание}}}}
\def\@remY[#1]{\textblue{\textit{Замечание}~$($#1\/$)$}}

\newenvironment{NB}[1][]{\sffamily\upshape\begin{list}{}
{\topsep=0.5ex\leftmargin=1em\rightmargin=1em}\item[]%
\russian\relscale{0.7}\@NBcolor{%
\if\relax\detokenize{#1}\relax$\bo\diamondsuit$\else%
{\usefont{T2A}{cmr}{m}{ui}#1}\fi}\kern0.5em\ignorespaces}{\end{list}}

% заметка между строк в текущей позиции; не зависит от babel Ru/Eng
\newcommand{\look}[1][???]%  по центру
{\strut\vadjust{\raisebox{2.15ex}[0mm][0mm]%
{\normalsize\hspace{-1.7em}\@NBcolor{$\blacktriangleright$}}}%
\makebox[0em][c]{\raisebox{1.6ex}[0mm][0mm]
{\fontsize{5pt}{0pt}\usefont{T2A}{cmr}{m}{ui}\@NBcolor{#1}}}}
\newcommand{\lookl}[1][???]% слева
{\strut\vadjust{\raisebox{2.15ex}[0mm][0mm]%
{\normalsize\hspace{-1.7em}\@NBcolor{$\blacktriangleright$}}}%
\makebox[0em][r]{\raisebox{1.6ex}[0mm][0mm]
{\fontsize{5pt}{0pt}\usefont{T2A}{cmr}{m}{ui}\@NBcolor{#1}}}}
\newcommand{\lookr}[1][???]% справа
{\strut\vadjust{\raisebox{2.15ex}[0mm][0mm]%
{\normalsize\hspace{-1.7em}\@NBcolor{$\blacktriangleright$}}}%
\makebox[0em][l]{\raisebox{1.6ex}[0mm][0mm]
{\fontsize{5pt}{0pt}\usefont{T2A}{cmr}{m}{ui}\@NBcolor{#1}}}}
\newcommand{\OK}% просто Ok
{\strut\vadjust{\raisebox{2.15ex}[0mm][0mm]%
{\normalsize\hspace{-1.7em}\@NBcolor{$\blacktriangleright$}}}%
\makebox[0em][c]{\raisebox{1.6ex}[0mm][0mm]
{\fontsize{5pt}{0pt}\usefont{T2A}{cmr}{b}{n}\@NBcolor{Ok}}}}
% фиксированная позиция между строк; сокращения из Кнут: стр.~129, 377
\newcommand{\?}[1][???]{{%
\strut\vadjust{\raisebox{2.15ex}[0mm][0mm]%
{\normalsize\hspace{-1.7em}\@NBcolor{$\blacktriangleright$}}}%
\strut\vadjust{\raisebox{2.5ex}[0mm][0mm]{%
\fontsize{5pt}{0pt}\usefont{T2A}{cmr}{m}{ui}\@NBcolor{#1}}}}}

\ifx\pdfoutput\undefined\def\@NBcolor{\textcolor{blue}}%
\else\def\@NBcolor{\textcolor{green}}\fi
