\documentclass[10pt,twocolumn,aps,groupedaddress,nofootinbib]{revtex4}
%\documentclass[10pt,showpacs,letterpaper,aps,twocolumn,nofootinbib,pra]{revtex4-1}
%\documentclass[aps,prl,preprint,superscriptaddress]{revtex4}
%\documentclass[aps,prl,twocolumn,groupedaddress]{revtex4}
\usepackage{amsmath,amsfonts,amssymb,amsthm, bbm}

\usepackage[normalem]{ulem}
\usepackage{enumerate}  %For labeling lists
\usepackage[pdftex]{graphicx} % For including graphics N.B. pdftex graphics driver
\usepackage{rotating}  %For sideways tables
\usepackage[dvipsnames]{xcolor}
\usepackage{relsize}
\usepackage{comment}
%\usepackage{tikzit}
%\input{tikzstyles}
\usepackage{breakurl}
%--------------------------------MACROS-------------------------------------------------------------------------------

\newcommand\Op{\mathsf{Op}}
\newcommand\RL{\mathbf{RLinear}}
\newcommand\R{\mathbb{R}}
\newcommand\QSS{\mathbf{QuasiSubStoch}}
\newcommand\G{\mathcal{G}}
\newcommand\SubS{\bf{SubStoch}}
\newcommand\herm{\mathbb H(\mathcal H)}
\newcommand\unit{\mathbb U(\mathcal H)}
\newcommand\den{\mathbb D(\mathcal H)}
\newcommand\eff{\mathbb E(\mathcal H)}
\newcommand\proj{\mathbb P(\mathcal H)}
\newcommand\povm{\mathrm{POVM}(\mathcal H)}
\newcommand\pvm{\mathrm{PVM}(\mathcal H)}
\newcommand\range{\mathrm{Ran}}
\newcommand\domain{\mathrm{Dom}}
\newcommand\Tr{\mathrm{Tr}}
\newcommand\conv{\mathrm{conv}}
\newcommand\spec{\mathrm{spec}}
\newcommand\Hil{\mathcal H}
\newcommand{\SU}{\mathrm{SU}(2)}
\newcommand{\id}{\mathbbm 1}
\newcommand{\red}{\color{red}}
\newcommand{\david}{\color{blue}}
\newcommand{\rob}{\color{cyan}}
\newcommand{\matt}[1]{{\color{purple}#1}}
%\newcommand{\john}{\color{red}}
\newcommand{\blk}{\color{black}}
\newcommand{\blu}{\color{blue}}
%\newcommand{\beq}{\begin{equation}}
%\newcommand{\eeq}{\end{equation}}

\newcommand\ip[2]{\langle#1, #2\rangle}
\newcommand\abs[1]{|#1|}
\newcommand\norm[1]{\|#1\|}
\newcommand{\field}[1]{\mathbb {#1}}
\newcommand\w[1]{e^{\frac{2\pi i}{d}#1}}

\newcommand\pure{\mathrm{pure}}

\def\tD{\mathtt D}
\def\tF{\mathtt F}
\def\fF{\mathfrak F}
\def\fD{\mathfrak D}

\newcommand{\prep}{\mathbf{Prep}}
\newcommand{\trsf}{\mathbf{Trsf}}
\newcommand{\meas}{\mathbf{Meas}}
\newcommand{\eqclass}[1]{\operatorname{equiv}(#1)}
\newcommand{\context}[1]{\operatorname{context}(#1)}
\newcommand{\tikeq}[2][]{\begin{equation}\tikzfig{Diagrams/#2}\ #1\label{eq:#2}\end{equation}}
\newcommand\smallsquare{\mathsmaller{\mathsmaller{\mathsmaller\square}}}
\newcommand\smallboxtimes{\mathsmaller{\mathsmaller{\mathsmaller\boxtimes}}}

%------------------------------------------------------------------------

\usepackage[colorlinks=true]{hyperref} % must be loaded last


%********JOHN************
\input{preamble}
\newcommand{\john}[1]{{\color{red} #1}}
\newcommand{\jnote}[1]{{\color{red}[John: #1]}}
\newcommand{\rnote}[1]{{\color{cyan}[Rob: #1]}}
\newcommand{\xiNC}{\xi_{\rm{\kern -0.8pt n \kern -0.7pt c}}}
\usepackage{soul}
%************************

\begin{document}
\title{A structure theorem for all noncontextual ontological models of an operational theory}
%\title{A structure theorem for generalized-noncontextual ontological models}
\author{David Schmid}
\affiliation{Perimeter Institute for Theoretical Physics, 31 Caroline Street North, Waterloo, Ontario Canada N2L 2Y5}
\affiliation{Institute for Quantum Computing and Department of Physics and Astronomy, University of Waterloo, Waterloo, Ontario N2L 3G1, Canada}
\author{John H. Selby}
\affiliation{
International Centre for Theory of Quantum Technologies, University of Gda\'nsk, 80-308 Gda\'nsk, Poland}
\author{Matthew F. Pusey}
\affiliation{Department of Mathematics, University of York, Heslington, York YO10 5DD, United Kingdom}
\author{Robert W. Spekkens}
\affiliation{Perimeter Institute for Theoretical Physics, 31 Caroline Street North, Waterloo, Ontario Canada N2L 2Y5}
\begin{abstract}
It is useful to have a criterion for when the predictions of an operational theory should be considered classically explainable.  Here we take the criterion to be that the theory
admits of
 a generalized-noncontextual ontological model. Existing works on generalized noncontextuality have focused on experimental scenarios having a simple structure, typically, prepare-measure scenarios.
 Here, we formally extend the framework of ontological models as well as the principle of generalized noncontextuality to arbitrary compositional scenarios.
 %to scenarios with arbitrary causal structure.
%We leverage this process-theoretic framework to prove that, under some reasonable assumptions,  every generalized-noncontextual ontological model of a tomographically local operational theory has a surprisingly rigid and simple mathematical structure---in short, it corresponds to a frame representation which is not overcomplete.
We leverage this process-theoretic framework to prove that, under some reasonable assumptions (e.g. tomographic locality),  every generalized-noncontextual ontological model of an operational theory 
%whose corresponding generalized probabilistic theory is tomographically local has a surprisingly rigid and simple mathematical structure
---in short, it corresponds to a frame representation which is not overcomplete. 
One consequence of this theorem is that the largest number of ontic states possible in any such model is given by the dimension of the associated generalized probabilistic theory. This constraint is useful for generating noncontextuality no-go theorems as well as techniques for experimentally certifying contextuality.
Along the way, we extend known results concerning the equivalence of different notions of classicality from prepare-measure scenarios to arbitrary compositional scenarios.
%causal structures.
Specifically, we prove a correspondence between
%the equivalence of
 the following three notions of classical explainability of an operational theory: (i) admitting a noncontextual ontological model, (ii) admitting of a positive quasiprobability representation, and (iii) being simplex-embeddable.
% (ii) defining a generalized probabilistic theory that admits of a positive quasiprobability representation, and (iii) defining a generalized probabilistic theory that is simplex-embeddable.
\end{abstract}
\maketitle

{
  \hypersetup{linkcolor=purple}
  \tableofcontents
}

\section{Introduction}

For a given operational theory, under what circumstances is it appropriate to say that its predictions admit of a classical explanation? This article starts with the presumption that this question is best answered as follows:
the operational theory must admit of an ontological model that satisfies the principle of generalized noncontextuality, defined in Ref.~\cite{Spekkens2005}.
Admitting of a generalized-noncontextual ontological model subsumes several other notions of classical explainability,
such as admitting of a positive quasiprobability representation~\cite{Spekkens2008,ferrie2008frame}, admitting of a locally causal model~\cite{Bell,Bellreview}, and being embeddable in a simplicial generalized probabilistic theory (GPT)~\cite{schmid2019characterization,shahandeh2019contextuality}.   Additionally, generalized noncontextuality can be motivated as an instance of a methodological principle for theory construction due to Leibniz, as argued in Ref.~\cite{Leibniz} and the appendix of Ref.~\cite{Mazurek2016}.
Finally, operational theories that fail to admit of a generalized-noncontextual ontological model provide advantages for information processing relative to their classically explainable counterparts~\cite{POM,RAC,RAC2,Saha_2019,saha2019preparation,MESD,Lostaglio2020contextualadvantage,magic,comp1,comp2}.  Because the notion of generalized noncontextuality is the only one we consider in this article, we will often refer to it simply as `noncontextuality'.


While an operational theory simply makes predictions for the statistics of outcomes in any given experimental arrangement, an ontological model thereof is an attempt to explain these predictions in a particular way.  It presumes that the systems passing between experimental devices have properties, and that the complete set of these properties for a given system, termed its {\em ontic state}, mediates causal influences between the devices.  For instance, in the case of an experiment wherein a system is prepared and then measured (known as a `prepare-measure scenario'), any correlations between the outcome of the measurement and the choice of the preparation is to be explained entirely in terms of the dependence of the ontic state of the system on the preparation procedure and the dependence of the measurement outcome on the ontic state of the system.
The principle of noncontextuality imposes additional constraints on how experimental procedures are represented in the ontological model, and whether or not a given operational theory admits of a representation satisfying these constraints determines whether it is classically explainable or not.

Prepare-measure scenarios are the experimental arrangements for which the consequences of generalized noncontextuality have been most explored.
A few works have also studied experiments where there is a transformation or an instrument intervening between the preparation and the measurement~\cite{lillystone2019single,PP1,PP2,AWV,AWVrobust,Lostaglio2020contextualadvantage}.
% or where there is a sequence of transformations.
However, generalized noncontextuality has not previously been considered in
experimental scenarios wherein the component procedures are connected together in arbitrary ways, that is, in arbitrary compositional scenarios.
%experimental scenarios with arbitrary compositional structure.
%causally connected together in arbitrary ways, that is, in experimental scenarios with arbitrary causal structure.

In this work, we provide a process-theoretic \cite{coecke2015categorical,coecke2017picturing,selbyReconstruction,gogioso2017categorical} framework for describing operational theories and ontological models thereof, such that one can
 represent scenarios with arbitrary compositional scenarios.
 %causal structures.
 As it applies to operational theories, our framework is a fairly straightforward adaptation of existing approaches, such as those of Refs.~\cite{chiribella2010probabilistic,hardy2011reformulating,gogioso2017categorical,coecke2017picturing}.\footnote{It is also worth noting that the framework presented here is a precursor to a more novel framework, to be presented in
forthcoming work \cite{schmid2020unscrambling}, that is motivated by the objective of
 cleanly separating
the causal and inferential aspects of operational theories and ontological theories.}  As it applies to ontological and quasiprobabilistic models, there are close connections to the works of Refs.~\cite{van2017quantum,gheorghiu2019ontological}, which are phrased more categorically.
%the more categorically phrased,
 (Indeed, Ref.~\cite{van2017quantum} influenced our thinking in early stages of this project.)
We also extend the definition of quasiprobabilistic models of quantum theory to a definition of quasiprobabilistic models of arbitrary Generalized Probabilistic Theories~\cite{hardy2001quantum,barrett2007,chiribella2010probabilistic,hardy2011reformulating} (GPTs), as Ref.~\cite{van2017quantum} suggested could be done.

We prove a number of results within this framework, some of which are extensions of results that have already been proven for prepare-measure scenarios.
For example, we extend (from prepare-measure scenarios to arbitrary compositional scenarios)
%scenarios with arbitrary causal structure)
 the proof that positive quasiprobabilistic models are in one-to-one correspondence with
 %equivalent to
noncontextual ontological models~\cite{Spekkens2008}.
We also show that  the framework of GPTs is recovered when one quotients an operational theory with respect to operational equivalences (note that in some frameworks, e.g., Ref.~\cite{chiribella2010probabilistic}, this is essentially taken as the {\em definition} of GPTs).
This allows us to extend the result of Refs.~\cite{schmid2019characterization,shahandeh2019contextuality}---that every noncontextual ontological model of an operational theory is in one-to-one correspondence with an ontological model of the associated GPT---to arbitrary compositional scenarios.
%\rnote{In Ref.~\cite{schmid2019characterization}, we showed that my previous work was misguided in a way in stating that "positive quasiprobabilistic models are equivalent to noncontextual ontological models" (as we do above) because the sort of thing that admits of a quasiprobabilistic model is a GPT, while the sort of thing that admits of a NCOM is an operational theory.  So in Ref.~\cite{schmid2019characterization}, we emphasized the equivalence of NCOM of an operational theory with an OM of the associated GPT, and then mentioned, as a sidenote, that an OM of a GPT is the same thing as a positive QPM of a GPT.  It seems to me that we should do something similar here.} \david We could replace the word equivalence above with `in one-to-one correspondence'. But John and I are both happy with it as written. Equivalence is usually a weaker notion than equality in any case, and we are of course more explicit what we mean when we get to the actual results.\blk

 Most importantly, we prove that for any operational theory whose corresponding GPT is tomographically local, every noncontextual ontological model satisfying an assumption of {\em diagram preservation}  has a rigid and simple mathematical structure. 
%Most importantly, we prove that every noncontextual ontological model of  \david an operational theory whose corresponding GPT is tomographically local [ok this is TOO bad. can someone improve it?]\blk which satisfies an assumption of {\em diagram preservation}  has a rigid and simple mathematical structure.
In particular, every such model is given by a diagram-preserving positive quasiprobabilistic model of the GPT associated with the operational theory, and we prove that every such quasiprobabilistic model is in turn a {\em frame representation}~\cite{ferrie2008frame,Ferrie_2009} that is not overcomplete.
As a corollary, it follows that the number of ontic states in any such model is no larger than the dimension of the GPT space.

This rigid structure theorem and bound on the number of ontic states shows that there is much less freedom in constructing noncontextual ontological models than previously thought.
 It also implies new proofs of the fact that operational quantum theory does not admit of a noncontextual model and simplifies the problem of witnessing contextuality experimentally.

We now summarize our main assumptions and key results in more detail.

%Our main assumptions and key results are summarized in more detail in the next section.

\subsection{Assumptions} \label{secassumptions}

The assumptions that are needed to prove our results
will be formally introduced as they become relevant.
 For the sake of having a complete list in one place, however, we provide an informal account of them here. These assumptions can be divided into two categories.

First, we have assumptions limiting the sorts of operational theories that we are considering.
\ben
\item {\bf Unique deterministic effect:} We consider only operational theories
in which all deterministic effects (corresponding to implementing a measurement on the system and marginalizing over its outcome) are operationally equivalent~\cite{chiribella2010probabilistic}.
\item {\bf Arbitrary mixtures:} We assume that every mixture of procedures within an operational theory is also an effective procedure within that operational theory. That is, for any pair of procedures in the theory, there exists a third procedure defined by flipping
a weighted coin and choosing to implement either the first or the second, depending on the outcome of the coin flip.
\item  {\bf Finite dimensionality:} We assume that the dimension of the GPT associated to the operational theory is finite.
\item {\bf Tomographic locality:} For some of our results, we moreover limit our analysis to operational theories 
%in which \david the operational equivalence classes of states \blk of a composite system can be characterized by tomographic locality, i.e., by the joint statistics of measurements that are local to the components.
 whose corresponding GPT is tomographically local (namely, where all GPT processes on composite systems can be fully characterized by probing the component systems locally).  
\een

Second, we have assumptions that concern the ontological model (or quasiprobabilistic model).
\ben
\item {\bf Deterministic effect preservation:} Any deterministic effect in the operational theory is represented by marginalization over the  sample 
%ontic
 state of the system in the ontological (or quasiprobabilistic) model.
\item {\bf Convex-Linearity:} The representation of a mixture of procedures is given by the mixture of their representations, and the representation of a coarse-graining of effects is given by the coarse-graining of their representations.
\item {\bf Empirical adequacy:} The ontological (or quasiproabilistic) representations must make the same predictions as the operational theory.
\item {\bf Diagram preservation:} The compositional structure of the ontological (or quasiprobabilistic) representation must be the same as the compositional structure of the operational theory.
\een

The most significant assumption regarding the scope of operational theories to which our results apply is that of tomographic locality.   Among the assumptions concerning the nature of the ontological (or quasiprobablistic) model, the only one that is not standard is that of diagram preservation.

As we will explain,
however, the assumption of
diagram preservation does not restrict the scope of applicability of our results; rather, it is a prescription for how one is to apply our formalism to a given scenario.
Furthermore, our main results do not require the full power of diagram preservation, but rather can be derived from the application of this assumption to a few simple scenarios: the identity operation, the prepare-measure scenario, and the measure-and-reprepare operation.
However, full diagram preservation is a natural generalization of these assumptions, as well as of a number of other standard assumptions that have been made throughout the literature on ontological models, and so we will build it into our definitions rather than endorsing only those particular instances that we need for the results in this paper.
We discuss these points in more detail in Section~\ref{revisassump}, and we will provide a defense of full diagram preservation in a forthcoming paper \cite{schmid2020unscrambling}.



\subsection{Results}

We collect our main technical results---stated informally---here.
The first result is only novel insofar as we are proving it as a connection between two preexisting frameworks, rather than taking it as the definition of a GPT, and
 the second result in this list is only novel insofar as we have extended results known in the case of prepare-measure scenarios to arbitrary scenarios. The third and fourth entries in the list are our primary results, and the expert reader may wish to skip directly to Section~\ref{mainresults}, where they are presented.

\ben
\item We prove that when one quotients an operational theory relative to operational equivalences, one obtains a GPT.
\item We prove, for any operational theory, a triple equivalence between:
\bit
\item a noncontextual ontological model of the operational theory,
 \item an ontological model of the GPT associated to the operational theory, and
\item a positive quasiprobabilistic model of the GPT associated to the operational theory.
\eit
\item We then prove a structure theorem for representations of a GPT which implies that:
\ben
\item every diagram-preserving quasiprobabilistic model of a GPT is a frame representation that is not overcomplete, i.e., an {\em exact frame representation}
\item every diagram-preserving ontological model of a GPT is a positive exact frame representation, and
\item every diagram-preserving noncontextual ontological model of an operational theory is equivalent to a positive exact frame representation of the associated GPT.
\een
\item A key corollary of these is that the cardinality of the set of ontic states for a given system in
any diagram-preserving ontological model is equal to the dimension of the state space of that system in
the GPT. For instance, a noncontextual ontological model of a qudit must have exactly $d^2$ ontic states. Similarly, the dimension of the sample space of any diagram-preserving quasiprobabilistic model is the GPT dimension.
\item Another corollary is that the ontic state space of a composite system must be the Cartesian product of the ontic state spaces of the component subsystems. That is, every diagram-preserving ontological model satisfies ontic separability.
\een

These results show that by moving beyond prepare-measure scenarios, the concept of a noncontextual ontological model of an operational theory becomes constrained to a remarkably specific and simple mathematical structure. Moreover, our bound on the number of ontic states yields new proofs of the impossibility of a noncontextual model of quantum theory (e.g., via Hardy's ontological excess baggage theorem~\cite{Hardy2004}) and dramatic simplifications to algorithms for witnessing contextuality in experimental data (e.g. reducing the algorithm introduced in Ref.~\cite{schmid2019characterization} from a hierarchy of tests to a single test).


\section{Diagrammatic Preliminaries}

In this paper we will represent
various types of theories as \emph{process theories}, which highlights the compositional structures within these theories.
We will express certain relationships that hold between these process theories in terms of \emph{diagram-preserving maps}. We give a brief introduction to this formalism here. Readers who would like a deeper understanding of this approach can read, for example, Refs.~\cite{coecke2017picturing,coecke2015categorical,selbyReconstruction,gogioso2017categorical,schmid2020unscrambling}.

A process theory $\mathcal{P}$ is specified by a collection of systems $A, B, C, ...$ and a collection of \emph{processes} on these systems.
We will represent the processes diagrammatically, e.g.,

\begin{equation} \left\{\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$f$};
		\node [style=none] (1) at (-1.5, 0.5) {};
		\node [style=none] (2) at (1.5, 0.5) {};
		\node [style=none] (3) at (1, -0.5) {};
		\node [style=none] (4) at (-1, -0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=none] (6) at (0, 0.5) {};
		\node [style=none] (7) at (0.75, 0.5) {};
		\node [style=none] (8) at (-0.5, -0.5) {};
		\node [style=none] (9) at (0.5, -0.5) {};
		\node [style=none] (10) at (-1.25, 2.25) {};
		\node [style=none] (11) at (0, 2.75) {};
		\node [style=none] (12) at (1.25, 2) {};
		\node [style=none] (13) at (-0.7500006, -2) {};
		\node [style=none] (14) at (1, -2) {};
		\node [style={right label}] (15) at (0, 2.25) {$B$};
		\node [style={right label}] (16) at (-1.25, 1.75) {$B$};
		\node [style={right label}] (17) at (1.25, 1.75) {$A$};
		\node [style={right label}] (18) at (-0.7500006, -2) {$A$};
		\node [style={right label}] (19) at (1, -2) {$C$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (10.center) to (5.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (11.center) to (6.center);
		\draw [style=qWire] (12.center) to (7.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (8.center) to (13.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (9.center) to (14.center);
	\end{pgfonlayer}
\end{tikzpicture},\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-1, 1.75) {};
		\node [style=none] (1) at (-0.4999992, 0.5000001) {};
		\node [style={right label}] (2) at (-0.7500006, 1.75) {$C$};
		\node [style=none] (3) at (0.7500006, 1.75) {};
		\node [style=none] (4) at (-1, 0.5000001) {};
		\node [style=none] (5) at (1, 0.5000001) {};
		\node [style=none] (6) at (-0.4999992, -0.5000001) {};
		\node [style=none] (7) at (0.4999992, -0.5000001) {};
		\node [style=none] (8) at (0.4999992, 0.5000001) {};
		\node [style=none] (9) at (0, -0.5000001) {};
		\node [style=none] (10) at (0, -1.5) {};
		\node [style=none] (11) at (0, -0) {$a$};
		\node [style={right label}] (12) at (0, -1.5) {$D$};
		\node [style={right label}] (13) at (0.7500006, 1.75) {$E$};
		\node [style=none] (14) at (0.2499996, -0.5000001) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (0.center) to (1.center);
		\draw (4.center) to (5.center);
		\draw (5.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw (6.center) to (4.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (3.center) to (8.center);
		\draw [style=qWire] (9.center) to (10.center);
	\end{pgfonlayer}
\end{tikzpicture},\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.7500006, -0.9999998) {};
		\node [style=none] (1) at (-0.7500006, -0) {};
		\node [style={right label}] (2) at (-0.7500006, -0.9999998) {$A$};
		\node [style=none] (3) at (-1.25, -0) {};
		\node [style=none] (4) at (0, 1.25) {};
		\node [style=none] (5) at (1.25, -0) {};
		\node [style=none] (6) at (0.4999992, -0) {};
		\node [style=none] (7) at (0.4999992, -0.9999998) {};
		\node [style=none] (8) at (0, 0.5000001) {$c$};
		\node [style={right label}] (9) at (0.4999992, -0.9999998) {$E$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (1.center) to (0.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (5.center);
		\draw (5.center) to (3.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (6.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}, \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0.7500006, -1.75) {};
		\node [style=none] (1) at (-0.7500006, -1.75) {};
		\node [style=none] (2) at (0.4999992, -0.5000001) {};
		\node [style=none] (3) at (-0.4999992, -0.5000001) {};
		\node [style={right label}] (4) at (-0.7599996, -1.5) {$B$};
		\node [style={right label}] (5) at (0.75, -1.5) {$B$};
		\node [style=none] (6) at (-1, -0.5000001) {};
		\node [style=none] (7) at (-0.4999992, 0.5000001) {};
		\node [style=none] (8) at (0.4999992, 0.5000001) {};
		\node [style=none] (9) at (1, -0.5000001) {};
		\node [style=none] (10) at (0, 0.5000001) {};
		\node [style=none] (11) at (0, 1.5) {};
		\node [style=none] (12) at (0, -0) {$b$};
		\node [style={right label}] (13) at (0, 1.5) {$D$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (2.center) to (0.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (3.center) to (1.center);
		\draw (7.center) to (8.center);
		\draw (8.center) to (9.center);
		\draw (9.center) to (6.center);
		\draw (6.center) to (7.center);
		\draw [style=qWire] (11.center) to (10.center);
	\end{pgfonlayer}
\end{tikzpicture}\right\} \subset \mathcal{P}, \end{equation}
where we work with the convention that input systems are at the bottom and output systems are at the top. We will sometimes drop system labels, when it is clear from context. Processes with no input are known as \emph{states}, those with no outputs as \emph{effects}, and those with neither inputs nor outputs as \emph{scalars}. The key feature of a process theory is that this collection of processes $\mathcal{P}$ is closed under wiring processes together to form \emph{diagrams}; for example,
\begin{equation}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$f$};
		\node [style=none] (1) at (-1.5, 0.5) {};
		\node [style=none] (2) at (1.5, 0.5) {};
		\node [style=none] (3) at (1, -0.5) {};
		\node [style=none] (4) at (-1, -0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=none] (6) at (0, 0.5) {};
		\node [style=none] (7) at (0.75, 0.5) {};
		\node [style=none] (8) at (-0.5, -0.5) {};
		\node [style=none] (9) at (0.5, -0.5) {};
		\node [style=none] (10) at (0, 2.75) {};
		\node [style=none] (11) at (-1, 2.75) {};
		\node [style=none] (12) at (1.25, 2) {};
		\node [style=none] (13) at (-1.75, -4) {};
		\node [style=none] (14) at (1, -2) {};
		\node [style={right label}] (15) at (-0.9, 2.25) {$B$};
		\node [style={right label}] (16) at (-0.1, 2.25) {$B$};
		\node [style={right label}] (17) at (1, 1.25) {$A$};
		\node [style={right label}] (18) at (-1.75, -4) {$A$};
		\node [style={right label}] (19) at (0.75, -1.25) {$C$};
		\node [style=none] (20) at (0.75, 2) {};
		\node [style=none] (21) at (2, 3.25) {};
		\node [style=none] (22) at (3.25, 2) {};
		\node [style=none] (23) at (2.5, 2) {};
		\node [style=none] (24) at (0.5, -2) {};
		\node [style=none] (25) at (2.5, -2) {};
		\node [style=none] (26) at (1, -3) {};
		\node [style=none] (27) at (2, -3) {};
		\node [style=none] (28) at (2, -2) {};
		\node [style=none] (29) at (1.5, -3) {};
		\node [style=none] (30) at (1.5, -4) {};
		\node [style=none] (31) at (-1.5, 2.75) {};
		\node [style=none] (32) at (-1, 3.75) {};
		\node [style=none] (33) at (0, 3.75) {};
		\node [style=none] (34) at (0.5, 2.75) {};
		\node [style=none] (35) at (-0.5, 3.75) {};
		\node [style=none] (36) at (-0.5, 4.75) {};
		\node [style=none] (37) at (1.5, -2.5) {$a$};
		\node [style=none] (38) at (-0.5, 3.25) {$b$};
		\node [style=none] (39) at (2, 2.5) {$c$};
		\node [style={right label}] (40) at (1.5, -4) {$D$};
		\node [style={right label}] (41) at (2.25, 0) {$E$};
		\node [style={right label}] (42) at (-0.5, 4.75) {$D$};
		\node [style=none] (43) at (1.75, -3) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (10.center) to (5.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (11.center) to (6.center);
		\draw [style=qWire] (12.center) to (7.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (8.center) to (13.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (9.center) to (14.center);
		\draw (20.center) to (21.center);
		\draw (21.center) to (22.center);
		\draw (22.center) to (20.center);
		\draw (24.center) to (25.center);
		\draw (25.center) to (27.center);
		\draw (27.center) to (26.center);
		\draw (26.center) to (24.center);
		\draw (32.center) to (33.center);
		\draw (33.center) to (34.center);
		\draw (34.center) to (31.center);
		\draw (31.center) to (32.center);
		\draw [style=qWire] (36.center) to (35.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (23.center) to (28.center);
		\draw [style=qWire] (29.center) to (30.center);
	\end{pgfonlayer}
\end{tikzpicture}
 \in \mathcal{P}. \end{equation}
Wirings of processes must connect outputs to inputs such that systems match and no cycles are created.

We will commonly draw `clamp'-shaped higher-order processes such as:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1.25) {};
		\node [style=none] (1) at (0, -1.25) {};
		\node [style=none] (2) at (-0.5, 1.25) {};
		\node [style=none] (3) at (-0.5, 1.75) {};
		\node [style=none] (4) at (1.75, 1.75) {};
		\node [style=none] (5) at (1.75, -1.75) {};
		\node [style=none] (6) at (-0.5, -1.75) {};
		\node [style=none] (7) at (-0.5, -1.25) {};
		\node [style=none] (8) at (0.75, 1.25) {};
		\node [style=none] (9) at (0.75, -1.25) {};
		\node [style=none] (10) at (1.25, 0) {$\tau$};
		\node [style={right label}] (11) at (0, -1) {$A$};
		\node [style={right label}] (12) at (0, 0.75) {$B$};
		\node [style=none] (13) at (0, 0.5000002) {};
		\node [style=none] (14) at (0, -0.7499998) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (2.center);
		\draw (2.center) to (8.center);
		\draw (8.center) to (9.center);
		\draw (9.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw[qWire] (0.center) to (13.center);
		\draw [qWire](14.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
which we call \emph{testers}. These can be thought of as something which maps a process from $A$ to $B$ to a scalar  via:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$T$};
		\node [style=none] (1) at (0, 1.25) {};
		\node [style=none] (2) at (0, -1.25) {};
		%\node [style=none] (3) at (-0.5, 1.25) {};
		%\node [style=none] (4) at (-0.5, 1.75) {};
		%\node [style=none] (5) at (1.75, 1.75) {};
		%\node [style=none] (6) at (1.75, -1.75) {};
		%\node [style=none] (7) at (-0.5, -1.75) {};
		%\node [style=none] (8) at (-0.5, -1.25) {};
		%\node [style=none] (9) at (0.75, 1.25) {};
		%\node [style=none] (10) at (0.75, -1.25) {};
		%\node [style=none] (11) at (1.25, 0) {$\tau$};
		\node [style=right label] (12) at (0, -1) {$A$};
		\node [style=right label] (13) at (0, 0.75) {$B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		%\draw (7.center) to (6.center);
		%\draw (6.center) to (5.center);
		%\draw (5.center) to (4.center);
		%\draw (4.center) to (3.center);
		%\draw (3.center) to (9.center);
		%\draw (9.center) to (10.center);
		%\draw (10.center) to (8.center);
		%\draw (8.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad\mapsto\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$T$};
		\node [style=none] (1) at (0, 1.25) {};
		\node [style=none] (2) at (0, -1.25) {};
		\node [style=none] (3) at (-0.5, 1.25) {};
		\node [style=none] (4) at (-0.5, 1.75) {};
		\node [style=none] (5) at (1.75, 1.75) {};
		\node [style=none] (6) at (1.75, -1.75) {};
		\node [style=none] (7) at (-0.5, -1.75) {};
		\node [style=none] (8) at (-0.5, -1.25) {};
		\node [style=none] (9) at (0.75, 1.25) {};
		\node [style=none] (10) at (0.75, -1.25) {};
		\node [style=none] (11) at (1.25, 0) {$\tau$};
		\node [style=right label] (12) at (0, -1) {$A$};
		\node [style=right label] (13) at (0, 0.75) {$B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw (7.center) to (6.center);
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (9.center);
		\draw (9.center) to (10.center);
		\draw (10.center) to (8.center);
		\draw (8.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
These are not primitive notions within the framework of process theories and instead are always thought of as being built out of particular state, effect and auxiliary system. In other words, the tester $\tau$ is really just shorthand notation for a triple $(s_\tau,e_\tau,W_\tau)$ where:
\beq\label{eq:tester}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1.25) {};
		\node [style=none] (1) at (0, -1.25) {};
		\node [style=none] (2) at (-0.5, 1.25) {};
		\node [style=none] (3) at (-0.5, 1.75) {};
		\node [style=none] (4) at (1.75, 1.75) {};
		\node [style=none] (5) at (1.75, -1.75) {};
		\node [style=none] (6) at (-0.5, -1.75) {};
		\node [style=none] (7) at (-0.5, -1.25) {};
		\node [style=none] (8) at (0.75, 1.25) {};
		\node [style=none] (9) at (0.75, -1.25) {};
		\node [style=none] (10) at (1.25, 0) {$\tau$};
		\node [style={right label}] (11) at (0, -1) {$A$};
		\node [style={right label}] (12) at (0, 0.75) {$B$};
		\node [style=none] (13) at (0, 0.5000002) {};
		\node [style=none] (14) at (0, -0.7499998) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (2.center);
		\draw (2.center) to (8.center);
		\draw (8.center) to (9.center);
		\draw (9.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw[qWire] (0.center) to (13.center);
		\draw [qWire](14.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0.2500001, 1.25) {};
		\node [style=none] (1) at (0.2500001, -1.25) {};
		\node [style={right label}] (2) at (0.2500001, -0.9999999) {$A$};
		\node [style={right label}] (3) at (0.2500001, 0.7499998) {$B$};
		\node [style=none] (4) at (0.2500001, 0.5000002) {};
		\node [style=none] (5) at (0.2500001, -0.7499998) {};
		\node [style=none] (6) at (-0.5000002, -1.25) {};
		\node [style=none] (7) at (0.9999999, -2.5) {};
		\node [style=none] (8) at (2.5, -1.25) {};
		\node [style=none] (9) at (2.75, 1.25) {};
		\node [style=none] (10) at (-0.5000002, 1.25) {};
		\node [style=none] (11) at (1.25, 2.5) {};
		\node [style=none] (12) at (2, 1.25) {};
		\node [style=none] (13) at (2, -1.25) {};
		\node [style=none] (14) at (0.9999999, -1.75) {$s_\tau$};
		\node [style=none] (15) at (1.25, 1.75) {$e_\tau$};
		\node [style={right label}] (16) at (2, -0) {$W_\tau$};
		\node [style=none] (17) at (0.7500002, -1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (4.center);
		\draw [qWire] (5.center) to (1.center);
		\draw (10.center) to (9.center);
		\draw (9.center) to (11.center);
		\draw (11.center) to (10.center);
		\draw (6.center) to (7.center);
		\draw (7.center) to (8.center);
		\draw (8.center) to (6.center);
		\draw[qWire] (12.center) to (13.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq


A diagram-preserving map \colorbox{PineGreen!20}{$\eta : \mathcal{P} \to \mathcal{P}'$} from one process theory $\mathcal{P}$ to another, $\mathcal{P}'$, is defined as a map taking
systems in $\mathcal{P}$ to systems in $\mathcal{P}'$, denoted as
\beq
S \to \eta(S),
\eeq
and processes in $\mathcal{P}$ to processes in $\mathcal{P}'$. Taking inspiration from \cite{fritz2018bimonoidal} this will be depicted diagrammatically as
\beq
\eta :: \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style={small box}] (0) at (0, -0) {$f$};
		\node [style=none] (1) at (0, 1.25) {};
		\node [style=none] (2) at (0, -1.25) {};
		\node [style={right label}] (3) at (0, 0.75) {$B$};
		\node [style={right label}] (4) at (0, -1) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2.center) to (0);
		\draw [qWire] (0) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture} \mapsto \tikzfig{Diagrams/3_DPM3}
,
\eeq
such that wiring together processes before or after applying the map is equivalent, that is:
\begin{equation}\label{eq:DPM}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$f$};
		\node [style=none] (1) at (-1.5, 0.5) {};
		\node [style=none] (2) at (1.5, 0.5) {};
		\node [style=none] (3) at (1, -0.5) {};
		\node [style=none] (4) at (-1, -0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=none] (6) at (0, 0.5) {};
		\node [style=none] (7) at (0.75, 0.5) {};
		\node [style=none] (8) at (-0.5, -0.5) {};
		\node [style=none] (9) at (0.5, -0.5) {};
		\node [style=none] (10) at (0, 2.75) {};
		\node [style=none] (11) at (-1, 2.75) {};
		\node [style=none] (12) at (1.25, 2) {};
		\node [style=none] (13) at (-1.749999, -5) {};
		\node [style=none] (14) at (1, -2) {};
		\node [style={right label}] (15) at (-0.9, 2.25) {$B$};
		\node [style={right label}] (16) at (-0.1, 2.25) {$B$};
		\node [style={right label}] (17) at (1, 1.25) {$A$};
		\node [style={right label}] (18) at (-1.5, -3.5) {$A$};
		\node [style={right label}] (19) at (0.75, -1.25) {$C$};
		\node [style=none] (20) at (0.75, 2) {};
		\node [style=none] (21) at (2, 3.25) {};
		\node [style=none] (22) at (3.25, 2) {};
		\node [style=none] (23) at (2.5, 2) {};
		\node [style=none] (24) at (0.5, -2) {};
		\node [style=none] (25) at (2.5, -2) {};
		\node [style=none] (26) at (1, -3) {};
		\node [style=none] (27) at (2, -3) {};
		\node [style=none] (28) at (2, -2) {};
		\node [style=none] (29) at (1.5, -3) {};
		\node [style=none] (30) at (1.5, -5) {};
		\node [style=none] (31) at (-1.5, 2.75) {};
		\node [style=none] (32) at (-1, 3.75) {};
		\node [style=none] (33) at (0, 3.75) {};
		\node [style=none] (34) at (0.5, 2.75) {};
		\node [style=none] (35) at (-0.5, 3.75) {};
		\node [style=none] (36) at (-0.5000001, 6) {};
		\node [style=none] (37) at (1.5, -2.5) {$a$};
		\node [style=none] (38) at (-0.5, 3.25) {$b$};
		\node [style=none] (39) at (2, 2.5) {$c$};
		\node [style={right label}] (40) at (1.5, -3.5) {$D$};
		\node [style={right label}] (41) at (2.25, 0) {$E$};
		\node [style={right label}] (42) at (-0.5000001, 4.5) {$D$};
		\node [style=none] (43) at (1.75, -3) {};
		\node [style=none] (44) at (-3.000001, -4) {};
		\node [style=none] (45) at (4.000001, -4) {};
		\node [style=none] (46) at (4.000001, 5) {};
		\node [style=none] (47) at (-3.000001, 5) {};
		\node [style=none] (48) at (3.75, -3.75) {\tiny$\eta$};
		\node [style=right label] (49) at (-0.4999999, 5.5) {$\eta(D)$};
		\node [style=right label] (50) at (-1.750001, -4.75) {$\eta(A)$};
		\node [style=right label] (51) at (1.5, -4.75) {$\eta(D)$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
\filldraw[fill=PineGreen!20,draw=PineGreen!40] (44.center) to (45.center) to (46.center) to (47.center) to cycle;
\filldraw[fill=white,draw=black]  (20.center) to (21.center) to (22.center) to cycle;
		\filldraw[fill=white,draw=black]  (24.center) to (25.center) to (27.center) to (26.center) to cycle;
		\filldraw[fill=white,draw=black]  (32.center) to (33.center) to (34.center) to (31.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (10.center) to (5.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (11.center) to (6.center);
		\draw [style=qWire] (12.center) to (7.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (8.center) to (13.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (9.center) to (14.center);
		\draw [style=qWire] (36.center) to (35.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (23.center) to (28.center);
		\draw [style=qWire] (29.center) to (30.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.4999999, 0.2500001) {$f$};
		\node [style=none] (1) at (-2, 0.7500001) {};
		\node [style=none] (2) at (0.9999999, 0.7500001) {};
		\node [style=none] (3) at (0.5000003, -0.2500001) {};
		\node [style=none] (4) at (-1.5, -0.2500001) {};
		\node [style=none] (5) at (-1.25, 0.7500001) {};
		\node [style=none] (6) at (-0.4999999, 0.7500001) {};
		\node [style=none] (7) at (0.2499998, 0.7500001) {};
		\node [style=none] (8) at (-0.9999999, -0.2500001) {};
		\node [style=none] (9) at (0, -0.2500001) {};
		\node [style=none] (10) at (-0.4999999, 4.5) {};
		\node [style=none] (11) at (-1.5, 4.5) {};
		\node [style=none] (12) at (2, 3.5) {};
		\node [style=none] (13) at (-2.25, -5.75) {};
		\node [style=none] (14) at (0.4999999, -3) {};
		\node [style=none] (15) at (1.5, 3.5) {};
		\node [style=none] (16) at (2.75, 4.75) {};
		\node [style=none] (17) at (4, 3.5) {};
		\node [style=none] (18) at (3.25, 3.5) {};
		\node [style=none] (19) at (0, -3) {};
		\node [style=none] (20) at (2, -3) {};
		\node [style=none] (21) at (0.4999999, -4) {};
		\node [style=none] (22) at (1.5, -4) {};
		\node [style=none] (23) at (1.5, -3) {};
		\node [style=none] (24) at (1, -4) {};
		\node [style=none] (25) at (1, -6) {};
		\node [style=none] (26) at (-2, 4.5) {};
		\node [style=none] (27) at (-1.5, 5.5) {};
		\node [style=none] (28) at (-0.4999999, 5.5) {};
		\node [style=none] (29) at (0, 4.5) {};
		\node [style=none] (30) at (-0.9999999, 5.5) {};
		\node [style=none] (31) at (-0.9999999, 7) {};
		\node [style=none] (32) at (1, -3.5) {$a$};
		\node [style=none] (33) at (-0.9999999, 5) {$b$};
		\node [style=none] (34) at (2.75, 4) {$c$};
		\node [style=none] (35) at (1.25, -4) {};
		\node [style=none] (36) at (-0.4999999, -5) {};
		\node [style=none] (37) at (2.5, -5) {};
		\node [style=none] (38) at (2.5, -2.25) {};
		\node [style=none] (39) at (-0.4999999, -2.25) {};
		\node [style=none] (40) at (2.25, -4.75) {\tiny$\eta$};
		\node [style=none] (41) at (0.2500001, 3.75) {\tiny$\eta$};
		\node [style=none] (42) at (4.25, 2.75) {\tiny$\eta$};
		\node [style=none] (43) at (0.9999999, -1) {\tiny$\eta$};
		\node [style=none] (44) at (-2.5, 6.25) {};
		\node [style=none] (45) at (-2.5, 3.5) {};
		\node [style=none] (46) at (0.4999999, 3.5) {};
		\node [style=none] (47) at (0.4999999, 6.25) {};
		\node [style=none] (48) at (1, 5.25) {};
		\node [style=none] (49) at (1.25, 1.75) {};
		\node [style=none] (50) at (4.5, 2.5) {};
		\node [style=none] (51) at (4.5, 5.25) {};
		\node [style=none] (52) at (1.25, -1.25) {};
		\node [style=none] (53) at (-2.5, -1.25) {};
		\node [style=none] (54) at (-2.5, 1.75) {};
		\node [style=none] (55) at (1, 2.5) {};
		\node [style={right label}] (56) at (-0.9999999, 5.75) {$D$};
		\node [style={right label}] (57) at (-1.5, 4) {$B$};
		\node [style={right label}] (58) at (-0.4999999, 4) {$B$};
		\node [style={right label}] (59) at (-1.25, 1.25) {$B$};
		\node [style={right label}] (60) at (-0.4999999, 1.25) {$B$};
		\node [style={right label}] (61) at (2, 3) {$A$};
		\node [style={right label}] (62) at (3.25, 3) {$E$};
		\node [style={right label}] (63) at (0.5000003, 1.25) {$A$};
		\node [style={right label}] (64) at (-0.9999999, -0.7499998) {$A$};
		\node [style={right label}] (65) at (0, -0.7499998) {$C$};
		\node [style={right label}] (66) at (0.4999999, -2.75) {$C$};
		\node [style={right label}] (67) at (1.5, -2.75) {$E$};
		\node [style={right label}] (68) at (1, -4.5) {$D$};
		\node [style={right label}] (69) at (-0.9999999, 6.75) {$\eta(D)$};
		\node [style={right label}] (70) at (-0.7500001, 3) {$\eta(B)$};
		\node [style={right label}] (71) at (-0.7500001, 2.25) {$\eta(B)$};
		\node [style={right label}] (72) at (2.75, 0.7500001) {$\eta(E)$};
		\node [style={right label}] (73) at (-2.25, -5.25) {$\eta(A)$};
		\node [style={right label}] (74) at (1, -5.5) {$\eta(D)$};
		\node [style={right label}] (75) at (0.2500001, -1.75) {$\eta(C)$};
		\node [style={right label}] (76) at (1.25, 2) {$\eta(A)$};
		\node [style=none] (77) at (3.25, 6.25) {};
		\node [style=none] (78) at (-1.5, 5.5) {};
		\node [style=none] (79) at (-0.4999999, 5.5) {};
		\node [style=none] (80) at (0, 4.5) {};
		\node [style=none] (81) at (-2, 4.5) {};
		\node [style=none] (82) at (2.75, 4.75) {};
		\node [style=none] (83) at (4, 3.5) {};
		\node [style=none] (84) at (1.5, 3.5) {};
		\node [style=none] (85) at (-2, 0.7500001) {};
		\node [style=none] (86) at (0.9999999, 0.7500001) {};
		\node [style=none] (87) at (0.5000003, -0.2500001) {};
		\node [style=none] (88) at (-1.5, -0.2500001) {};
		\node [style=none] (89) at (0, -3) {};
		\node [style=none] (90) at (2, -3) {};
		\node [style=none] (91) at (1.5, -4) {};
		\node [style=none] (92) at (0.4999999, -4) {};
		\node [style=none] (93) at (-2.5, 6.25) {};
		\node [style=none] (94) at (0.4999999, 6.25) {};
		\node [style=none] (95) at (0.4999999, 3.5) {};
		\node [style=none] (96) at (-2.5, 3.5) {};
		\node [style=none] (97) at (1, 5.25) {};
		\node [style=none] (98) at (4.5, 5.25) {};
		\node [style=none] (99) at (4.5, 2.5) {};
		\node [style=none] (100) at (1, 2.5) {};
		\node [style=none] (101) at (-2.5, 1.75) {};
		\node [style=none] (102) at (1.25, 1.75) {};
		\node [style=none] (103) at (1.25, -1.25) {};
		\node [style=none] (104) at (-2.5, -1.25) {};
		\node [style=none] (105) at (-0.4999999, -2.25) {};
		\node [style=none] (106) at (2.5, -2.25) {};
		\node [style=none] (107) at (2.5, -5) {};
		\node [style=none] (108) at (-0.4999999, -5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
\filldraw[fill=PineGreen!20,draw=PineGreen!40] (108.center) to (107.center) to (106.center) to (105.center) to cycle;
		\filldraw[fill=PineGreen!20,draw=PineGreen!40] (104.center) to (103.center) to (102.center) to (101.center) to cycle;
		\filldraw[fill=PineGreen!20,draw=PineGreen!40] (100.center) to (99.center) to (98.center) to (97.center) to cycle;
		\filldraw[fill=PineGreen!20,draw=PineGreen!40] (96.center) to (95.center) to (94.center) to (93.center) to cycle;
		\filldraw[fill=white,draw=black] (92.center) to (91.center) to (90.center) to (89.center) to cycle;
\filldraw[fill=white,draw=black]  (84.center) to (83.center) to (82.center) to cycle;
		\filldraw[fill=white,draw=black]  (88.center) to (87.center) to (86.center) to (85.center) to cycle;
		\filldraw[fill=white,draw=black]  (81.center) to (80.center) to (79.center) to (78.center) to cycle;
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (10.center) to (5.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (11.center) to (6.center);
		\draw [style=qWire, in=90, out=-90, looseness=0.75] (12.center) to (7.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (8.center) to (13.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (9.center) to (14.center);
		\draw [style=qWire] (31.center) to (30.center);
		\draw [style=qWire, in=90, out=-90, looseness=1.00] (18.center) to (23.center);
		\draw [style=qWire] (24.center) to (25.center);
	\end{pgfonlayer}
\end{tikzpicture}
. \end{equation}

We will also use the concept of a sub-process theory, where $\mathcal{P}'$ is a sub-process theory of $\mathcal{P}$, denoted $\mathcal{P}' \subseteq \mathcal{P}$, if and only if the processes in $\mathcal{P}'$ are a subset of the processes in $\mathcal{P}$ that are themselves closed under forming diagrams.

The key process theory which underpins this work is $\RL$, defined as follows:

\begin{example}[$\RL$]
Systems are labeled by
real vector spaces $V$ where the composition of systems $V$ and $W$ is given by the tensor product $V\otimes W$. Processes
are defined as linear maps from the input vector space to the output vector space. Composing two processes in sequence corresponds to composing the linear maps, while composing them in parallel corresponds to the tensor product of the maps. If a process lacks an input and/or an output then we view them as linear maps to or from the one-dimensional vector space $\mathds{R}$. Hence, processes with no input correspond to vectors in $V$ and processes with no output to covectors, i.e., elements of $V^*$. This implies that {\em scalars}---processes with neither inputs nor outputs---correspond to real numbers.
\end{example}

If one restricts attention to finite-dimensional vector spaces, then $\RL$ is equivalent to the process theory of real-valued matrices. However, representing the former in terms of the latter requires artificially choosing a preferred basis for the vector spaces.

We will also be interested in two theories which are sub-process theories of $\RL$ (which, in contrast to $\RL$, {\em do} come equipped with a preferred basis).

The first is the process theory of (sub)stochastic processes. Here, systems are labeled by finite sets
$\Lambda$ which compose via the Cartesian product. Processes with input $\Lambda$ and output $\Lambda'$ correspond to (sub)stochastic maps, and can be thought of as functions
\beq
f:\Lambda\times\Lambda' \to [0,1] :: (\lambda,\lambda')\mapsto f(\lambda'|\lambda)
\eeq
where for all $\lambda\in\Lambda$ we have $\sum_{\lambda'\in\Lambda'} f(\lambda'|\lambda) \leq 1$. When this inequality is an equality, they are said to be {\em stochastic} (rather than substochastic).
For any pair of functions $f: \Lambda \times \Lambda'\to[0,1]$ and $g: \Lambda' \times \Lambda''\to[0,1]$ (where the output type of $f$ matches the input type of $g$), sequential composition is given by $g \circ f:\Lambda\times\Lambda''\to[0,1]$ via the following rule for composing the functions:
\beq
g\circ f (\lambda''|\lambda) := \sum_{\lambda'\in\Lambda'} g(\lambda''|\lambda')f(\lambda'|\lambda).
\eeq
For any pair of functions $f: \Lambda \times \Lambda'\to[0,1]$ and $g: \Lambda'' \times \Lambda'''\to[0,1]$, parallel composition is given by $g \otimes f:(\Lambda'\times\Lambda) \times (\Lambda'''\times\Lambda'')\to[0,1]$ via:
\beq
g\otimes f ((\lambda''',\lambda'')|(\lambda',\lambda)):= g(\lambda'''|\lambda')f(\lambda''|\lambda).
\eeq

It is sometimes more convenient or natural to take an alternative (but equivalent) point of view on this process theory (e.g., this view makes it more clear that this is a sub-process theory of $\RL$). In this alternative view, the systems are not simply given by finite sets $\Lambda$, but rather are taken to be the vector space of functions from $\Lambda$ to $\mathds{R}$, denoted $\mathds{R}^\Lambda$. Then, rather than taking the processes to be functions $f:\Lambda\times \Lambda'\to[0,1]$, one takes them to be linear maps from $\mathds{R}^\Lambda$ to $\mathds{R}^{\Lambda'}$, denoted by:
\beq
\mathbf{f}:\mathds{R}^\Lambda \to \mathds{R}^{\Lambda'}:: \mathbf{v}\mapsto \mathbf{f}(\mathbf{v})
\eeq
where for all $\lambda'\in\Lambda'$, we define
$\mathbf{f(v)}(\lambda') := \sum_{\lambda\in\Lambda} f(\lambda'|\lambda)\mathbf{v}(\lambda)$. It is then straightforward to show that sequential composition of the stochastic processes corresponds to composition of the associated linear maps and that parallel composition of the stochastic processes corresponds to the tensor product of the associated linear maps. For example, for sequential composition we have that for all $\mathbf{v}\in\mathds{R}^\Lambda$,
\begin{align}
\mathbf{(g\circ f)(v)}(\lambda'') &= \sum_{\lambda\in\Lambda}g\circ f(\lambda''|\lambda)\mathbf{v}(\lambda) \\
&= \sum_{\lambda\in\Lambda}\sum_{\lambda'\in\Lambda'}g(\lambda''|\lambda')f(\lambda'|\lambda)\mathbf{v}(\lambda)\\
&= \sum_{\lambda'\in\Lambda'}g(\lambda''|\lambda')\left(\sum_{\lambda\in\Lambda}f(\lambda'|\lambda)\mathbf{v}(\lambda)\right)\\
&= \sum_{\lambda'\in\Lambda}g(\lambda''|\lambda')\mathbf{f(v)}(\lambda)\\
&= \mathbf{g(f(v))}(\lambda)
\end{align}
Moreover, consider processes with no input---that is, linear maps $\mathbf{p}:\mathds{R}\to\mathds{R}^\Lambda$. By using the trivial isomorphism $\mathds{R}\cong \mathds{R}^\star$ where $\star$ is the singleton set $\star:=\{*\}$, one can see that these correspond to functions $p:\star\times\Lambda\to[0,1]$ such that $\sum_{\lambda\in\Lambda}p(\lambda|*)\leq 1$; following standard conventions, we can denote this as $p(\lambda):= p(\lambda|*)$. So $\mathbf{p}$ just corresponds to a subnormalised probability distribution, as expected. Similarly, processes with no output, such as $\mathbf{r}:\mathds{R}^\Lambda\to\mathds{R}$,  correspond to \emph{response functions}, that is, functions $r:\Lambda\times\star\to[0,1]$ such that for all $\lambda$ one has $r(\lambda):=r(*|\lambda) \in [0,1]$. Finally, it follows that processes with neither inputs nor outputs, $\mathbf{s}:\mathds{R}\to\mathds{R}$, correspond to elements of $[0,1]$, i.e., to probabilities.


Summarizing the above, we have:
\begin{example}[$\SubS$]
We define $\SubS$ as a subtheory of $\RL$ where systems are restricted to vector spaces of the form $\mathds{R}^\Lambda$ and processes are restricted to those that correspond to (sub)stochastic maps.
\end{example}

The second subtheory of $\RL$ is $\QSS$, which is the same as the process theory of (sub)stochastic processes, but where the constraint of positivity is dropped. The systems can be taken to be finite sets $\Lambda$, and the processes with input $\Lambda$ and output $\Lambda'$ can be taken to be
functions
\beq
f:\Lambda\times \Lambda' \to \mathds{R} :: (\lambda,\lambda')\mapsto f(\lambda'|\lambda),
\eeq
These are said to be quasistochastic (as opposed to quasisubstochastic) if they moreover satisfy  $\sum_{\lambda\in\Lambda'}f(\lambda'|\lambda) = 1$ for all $\lambda\in\Lambda$. The way that these compose and are represented in $\RL$ is exactly the same as in the case of substochastic maps.

Summarizing, we have
\begin{example}[$\QSS$]
We define $\QSS$ as the subtheory of $\RL$ where systems are restricted to vector spaces of the form $\mathds{R}^\Lambda$ and processes are those that correspond to quasi(sub)stochastic maps.
\end{example}

By construction, $\SubS \subset \QSS \subset \RL$. It is known that quantum theory as a GPT ($\mathbf{QT}$) can be represented as a subtheory of $\QSS$ (see, for example, \cite{van2017quantum}).

\section{Operational theories}


We now introduce a process-theoretic presentation of the framework of operational theories as defined in  Ref.~\cite{Spekkens2005},
%Ref.~\cite{Harrigan}, 
resulting in a framework that is essentially that of (unquotiented) operational probabilistic theories~\cite{chiribella2010probabilistic}.
An operational theory $\Op$ is given by a process theory specifying a set of physical systems and the processes which act on them (where processes are viewed as lists of lab instructions), together with a rule for assigning probabilities to any closed process.
A generic laboratory procedure has an associated set of inputs and outputs, and will be denoted diagrammatically as:
\tikeq[.]{transf}
Of special interest are processes with no inputs and processes with no outputs, depicted respectively as
\begin{equation}
\tikzfig{Diagrams/prep}\ ,\
\tikzfig{Diagrams/effect}\
\label{prep}.
\end{equation}
The former is viewed as a \emph{preparation procedure} and the latter is viewed as an effect, corresponding to some outcome of some measurement.
We depict the probability rule by a map $p$, as
\beq
\tikzfig{Diagrams/probrule} = \Pr(E,P) \in [0,1]
\label{probrule}.
\eeq
That is, the application of $p$ on any closed diagram yields a real number between $0$ and $1$. Note that this is not a diagram-preserving map as it can only be applied to processes with no input and no output. (Nonetheless, we will see shortly how it has a diagram-preserving extension to arbitrary processes---namely, the quotienting map).

This probability rule must be
compatible with certain relations that hold between procedures.
First, it must factorise over separated diagrams, for example,
\begin{align}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, 0.5) {$E_1$};
		\node [style=point] (1) at (0, -0.5) {$P_1$};
		\node [style=none] (2) at (-1.25, 1.5) {};
		\node [style=none] (3) at (3, 1.5) {};
		\node [style=none] (4) at (3, -1.5) {};
		\node [style=none] (5) at (-1.25, -1.5) {};
		\node [style=none] (6) at (2.75, -1.25) {\tiny $p$};
		\node [style=point] (7) at (1.75, -0.5) {$P_2$};
		\node [style=copoint] (8) at (1.75, 0.5) {$E_2$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (2.center) to (5.center) to (4.center) to (3.center) to cycle;
		\draw [style=qWire] (0) to (1);
		\draw [style=qWire] (8) to (7);
	\end{pgfonlayer}
\end{tikzpicture}
\quad &= \quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, 0.5) {$E_1$};
		\node [style=point] (1) at (0, -0.5) {$P_1$};
		\node [style=none] (2) at (-1.25, 1.5) {};
		\node [style=none] (3) at (1.25, 1.5) {};
		\node [style=none] (4) at (1.25, -1.5) {};
		\node [style=none] (5) at (-1.25, -1.5) {};
		\node [style=none] (6) at (1, -1.25) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (2.center) to (5.center) to (4.center) to (3.center) to cycle;
				\draw [style=qWire] (0) to (1);
	\end{pgfonlayer}
\end{tikzpicture}
\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, 0.5) {$E_2$};
		\node [style=point] (1) at (0, -0.5) {$P_2$};
		\node [style=none] (2) at (-1.25, 1.5) {};
		\node [style=none] (3) at (1.25, 1.5) {};
		\node [style=none] (4) at (1.25, -1.5) {};
		\node [style=none] (5) at (-1.25, -1.5) {};
		\node [style=none] (6) at (1, -1.25) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (2.center) to (5.center) to (4.center) to (3.center) to cycle;
				\draw [style=qWire] (0) to (1);
	\end{pgfonlayer}
\end{tikzpicture}\\
&=\quad\Pr(E_1,P_1)\Pr(E_2,P_2).
\end{align}
Moreover, if $T_1$ is a procedure
that is a mixture of $T_2$ and $T_3$ with weights $\omega$ and $1-\omega$ respectively\footnote{That is, either $T_2$ or $T_3$ is implemented, as determined by the outcome of a weighted coin-flip.}, then it must hold that for any tester $\tau$,
we have
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T_1$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T_2$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T_3$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}\label{mixprobconstr}
\eeq
Additionally,
if one operational effect $E_1$ is the coarse-graining of
two others, $E_2$ and $E_3$, then $\Pr(E_1,P)$ must
be the sum of $\Pr(E_2,P)$ and $\Pr(E_3,P)$ for all $P$.

 
Our main result holds only for operational theories satisfying the following property:
%We say that an operational theory is {\em tomographically local} if the following property holds:
\begin{align} \label{tomlocforopthry}
\forall E_1,E_2,P_1,P_2\quad \tikzfig{Diagrams/7b_TomLoc1b} = \tikzfig{Diagrams/8b_TomLoc2b} \nonumber\\  \rotatebox{90}{$\iff$}\hspace{.22\textwidth} \nonumber \\
\forall E,P\quad \tikzfig{Diagrams/9b_TomLoc3b} = \tikzfig{Diagrams/10b_TomLoc4b}.
\end{align}
In other words, any two processes $T$ and $T'$ that give the same statistics for all local preparations on their inputs and all local measurements on their outputs {\em also} give the same statistics in arbitrary circuits.
 Such operational theories are alternatively characterized by the fact that the GPT defined by quotienting them satisfies tomographic locality, as we show below.

Two processes with the same input systems and output systems are said to be {\em operationally equivalent} if they give rise to the same probabilities no matter what closed diagram they are embedded in.  The testers introduced in Eq.~\eqref{eq:tester} facilitate a convenient diagrammatic representation of this condition.
That is, two processes are operationally equivalent, denoted by
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style={small box}] (0) at (-4, -0) {$T$};
		\node [style=none] (1) at (-4, -1.25) {};
		\node [style=none] (2) at (-4, 1.25) {};
		\node [style={small box}] (3) at (-1, -0) {$T'$};
		\node [style=none] (4) at (-1, -1.25) {};
		\node [style=none] (5) at (-1, 1.25) {};
		\node [style=none] (6) at (-2.5, 0) {$\simeq$};
		\node [style={right label}] (7) at (-4, -0.9999999) {$A$};
		\node [style={right label}] (8) at (-1, -0.9999999) {$A$};
		\node [style={right label}] (9) at (-4, 0.9999999) {$B$};
		\node [style={right label}] (10) at (-1, 0.9999999) {$B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (3) to (5.center);
		\draw [style=qWire] (3) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
if they assign equal probabilities to every tester\footnote{The recognition that (for operational theories corresponding to GPTs that are not tomographically local) one must consider testers that allow for side channels can be found in Refs.~\cite{hardy2011reformulating,chiribella2014dilation,chiribella2016quantum} .}, so that
\beq
\forall \tau  \ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, -0) {$T$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, -0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
		\node [style=none] (17) at (6.5, 0.75) {};
		\node [style=none] (18) at (9, 2) {};
		\node [style=none] (19) at (7, 0.75) {};
		\node [style=none] (20) at (8.25, 1.25) {};
		\node [style=none] (21) at (7.75, 0.75) {};
		\node [style=small box] (22) at (7, -0) {$T'$};
		\node [style=none] (23) at (6.5, -0.75) {};
		\node [style=none] (24) at (9, -2) {};
		\node [style=none] (25) at (7, -0.75) {};
		\node [style=none] (26) at (8.25, -1.25) {};
		\node [style=none] (27) at (6.5, 1.25) {};
		\node [style=none] (28) at (5.75, -2) {};
		\node [style=none] (29) at (6.5, -1.25) {};
		\node [style=none] (30) at (7.75, -0.75) {};
		\node [style=none] (31) at (8, -0) {$\tau$};
		\node [style=none] (32) at (5.75, 2) {};
		\node [style=none] (33) at (8.75, -1.75) {\tiny $p$};
		\node [style=none] (34) at (5, -0) {$=$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	\filldraw[fill=blue!20,draw=blue!40]  (32.center) to (28.center) to (24.center) to (18.center) to cycle;
	\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (22) to (19.center);
		\draw [style=qWire] (22) to (25.center);
		\filldraw[fill=white,draw=black] (29.center) to (26.center) to (20.center) to (27.center) to (17.center) to (21.center) to (30.center) to (23.center) to cycle;
	\end{pgfonlayer}
\end{tikzpicture}\ .
\eeq

It is easy to see that operational equivalence defines an equivalence relation. Hence, we can divide the space of processes into equivalence classes, and each process $T$ in the operational theory can be specified by its equivalence class $\widetilde{T}$, together with a label $c_T$ of the context of $T$, specifying which element of the equivalence class it is. For a given $T$, $c_T$ provides all the information which defines that process which is not relevant to its equivalence class. Hence, each procedure is specified by a tuple, $T :=(\widetilde{T},c_T)$, and we will denote it as such when convenient. In the case of closed diagrams, the equivalence class can be uniquely specified by the probability given by the map $p$, and so any information beyond this forms the context of the closed diagram.

Next, we define a quotienting map $\sim$ which maps procedures into their equivalence class; in other words, it picks out the first element of this tuple, taking $(\widetilde{T},c_T) \to \widetilde{T}$.\footnote{ This notation is very convenient in practice, but it is worth noting that it has the awkward feature that two operationally equivalent procedures $S$ and $T$ would map to $\widetilde{S}$ and $\widetilde{T}$ (respectively), which constitute two distinct labels for the same equivalence class (since $\widetilde{S}=\widetilde{T}$).  } Diagrammatically, we have
\[\tikzfig{Diagrams/15b_Quot1b}\ =\ \tikzfig{Diagrams/16b_Quot2b}.\]
We prove that it is diagram-preserving in Appendix~\ref{app:quotDP}. 
For processes which are closed diagrams, one can always choose the representative of the equivalence class to be the real number specified by the probability rule. 
%Hence, on its domain (namely the set of closed diagrams), the probability rule $p$ is identical to the quotienting map $\sim$, since every closed diagram is in the equivalence class of the real number specified by the probability rule.
Hence, the map \colorbox{black!50!blue!30!}{$\sim:\Op\to\widetilde{\Op}$} can be viewed as a diagram-preserving extension of the probability rule $p$. 
This implies that the quotiented operational theory reproduces the predictions of the operational theory, since
\beq\label{eq:GPTProbs}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -.75) {$\widetilde{P}$};
		\node [style=copoint] (1) at (0, .75) {$\widetilde{E}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw[qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -1) {${P}$};
		\node [style=copoint] (1) at (0, 1) {${E}$};
		\node [style=none] (2) at (-1, 2) {};
		\node [style=none] (3) at (-1, 0) {};
		\node [style=none] (4) at (1, 0) {};
		\node [style=none] (5) at (1, 2) {};
		\node [style=none] (6) at (-1, -0.25) {};
		\node [style=none] (7) at (-1, -2) {};
		\node [style=none] (8) at (1, -2) {};
		\node [style=none] (9) at (1, -0.25) {};
		\node [style=none] (10) at (0.75, -1.75) {\tiny $\sim$};
		\node [style=none] (11) at (0.75, 0.25) {\tiny $\sim$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw [ fill=black!50!blue!30!,draw=black!40!blue!40] (6.center) to (7.center) to (8.center) to (9.center) to cycle;
				\filldraw [ fill=black!50!blue!30!,draw=black!40!blue!40] (5.center) to (4.center) to (3.center) to (2.center) to cycle;
		\draw[qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -.75) {${P}$};
		\node [style=copoint] (1) at (0, .75) {${E}$};
		\node [style=none] (2) at (-1, 1.75) {};
		\node [style=none] (3) at (-1, -1.75) {};
		\node [style=none] (4) at (1, -1.75) {};
		\node [style=none] (5) at (1, 1.75) {};
		\node [style=none] (11) at (0.75, -1.5) {\tiny $\sim$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
					\filldraw [ fill=black!50!blue!30!,draw=black!40!blue!40] (5.center) to (4.center) to (3.center) to (2.center) to cycle;
		\draw[qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -.75) {${P}$};
		\node [style=copoint] (1) at (0, .75) {${E}$};
		\node [style=none] (2) at (-1, 1.75) {};
		\node [style=none] (3) at (-1, -1.75) {};
		\node [style=none] (4) at (1, -1.75) {};
		\node [style=none] (5) at (1, 1.75) {};
		\node [style=none] (11) at (0.75, -1.5) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
					\filldraw [ fill=blue!20,draw=blue!40] (5.center) to (4.center) to (3.center) to (2.center) to cycle;
		\draw[qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\
\Pr(E,P).
\eeq
 It is worth noting that in the quotiented operational theory, a closed diagram is equal to a real number (the probability associated to it), while in the operational theory these are not equal until the map $p$ is applied to the closed diagram.

We will assume that every deterministic effect  in the operational theory (corresponding to implementing a measurement on the system and marginalizing over its outcome) is operationally equivalent. We denote these deterministic effects as:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -0.75) {};
		\node [style=none] (1) at (0, 0.25) {};
		\node [style=upground] (2) at (0, 0.5) {};
		\node[style=none](3) at(0.5,0.75){$c$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1.center) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
where $c$ labels the context. 
%An example of two distinct (but operationally equivalent) deterministic effects in the operational theory is obtained by either implementing a measurement $M_1$ and coarse-graining over all its outcomes, or implementing a measurement $M_2$ and coarse-graining over all its outcomes.

\subsection{The GPT associated to an operational theory}

It turns out that this quotiented operational theory, $\widetilde{\Op}$, is nothing but a Generalized Probabilistic Theory~\cite{hardy2001quantum,barrett2007}, as we will now demonstrate by proving that $\widetilde{\Op}$ is tomographic (a notion that will be defined momentarily),
%tomographic,
 is representable in $\mathds{R}^d$ (for some $d$), is convex, and has a unique deterministic effect. This is not a novel idea, as it underpins the very definition of the GPT formalism, at least as presented in \cite{hardy2011reformulating,chiribella2010probabilistic}. The following arguments are very similar to those in Refs.~\cite{chiribella2010probabilistic,chiribella2014dilation,chiribella2016quantum},
and could be viewed either as the definition of GPTs, or as a formal relationship between GPTs and operational theories.

Firstly, we show that the quotiented operational theory is \emph{tomographic}. For a generic process theory, $\mathcal{P}$, being tomographic means that processes are characterized by scalars. That is, given any two distinct processes $f,g:A \to B \in \mathcal{P}$,
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style={small box}] (0) at (-3.5, 0) {$f$};
		\node [style=none] (1) at (-3.5, -1.25) {};
		\node [style=none] (2) at (-3.5, 1.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (0) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \neq\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-1.5, 1.25) {};
		\node [style=none] (1) at (-1.5, -1.25) {};
		\node [style={small box}] (2) at (-1.5, 0) {$g$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (2) to (0.center);
		\draw [style=qWire] (2) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}, \label{TLLHS}
\eeq
there must exist a tester $h \in\mathcal{P}$ that turns each of these processes into a closed diagram, i.e., a scalar, such that the scalars are distinct:
\beq \exists h \in\mathcal{P} : \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.75, -1.25) {};
		\node [style=none] (1) at (1.75, -0.75) {};
		\node [style=none] (2) at (1.75, 1.25) {};
		\node [style=none] (3) at (2.25, 0.75) {};
		\node [style={small box}] (4) at (2.25, 0) {$f$};
		\node [style=none] (5) at (3, 0.75) {};
		\node [style=none] (6) at (2.25, -0.75) {};
		\node [style=none] (7) at (3.5, -1.25) {};
		\node [style=none] (8) at (3.5, 1.25) {};
		\node [style=none] (9) at (3, -0.75) {};
		\node [style=none] (10) at (1.75, 0.75) {};
		\node [style=none] (11) at (3.25, 0) {$h$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (4) to (3.center);
		\draw [style=qWire] (4) to (6.center);
		\draw (2.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (0.center);
		\draw (0.center) to (1.center);
		\draw (1.center) to (9.center);
		\draw (9.center) to (5.center);
		\draw (5.center) to (10.center);
		\draw (10.center) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \neq\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.75, -1.25) {};
		\node [style=none] (1) at (1.75, -0.75) {};
		\node [style=none] (2) at (1.75, 1.25) {};
		\node [style=none] (3) at (2.25, 0.75) {};
		\node [style={small box}] (4) at (2.25, 0) {$g$};
		\node [style=none] (5) at (3, 0.75) {};
		\node [style=none] (6) at (2.25, -0.75) {};
		\node [style=none] (7) at (3.5, -1.25) {};
		\node [style=none] (8) at (3.5, 1.25) {};
		\node [style=none] (9) at (3, -0.75) {};
		\node [style=none] (10) at (1.75, 0.75) {};
		\node [style=none] (11) at (3.25, 0) {$h$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (4) to (3.center);
		\draw [style=qWire] (4) to (6.center);
		\draw (2.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (0.center);
		\draw (0.center) to (1.center);
		\draw (1.center) to (9.center);
		\draw (9.center) to (5.center);
		\draw (5.center) to (10.center);
		\draw (10.center) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}. \label{TLRHS}
\eeq

That Eq.~\eqref{TLRHS} implies Eq.~\eqref{TLLHS}  for processes in a quotiented operational theory is trivial; we now give the proof that Eq.~\eqref{TLLHS} implies Eq.~\eqref{TLRHS}. Consider two distinct processes, $\widetilde{T}$ and $\widetilde{T}'$,
in the quotiented operational theory---the images under the quotienting map of process $T$ and $T'$ in the operational theory---such that:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style={small box}] (0) at (-4, -0) {$\widetilde{T}$};
		\node [style=none] (1) at (-4, -1.25) {};
		\node [style=none] (2) at (-4, 1.25) {};
		\node [style={small box}] (3) at (-1, -0) {$\widetilde{T}'$};
		\node [style=none] (4) at (-1, -1.25) {};
		\node [style=none] (5) at (-1, 1.25) {};
		\node [style=none] (6) at (-2.5, 0) {$\neq$};
		\node [style={right label}] (7) at (-4, -1.25) {$A$};
		\node [style={right label}] (8) at (-1, -1.25) {$A$};
		\node [style={right label}] (9) at (-4, 0.9999999) {$B$};
		\node [style={right label}] (10) at (-1, 0.9999999) {$B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (3) to (5.center);
		\draw [style=qWire] (3) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
\blk
By definition, we know that $\widetilde{T} \neq \widetilde{T}'$ implies that $T\not\simeq T'$, and hence there exists some tester $\tau$ such that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
		\node [style=none] (17) at (6.5, 0.75) {};
		\node [style=none] (18) at (9, 2) {};
		\node [style=none] (19) at (7, 0.75) {};
		\node [style=none] (20) at (8.25, 1.25) {};
		\node [style=none] (21) at (7.75, 0.75) {};
		\node [style=small box] (22) at (7, 0) {$T'$};
		\node [style=none] (23) at (6.5, -0.75) {};
		\node [style=none] (24) at (9, -2) {};
		\node [style=none] (25) at (7, -0.75) {};
		\node [style=none] (26) at (8.25, -1.25) {};
		\node [style=none] (27) at (6.5, 1.25) {};
		\node [style=none] (28) at (5.75, -2) {};
		\node [style=none] (29) at (6.5, -1.25) {};
		\node [style=none] (30) at (7.75, -0.75) {};
		\node [style=none] (31) at (8, 0) {$\tau$};
		\node [style=none] (32) at (5.75, 2) {};
		\node [style=none] (33) at (8.75, -1.75) {\tiny $p$};
		\node [style=none] (34) at (5, 0) {$\neq$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40]  (32.center) to (28.center) to (24.center) to (18.center) to cycle;
	\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
\filldraw[fill=white,draw=black] (29.center) to (26.center) to (20.center) to (27.center) to (17.center) to (21.center) to (30.center) to (23.center) to cycle;
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (22) to (19.center);
		\draw [style=qWire] (22) to (25.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
Since the action of $p$ is identical to that of $\sim$ on closed diagrams, this implies that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $\sim$};
		\node [style=none] (17) at (6.5, 0.75) {};
		\node [style=none] (18) at (9, 2) {};
		\node [style=none] (19) at (7, 0.75) {};
		\node [style=none] (20) at (8.25, 1.25) {};
		\node [style=none] (21) at (7.75, 0.75) {};
		\node [style=small box] (22) at (7, 0) {$T'$};
		\node [style=none] (23) at (6.5, -0.75) {};
		\node [style=none] (24) at (9, -2) {};
		\node [style=none] (25) at (7, -0.75) {};
		\node [style=none] (26) at (8.25, -1.25) {};
		\node [style=none] (27) at (6.5, 1.25) {};
		\node [style=none] (28) at (5.75, -2) {};
		\node [style=none] (29) at (6.5, -1.25) {};
		\node [style=none] (30) at (7.75, -0.75) {};
		\node [style=none] (31) at (8, 0) {$\tau$};
		\node [style=none] (32) at (5.75, 2) {};
		\node [style=none] (33) at (8.75, -1.75) {\tiny $\sim$};
		\node [style=none] (34) at (5, 0) {$\neq$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[ fill=black!50!blue!30!,draw=black!40!blue!40]  (32.center) to (28.center) to (24.center) to (18.center) to cycle;
	\filldraw[ fill=black!50!blue!30!,draw=black!40!blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
\filldraw[fill=white,draw=black] (29.center) to (26.center) to (20.center) to (27.center) to (17.center) to (21.center) to (30.center) to (23.center) to cycle;
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (22) to (19.center);
		\draw [style=qWire] (22) to (25.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
Finally, we can use the fact that the quotienting map is diagram-preserving to write that there exists $\widetilde{\tau}$ such that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\widetilde{\tau}$};
		\node [style=none] (17) at (6.5, 0.75) {};
		\node [style=none] (19) at (7, 0.75) {};
		\node [style=none] (20) at (8.25, 1.25) {};
		\node [style=none] (21) at (7.75, 0.75) {};
		\node [style=small box] (22) at (7, 0) {$\widetilde{T}'$};
		\node [style=none] (23) at (6.5, -0.75) {};
		\node [style=none] (25) at (7, -0.75) {};
		\node [style=none] (26) at (8.25, -1.25) {};
		\node [style=none] (27) at (6.5, 1.25) {};
		\node [style=none] (29) at (6.5, -1.25) {};
		\node [style=none] (30) at (7.75, -0.75) {};
		\node [style=none] (31) at (8, 0) {$\widetilde{\tau}$};
		\node [style=none] (34) at (5, 0) {$\neq$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
\filldraw[fill=white,draw=black] (29.center) to (26.center) to (20.center) to (27.center) to (17.center) to (21.center) to (30.center) to (23.center) to cycle;
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (22) to (19.center);
		\draw [style=qWire] (22) to (25.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
This establishes that Eq.~\eqref{TLLHS} implies Eq.~\eqref{TLRHS},
and so the quotiented operational theory is tomographic.

We will moreover make the standard assumption of \emph{finite tomography}, that for transformations from $A\to B$
there is some set
$\mathcal{T}^{A\to B} := \{\widetilde{\tau}_\alpha\}_{\alpha = 1,2,..., m^{{A}\to {B}}}$ of {\em finite} cardinality $m^{{A}\to {B}}$ of testers which suffices for tomography. Formally, this means that:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (5, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (5, 0.75) {};
		\node [style=none] (2) at (5, -0.75) {};
		\node [style=none] (3) at (4.5, 0.75) {};
		\node [style=none] (4) at (4.5, 1.25) {};
		\node [style=none] (5) at (6.75, 1.25) {};
		\node [style=none] (6) at (6.75, -1.25) {};
		\node [style=none] (7) at (4.5, -1.25) {};
		\node [style=none] (8) at (4.5, -0.75) {};
		\node [style=none] (9) at (5.75, 0.75) {};
		\node [style=none] (10) at (5.75, -0.75) {};
		\node [style=none] (11) at (6.25, 0) {$\widetilde{\tau}_\alpha$};
		\node [style=none] (17) at (8.25, 0.75) {};
		\node [style=none] (19) at (8.75, 0.75) {};
		\node [style=none] (20) at (10.5, 1.25) {};
		\node [style=none] (21) at (9.5, 0.75) {};
		\node [style=small box] (22) at (8.75, 0) {$\widetilde{T}'$};
		\node [style=none] (23) at (8.25, -0.75) {};
		\node [style=none] (25) at (8.75, -0.75) {};
		\node [style=none] (26) at (10.5, -1.25) {};
		\node [style=none] (27) at (8.25, 1.25) {};
		\node [style=none] (29) at (8.25, -1.25) {};
		\node [style=none] (30) at (9.5, -0.75) {};
		\node [style=none] (31) at (10, 0) {$\widetilde{\tau}_\alpha$};
		\node [style=none] (34) at (7.5, 0) {$\neq$};
		\node [style=none] (35) at (2, 0) {$\exists \tau_\alpha \in \mathcal{T}^{A\to B}$  : \ };
		\node [style=none] (36) at (-1.75, 0) {$\iff$};
		\node [style=small box] (37) at (-5.25, 0) {$\widetilde{T}$};
		\node [style=none] (38) at (-5.25, -1.25) {};
		\node [style=none] (39) at (-5.25, 1.25) {};
		\node [style=small box] (40) at (-3.25, 0) {$\widetilde{T}'$};
		\node [style=none] (41) at (-3.25, -1.25) {};
		\node [style=none] (42) at (-3.25, 1.25) {};
		\node [style=none] (43) at (-4.25, 0) {$\neq$};
		\node [style=right label] (44) at (-5.25, -1.25) {$A$};
		\node [style=right label] (45) at (-3.25, -1.25) {$A$};
		\node [style=right label] (46) at (-5.25, 1.25) {$B$};
		\node [style=right label] (47) at (-3.25, 1.25) {$B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (22) to (19.center);
		\draw [style=qWire] (22) to (25.center);
		\draw [style=qWire] (37) to (39.center);
		\draw [style=qWire] (37) to (38.center);
		\draw [style=qWire] (40) to (42.center);
		\draw [style=qWire] (40) to (41.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (9.center);
		\draw (9.center) to (10.center);
		\draw (10.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
		\draw (27.center) to (17.center);
		\draw (17.center) to (21.center);
		\draw (21.center) to (30.center);
		\draw (30.center) to (23.center);
		\draw (23.center) to (29.center);
		\draw (29.center) to (26.center);
		\draw (26.center) to (20.center);
		\draw (20.center) to (27.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
This allows us to define a vector representation of the operational equivalence classes,  where the finiteness assumption above ensures that the associated vector spaces are finite-dimensional.
That is, we represent each process $\widetilde{T}$ with input $A$ and output $B$ as a vector in the vector space $\mathds{R}^{m^{{A}\to{B}}}$, namely, as the vector $\mathbf{R}_{\widetilde{T}}$ which is defined componentwise as
\beq
[\mathbf{R}_{\widetilde{T}}]_\alpha :=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (0, 0.75) {};
		\node [style=none] (2) at (0, -0.75) {};
		\node [style=none] (3) at (-0.5, 0.75) {};
		\node [style=none] (4) at (-0.5, 1.25) {};
		\node [style=none] (5) at (1.75, 1.25) {};
		\node [style=none] (6) at (1.75, -1.25) {};
		\node [style=none] (7) at (-0.5, -1.25) {};
		\node [style=none] (8) at (-0.5, -0.75) {};
		\node [style=none] (9) at (0.75, 0.75) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (1.25, 0) {$\widetilde{\tau}_\alpha$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (9.center);
		\draw (9.center) to (10.center);
		\draw (10.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture} \label{defmatrep}
\eeq
for $\alpha = 1,2,...,m^{{A}\to{B}}$.
This is clearly an injective mapping as, due to finite tomography, we know that each process $\widetilde{T}$ is uniquely characterized by this set of real numbers. Moreover, this mapping provides a linear structure to the set of processes with input $A$ and output $B$. For example, we can write equations such as
\beq \label{genericlincomb}
\mathbf{R}_{\widetilde{T}} = \sum_i r_i \mathbf{R}_{\widetilde{T}_i}
\eeq
where $r_i\in \mathds{R}$.

Consider now how the sequential composition of processes is represented. Given representations of a pair of processes $(\mathbf{R}_{\widetilde{T}},\mathbf{R}_{\widetilde{T}'})$ we know (as $\mathbf{R}$ is injective) that we can determine $\widetilde{T}$ and $\widetilde{T}'$, compute their composition $\widetilde{T}'\circ \widetilde{T}$, and via Eq.~\eqref{defmatrep} obtain $\mathbf{R}_{\widetilde{T}'\circ\widetilde{T}}$. We denote the sequential composition map on the vector representation as $\mathbf{R}_{\widetilde{T}'} \smallsquare \mathbf{R}_{\widetilde{T}} := \mathbf{R}_{\widetilde{T}'\circ \widetilde{T}}$. Similarly, for parallel composition we can define $\mathbf{R}_{\widetilde{T}'}\smallboxtimes\mathbf{R}_{\widetilde{T}} := \mathbf{R}_{\widetilde{T}'\otimes \widetilde{T}}$.
As we prove in Appendix~\ref{sec:bilinearity}, both $\smallsquare$ and $\smallboxtimes$ induce bilinear maps on the relevant vector spaces. Specifically, we have:
\begin{lemma} \label{bilinearityprf}
The operation $\smallsquare$ induces a bilinear map
\beq
\smallsquare:\left(\mathds{R}^{m^{B\to C}},\mathds{R}^{m^{A\to B}}\right)\to \mathds{R}^{m^{A\to C}},
\eeq
and the operation $\smallboxtimes$ induces a bilinear map
\beq
\smallboxtimes : \left(\mathds{R}^{m^{A\to B}}, \mathds{R}^{m^{C\to D}}\right)\to \mathds{R}^{m^{{AC}\to{BD}}}.
\eeq
\end{lemma}
\noindent This implies that transformations act linearly on the state space, and also that the summation operation distributes over diagrams, i.e.:
\beq \label{sumdistributes}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (-1, 0.75) {$\mathbf{R}_{\widetilde{T}}$};
		\node [style=none] (1) at (-1, 1.75) {};
		\node [style=small box] (2) at (-1, -0.75) {$\sum_i r_i \mathbf{R}_{\widetilde{T}_i}$};
		\node [style=none] (3) at (-1, -1.75) {};
		\node [style=none] (4) at (1.75, -1.75) {};
		\node [style=none] (5) at (1.75, 1.75) {};
		\node [style=small box] (6) at (1.75, -0.75) {$\mathbf{R}_{\widetilde{T}'}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (2) to (0);
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (3.center) to (2);
		\draw [style=qWire] (4.center) to (6);
		\draw [style=qWire] (6) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ = \sum_i r_i \ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (-1, 0.75) {$\mathbf{R}_{\widetilde{T}}$};
		\node [style=none] (1) at (-1, 1.75) {};
		\node [style=small box] (2) at (-1, -0.75) {$\mathbf{R}_{\widetilde{T}_i}$};
		\node [style=none] (3) at (-1, -1.75) {};
		\node [style=none] (4) at (1, -1.75) {};
		\node [style=none] (5) at (1, 1.75) {};
		\node [style=small box] (6) at (1, -0.75) {$\mathbf{R}_{\widetilde{T}'}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (2) to (0);
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (3.center) to (2);
		\draw [style=qWire] (4.center) to (6);
		\draw [style=qWire] (6) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq

It is generally easier to work with this vector representation of processes rather than directly with the abstract process theory of operational equivalence classes of procedures. We will do so
when convenient, abusing notation by dropping the explicit symbol $\mathbf{R}$, and simply denoting the vector representation of the equivalence classes in the same way as the equivalence classes themselves. That is, we will denote $\mathbf{R}_{\widetilde{T}}$ by $\widetilde{T}$.
For example, we will write
Eq.~\eqref{genericlincomb} as
\beq
\widetilde{T} = \sum_i r_i \widetilde{T}_i
\eeq
 and
 Eq.~\eqref{sumdistributes} as
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (-1, 0.75) {${\widetilde{T}}$};
		\node [style=none] (1) at (-1, 1.75) {};
		\node [style=small box] (2) at (-1, -0.75) {$\sum_i r_i {\widetilde{T}_i}$};
		\node [style=none] (3) at (-1, -1.75) {};
		\node [style=none] (4) at (1.25, -1.75) {};
		\node [style=none] (5) at (1.25, 1.75) {};
		\node [style=small box] (6) at (1.25, -0.75) {${\widetilde{T}'}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (2) to (0);
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (3.center) to (2);
		\draw [style=qWire] (4.center) to (6);
		\draw [style=qWire] (6) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ = \sum_i r_i \ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (-1, 0.75) {${\widetilde{T}}$};
		\node [style=none] (1) at (-1, 1.75) {};
		\node [style=small box] (2) at (-1, -0.75) {${\widetilde{T}_i}$};
		\node [style=none] (3) at (-1, -1.75) {};
		\node [style=none] (4) at (.5, -1.75) {};
		\node [style=none] (5) at (.5, 1.75) {};
		\node [style=small box] (6) at (.5, -0.75) {${\widetilde{T}'}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (2) to (0);
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (3.center) to (2);
		\draw [style=qWire] (4.center) to (6);
		\draw [style=qWire] (6) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq


Note that generic linear combinations such as $\sum_i r_i \widetilde{T}_i$ need not correspond to any
process in the operational theory.
However, some linear combinations correspond to mixtures and coarse-grainings, and these {\em will} correspond to other processes in the operational theory. Namely,  if $T_1$ is a procedure that is a mixture of $T_2$ and $T_3$ with weights $\omega$ and $1-\omega$, then by Eq.~\eqref{mixprobconstr} it follows that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T_1$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T_2$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T_3$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
for all $\tau$, which in turn implies that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}_1$};
		\node [style=none] (1) at (0, 0.75) {};
		\node [style=none] (2) at (0, -0.75) {};
		\node [style=none] (3) at (-0.5, 0.75) {};
		\node [style=none] (4) at (-0.5, 1.25) {};
		\node [style=none] (5) at (1.25, 1.25) {};
		\node [style=none] (6) at (1.25, -1.25) {};
		\node [style=none] (7) at (-0.5, -1.25) {};
		\node [style=none] (8) at (-0.5, -0.75) {};
		\node [style=none] (9) at (0.75, 0.75) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (1, 0) {$\widetilde{\tau}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (9.center);
		\draw (9.center) to (10.center);
		\draw (10.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}_2$};
		\node [style=none] (1) at (0, 0.75) {};
		\node [style=none] (2) at (0, -0.75) {};
		\node [style=none] (3) at (-0.5, 0.75) {};
		\node [style=none] (4) at (-0.5, 1.25) {};
		\node [style=none] (5) at (1.25, 1.25) {};
		\node [style=none] (6) at (1.25, -1.25) {};
		\node [style=none] (7) at (-0.5, -1.25) {};
		\node [style=none] (8) at (-0.5, -0.75) {};
		\node [style=none] (9) at (0.75, 0.75) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (1, 0) {$\widetilde{\tau}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (9.center);
		\draw (9.center) to (10.center);
		\draw (10.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}_3$};
		\node [style=none] (1) at (0, 0.75) {};
		\node [style=none] (2) at (0, -0.75) {};
		\node [style=none] (3) at (-0.5, 0.75) {};
		\node [style=none] (4) at (-0.5, 1.25) {};
		\node [style=none] (5) at (1.25, 1.25) {};
		\node [style=none] (6) at (1.25, -1.25) {};
		\node [style=none] (7) at (-0.5, -1.25) {};
		\node [style=none] (8) at (-0.5, -0.75) {};
		\node [style=none] (9) at (0.75, 0.75) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (1, 0) {$\widetilde{\tau}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (9.center);
		\draw (9.center) to (10.center);
		\draw (10.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (6.center);
		\draw (6.center) to (5.center);
		\draw (5.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}, \label{mixprocrel}
\eeq
and so by the fact that quotiented operational theories are tomographic,
%tomography
\beq
\widetilde{T}_1 = \omega \widetilde{T}_2 + (1-\omega) \widetilde{T}_3.
\eeq
 \blk
Hence, the mixing relations between preparation procedures in the operational theory are captured by a convex structure in this representation. More generally we find that
\beq \label{linearityconst}
\forall \tau \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
=\sum_ir_i
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$T_i$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\tau$};
		\node [style=none] (12) at (1, 2) {};
		\node [style=none] (13) at (4.25, 2) {};
		\node [style=none] (14) at (4.25, -2) {};
		\node [style=none] (15) at (1, -2) {};
		\node [style=none] (16) at (4, -1.75) {\tiny $p$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=blue!20,draw=blue!40] (12.center) to (15.center) to (14.center) to (13.center) to cycle;
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\iff
\widetilde{T} = \sum_i r_i \widetilde{T}_i
\eeq
for arbitrary coefficients $r_i$. Hence, for example, the coarse-graining relations that hold among operational effects are captured by the linear structure in this representation of the quotiented operational theory.

If one makes the standard assumption that every possible mixture of processes in the operational theory is another process in the operational theory, then it follows that the quotiented operational theory is convex.

Finally, the fact that we assumed that there was a unique equivalence class of deterministic effects means that the quotiented operational theory will have a {\em unique} deterministic effect~\cite{chiribella2010probabilistic}:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -0.75) {};
		\node [style=none] (1) at (0, 0.25) {};
		\node [style=upground] (2) at (0, 0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1.center) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad :=\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=upground] (0) at (0, .5) {};
		\node [style=none] (7) at (0, 0.25) {};
		\node [style=none] (8) at (0, -1) {};
		\node [style=right label] (9) at (0, -1.5) {};
		\node [style=right label] (10) at (0, -.5) {};
		\node [style=none] (13) at (1.25, -0.85) {\tiny $\sim$};
		\node [style=none] (14) at (1.5, -1) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1) {};
		\node [style=none] (18) at (0, -1.5) {};
		\node [style=none] (19) at (0.5, .5) {$c$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
				\filldraw[ fill=black!50!blue!30!,draw=black!40!blue!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\draw [qWire] (8.center) to (7.center);
		\draw [qWire] (8.center) to (18.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq

In summary, a quotiented operational theory satisfies the key properties of a GPT: being tomographic,
%generalized probabilistic theory: tomography,
 representability in $\mathds{R}^d$ (for some $d$), convexity, and uniqueness of the deterministic effect. Henceforth, we will refer to the quotiented operational theory as {\em the GPT associated to the operational theory}.

For example, quantum theory qua operational theory is the process theory whose processes are laboratory procedures (including contexts), while quantum theory qua GPT is the process theory whose processes are completely positive~\cite{NielsenAndChuang,Schmidcausal} trace-nonincreasing maps, whose states are density operators, and so on. When one quotients quantum theory qua operational theory, one obtains quantum theory qua GPT.

 It is worth noting that a quotiented operational theory should not be viewed as
an instance of an operational theory\footnote{ Although this is not captured by the formal definitions in this paper, it is captured by the more refined formalization in Ref.~\cite{schmid2020unscrambling}.}. In an operational theory, it is not merely that contexts are {\em permitted}, rather they are {\em required} in the definition of the procedures.
The primitives in an operational theory are laboratory procedures, and these necessarily involve a complete description of the context of a procedure. For example, ``prepare the maximally mixed state'' specifies a
preparation when viewing quantum theory as a quotiented operational theory, but not when viewing it as an operational theory. In the latter case, one must additionally specify how this mixture is achieved, e.g., which ensemble of pure states was prepared or which entangled state was followed by tracing of a subsystem. 
% "prepare $\ket{0}$ and $\ket{1}$ with equal probability. (and really, you also need to specify how |0> and |1> are prepared, as well as how the mixture is achieved).


\subsection{Tomographic locality of a GPT}

Tomographic locality is a common assumption in the GPT literature---indeed, in some early work on GPTs it was considered such a basic principle that it was taken as part of the framework itself~\cite{barrett2007}. Intuitively, it states that processes can be characterized by local state preparations and local measurements. In this section, we will show that all tomographically local GPTs can be represented as subtheories $\widetilde{\Op} \subset \RL$, using arguments similar to those in, e.g., the duotensor formalism in Ref.~\cite{hardy2011reformulating}.


A GPT is said to satisfy {\em tomographic locality} if one can determine the identity of any process by local operations on each of its inputs and outputs:
\begin{align} \label{loctom}
 \forall \widetilde{E},\widetilde{E}',\widetilde{P},\widetilde{P}' \tikzfig{Diagrams/17b_TomLocGPT1b} &= \tikzfig{Diagrams/18b_TomLocGPT2b}\nonumber \\ &\rotatebox{90}{$\iff$} \nonumber  \\
 \tikzfig{Diagrams/19b_TomLocGPT3b}\quad &=\quad \tikzfig{Diagrams/20b_TomLocGPT4b}.
\end{align}
\noindent 
%\david Note that the property of tomographic locality is stronger \blk 
One can immediately verify that an operational theory satisfies Eq.~\eqref{tomlocforopthry} if and only if the GPT obtained by quotienting relative to operational equivalences is tomographically local. 
%\rob [PROBLEM: insofar as processes in an operational theory include the specification of a context, we can never ``determine the identity of any process'' in an operational theory using testers.]\blk

There are many equivalent characterizations of tomographic locality for a GPT. The most useful for us is the following condition, first introduced in Sections~6.8 and 9.3 of \cite{hardy2011reformulating}, which allows us to show that tomographically local GPTs can be represented as subtheories of $\RL$.

Consider an arbitrary set of linearly independent and spanning states $\{\widetilde{P}^A_{j} \}_{j = 1,2,...,m^A}$ on system $A$ and an arbitrary set of linearly independent and spanning effects $\{\widetilde{E}^B_{i} \}_{i= 1,2,...,m^B}$ on system $B$. (If the systems are composite, these should moreover be chosen as product states and product effects respectively.) Define the `transition matrix' in this basis for a process $\widetilde{T}$ from system $A$ to system $B$ as
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (10) at (0, -3) {};
		\node [style=none] (11) at (0, 3) {};
		\node [style=none] (12) at (0, 0) {$[\mathbf{N}_{\widetilde{T}}]_j^k$};
	\end{pgfonlayer}
\end{tikzpicture}
\quad := \quad
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (1) at (0, 1.75) {$\widetilde{E}^B_k$};
		\node [style=small box] (2) at (0, 0) {$\widetilde{T}$};
		\node [style=right label] (3) at (0, 0.875) {$B$};
		\node [style=point] (4) at (0, -1.75) {$\widetilde{P}^A_j$};
		\node [style=right label] (5) at (0, -1) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (2);
		\draw [qWire] (2) to (4);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq

\begin{lemma} \label{lemmadecomp}
A GPT is tomographically local if and only if one can decompose the identity process, denoted $\widetilde{\mathds{1}}_A$, for every system $A$ as
\begin{equation}
\tikzfig{Diagrams/identityA}
\quad = \quad \sum_{ij} [\mathbf{M}_{\widetilde{\mathds{1}}_A}]_i^j
\tikzfig{Diagrams/measprepA},
\label{eq:identitydecomp1}
\end{equation}
where $\mathbf{M}_{{\widetilde{\mathds{1}}_A}}$ is the matrix inverse of the transition matrix $\mathbf{N}_{{\widetilde{\mathds{1}}_A}}$ of the identity process, that is,
\beq \label{lem:identitydecomp}
\mathbf{M}_{{\widetilde{\mathds{1}}}_A}:= \mathbf{N}_{\widetilde{\mathds{1}}_A}^{-1}.
\eeq
\end{lemma}


The proof is given in Appendix~\ref{proofTL}.


The vector space spanned by the set  $\{\widetilde{P}_{j}^A \}_{j = 1,2,...,m^A}$ of states is $\mathds{R}^{m^A}$, and the vector space spanned by the set $\{\widetilde{E}_{i}^B \}_{i= 1,2,...,m^B}$ of effects is $\mathds{R}^{m^B}$.
%\david Note that in general\footnote{In a generic GPT, there are not enough perfectly distinguishable states to span the vector space, and so this condition {\em cannot} be satisfied.}, $\widetilde{E}_j^A\circ\widetilde{P}_i^A=\delta_{ij}$, which generically implies that $\mathbf{M}_{{\widetilde{\mathds{1}}}_A}\neq \mathbf{N}_{\widetilde{\mathds{1}}_A}$, counter to intuitions one might have from working with orthonormal bases.\blk
Note that in general, $\widetilde{E}_j^A\circ\widetilde{P}_i^A \ne \delta_{ij}$\footnote{This fails to be an equality whenever the spanning effects $E_i$ do not perfectly distinguish the spanning states $P_j$. Note that this will be the generic case, as it is only in a simplicial GPT that there is a spanning set of states which can be perfectly distinguished.
%This failure of orthogonality holds whenever the spanning set of states cannot be perfectly distinguished.
%In a generic GPT, there are not enough perfectly distinguishable states to span the vector space, and so this condition {\em cannot} be satisfied.
}, which generically implies that $\mathbf{M}_{{\widetilde{\mathds{1}}}_A}$ is not the identity matrix (nor is it equal to $\mathbf{N}_{\widetilde{\mathds{1}}_A}$), counter to intuitions one might have from working with orthonormal bases.
The following corollary then makes explicit some extra structure which was implicit in the vector representation $\mathbf{R}_{\widetilde{T}}$ of the previous section. In particular, it
 shows that the vector space $\mathds{R}^{m^{A\to B}}$ of transformations from $A$ to $B$ is isomorphic to the vector space of linear maps from $\mathds{R}^{m^A}\to \mathds{R}^{m^B}$, where a process $\widetilde{T}$ is represented as a vector $\mathbf{R}_{\widetilde{T}}$ in the former and a matrix $\mathbf{M}_{\widetilde{T}}$ in the latter.

\begin{corollary}\label{corolTL}
A GPT is tomographically local if and only if one can decompose any process $\widetilde{T}$ as
\begin{equation}
\tikzfig{Diagrams/processAB}
\quad = \quad \sum_{ij} [\mathbf{M}_{\widetilde{T}}]_{i}^{j}
\tikzfig{Diagrams/measprepAB},
\label{eq:Tdecomp}
\end{equation}
where $\mathbf{M}_{\widetilde{T}} = \mathbf{M}_{\widetilde{\mathds{1}}_B}\circ \mathbf{N}_{\widetilde{T}}\circ\mathbf{M}_{\widetilde{\mathds{1}}_A}$.
\label{cor:Tdecomp}
\end{corollary}
\begin{proof}
To prove that a GPT is tomographically local if one can decompose any process as in Eq.~\eqref{eq:Tdecomp}, simply note that for the special case of $\widetilde{T} = \widetilde{\mathds{1}}_A$, Eq.~\eqref{eq:Tdecomp} implies Eq.~\eqref{eq:identitydecomp1}, and hence, by Lemma~\ref{lemmadecomp}, implies tomographic locality.

To prove the converse, we assume tomographic locality and apply Lemma~\ref{lemmadecomp} to decompose the input and output systems of an arbitrary process $\widetilde{T}$ as
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1.5) {};
		\node [style=none] (1) at (0, 1.25) {};
		\node [style={small box}] (2) at (0, -0) {$\widetilde{T}$};
		\node [style={right label}] (3) at (0, 1) {$B$};
		\node [style=none] (4) at (0, -1.25) {};
		\node [style={right label}] (5) at (0, -1.25) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1.center) to (2);
		\draw [qWire] (2) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad =\quad
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, 1.25) {$\widetilde{E}_k^B$};
		\node [style={small box}] (1) at (0, 0) {$\widetilde{T}$};
		\node [style=point] (2) at (0, -1.25) {$\widetilde{P}_j^A$};
		\node [style=none] (3) at (-2.5, -2.25) {$\displaystyle \sum_{ij}[\mathbf{M}_{\widetilde{\mathds{1}}_A}]_i^j$};
		\node [style=none] (4) at (-2.5, 1.5) {$\displaystyle\sum_{kl}[\mathbf{M}_{\widetilde{\mathds{1}}_B}]_k^l$};
		\node [style=point] (5) at (0, 3.5) {$\widetilde{P}_l^B$};
		\node [style=copoint] (6) at (0, -3.5) {$\widetilde{E}_i^A$};
		\node [style=none] (7) at (0, -4.5) {};
		\node [style=none] (8) at (0, 4.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0) to (1);
		\draw [qWire] (1) to (2);
		\draw [qWire] (6) to (7.center);
		\draw [qWire] (5) to (8.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad = \quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-2, -2) {$\displaystyle \sum_{ij}[\mathbf{M}_{\widetilde{\mathds{1}}_A}]_i^j$};
		\node [style=none] (1) at (-2, 1.75) {$\displaystyle\sum_{kl}[\mathbf{M}_{\widetilde{\mathds{1}}_B}]_k^l$};
		\node [style=point] (2) at (0, 2.75) {$\widetilde{P}_l^B$};
		\node [style=copoint] (3) at (0, -2.75) {$\widetilde{E}_i^A$};
		\node [style=none] (4) at (0, -3.75) {};
		\node [style=none] (5) at (0, 3.75) {};
		\node [style=none] (6) at (0, 0) {$[\mathbf{N}_{\widetilde{T}}]_j^k$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3) to (4.center);
		\draw [qWire] (2) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
which can be rewritten as:
\begin{align}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1.5) {};
		\node [style=none] (1) at (0, 1.25) {};
		\node [style={small box}] (2) at (0, -0) {$\widetilde{T}$};
		\node [style={right label}] (3) at (0, 1) {$B$};
		\node [style=none] (4) at (0, -1.25) {};
		\node [style={right label}] (5) at (0, -1.25) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1.center) to (2);
		\draw [qWire] (2) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ &= \ \sum_{il}\left(\sum_{jk}
[\mathbf{M}_{\widetilde{\mathds{1}}_B}]_k^l
[\mathbf{N}_{\widetilde{T}}]_j^k
[\mathbf{M}_{\widetilde{\mathds{1}}_A}]_i^j
\right)
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.125) {$\widetilde{P}_l^B$};
		\node [style=copoint] (9) at (0, -1.125) {$\widetilde{E}_i^A$};
		\node [style=none] (10) at (0, -2) {};
		\node [style=none] (11) at (0, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
\\
&= \
\sum_{il}
[\mathbf{M}_{\widetilde{\mathds{1}}_B}\circ
\mathbf{N}_{\widetilde{T}}\circ\mathbf{M}_{\widetilde{\mathds{1}}_A}]_i^l
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.125) {$\widetilde{P}_l^B$};
		\node [style=copoint] (9) at (0, -1.125) {$\widetilde{E}_i^A$};
		\node [style=none] (10) at (0, -2) {};
		\node [style=none] (11) at (0, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{align}
at which point we can simply identify $\mathbf{M}_{\widetilde{T}} = \mathbf{M}_{\widetilde{\mathds{1}}_B}\circ \mathbf{N}_{\widetilde{T}}\circ\mathbf{M}_{\widetilde{\mathds{1}}_A}$, giving the desired result.
\end{proof}

Given the vector representation of two equivalence classes, $\mathbf{R}_{\widetilde{T}}$ and $\mathbf{R}_{\widetilde{T}'}$, we showed how to compute the representation of either the sequential or parallel composition of these (via $\smallsquare$ and $\smallboxtimes$, respectively). However, if we represent equivalence classes by matrices $\mathbf{M}_{\widetilde{T}}$ instead, then how must we represent the parallel and sequential composition of processes?
It turns out that parallel composition is represented by
\beq \label{parallelcompr}
\mathbf{M}_{\widetilde{T}\otimes \widetilde{T}'} = \mathbf{M}_{\widetilde{T}}\otimes \mathbf{M}_{\widetilde{T}'}
\eeq
where the $\otimes$ on the left represents the parallel composition of equivalence classes, while on the right it represents the tensor product of the two matrices.
Meanwhile, the sequential composition of this matrix representation is given by
\beq \label{nastycomp}
\mathbf{M}_{\widetilde{T}'\circ \widetilde{T}'} = \mathbf{M}_{\widetilde{T}'}\circ \mathbf{N}_{\widetilde{\mathds{1}}_B}\circ \mathbf{M}_{\widetilde{T}}
\eeq
where on the left-hand side $\circ$ represents the sequential composition of the equivalence classes, while on the right-hand side it represents matrix multiplication. These two facts are proven in Appendix~\ref{comprepn}.

The fact that Eq.~\eqref{nastycomp} is not simply the sequential composition rule for $\RL$, namely the matrix product of $\mathbf{M}_{\widetilde{T}'}$ and $\mathbf{M}_{\widetilde{T}}$, implies that this matrix representation is not a subtheory of $\RL$, nor even some other diagram-preserving representation of the GPT.
This form of composition has, however, appeared numerous times in the literature, for example in Refs.~\cite{ferrie2008frame,hardy2011reformulating,appleby2017introducing,van2017quantum}. There is, moreover, a well known trick to turn this representation into a diagram-preserving representation in $\mathbf{RLinear}$: one simply defines a new matrix representation by replacing $\mathbf{M}_{\widetilde{T}}$ with $\mathbf{M}_{\widetilde{T}}\circ \mathbf{N}_{\widetilde{\mathds{1}}_A}$\footnote{In the language of duotensors \cite{hardy2011reformulating} this means that we put the duotensors into standard form.}.  It is then easy to verify that these do indeed compose using the standard composition rules (tensor products for parallel composition and matrix multiplication for sequential composition), and to verify that the identity process is represented by the identity matrix.

Putting all of this together we arrive at the following.
\begin{theorem} \label{OpinRL}
Any tomographically local GPT has a diagram-preserving representation in $\mathbf{RLinear}$ given by
the map
\[A \mapsto \mathds{R}^{m^A}\]
on systems and the map
\[\widetilde{T} \mapsto \mathbf{M}_{\widetilde{T}}\circ \mathbf{N}_{\widetilde{\mathds{1}}_A}\]
 on processes, where
\beq [\mathbf{N}_{\widetilde{T}}]_j^k:=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (1) at (0, 1.75) {$\widetilde{E}_k^B$};
		\node [style=small box] (2) at (0, 0) {$\widetilde{T}$};
		\node [style=right label] (3) at (0, 0.75) {$B$};
		\node [style=point] (4) at (0, -1.75) {$\widetilde{P}_j^A$};
		\node [style=right label] (5) at (0, -.875) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (2);
		\draw [qWire] (2) to (4);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
and
\beq
\mathbf{M}_{\widetilde{T}} := \mathbf{N}_{\widetilde{\mathds{1}}_B}^{-1}\circ \mathbf{N}_{\widetilde{T}} \circ \mathbf{N}_{\widetilde{\mathds{1}}_A}^{-1}.
\eeq
\end{theorem}

Effectively this means that we can view any tomographically local GPT simply as a suitably defined subtheory $\widetilde{\Op}\subset \RL$.  For the remainder of this paper we restrict our attention to tomographically local GPTs, and we will moreover abuse notation and simply denote the linear maps in this representation by $\widetilde{T}$ rather than by $\mathbf{M}_{\widetilde{T}}\circ \mathbf{N}_{\widetilde{\mathds{1}}_A}$, and similarly, the vector spaces as $A$ rather than by $\mathds{R}^{m^A}$. That is, we will neglect to make the distinction between the quotiented operational theory and its representation as a subtheory of $\RL$, as preserving the distinction is unwieldy and typically unhelpful.

 Quantum theory is an example of an operational theory, and it is well known that the GPT representation of quantum theory is tomographically local. The latter is a subtheory of $\RL$, as $\mathcal{B(H)}$ is a real vector space and completely positive trace non-increasing maps are just a particular class of linear maps between these vector spaces. Classical theory, the Spekkens toy model~\cite{spekkens2007evidence}, and the stabilizer subtheory~\cite{Gottesman:1998hu} for arbitrary dimensions are also tomographically local.  Examples of GPTs which are not tomographically local are real quantum theory \cite{hardy2012limited} and the real stabilizer subtheory.




\section{Representations of operational theories and GPTs}

One often wishes to find alternative representations of an operational theory or a GPT, e.g., as an ontological model or a quasiprobabilistic model (to be defined shortly). A key motivation for studying ontological models is the attempt to find an explanation for the statistics in terms of some underlying properties of the relevant systems, especially if this explanation can be said to be {\em classical} in some well-motivated sense. In this section, we introduce the definition of ontological models and quasiprobabilistic models, and in the next section we discuss under what conditions one can say that such representations provide a classical explanation of the operational theory or GPT which they describe.


\subsection{Ontological models}\label{subsec:ont}

An ontological model is a map associating to every system $S$ a set $\Lambda_S$ of ontic states, and associating to every process a stochastic map from the ontic state space associated to the input systems to the ontic state space associated with the output systems.

It is important to distinguish between ontological models of operational theories and ontological models of GPTs, as was shown in Ref.~\cite{schmid2019characterization}.

\begin{definition}[Ontological models of operational theories] \label{defnontop}
An ontological model of an operational theory $\Op$ is a diagram-preserving map \colorbox{BurntOrange!20}{$\xi:\Op\to \SubS$}, depicted as
\[\xi::\ \tikzfig{Diagrams/21b_Ont1b}\ \mapsto\ \tikzfig{Diagrams/21_Ont1},\]
from the operational theory to the process theory $\SubS$,
where the map satisfies three properties:
\begin{enumerate}
\item It represents all deterministic effects in the operational theory appropriately:
\[\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=upground] (0) at (0, 0) {};
		\node [style=none] (7) at (0, -0.25) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=right label] (9) at (0, -2) {$\mathds{R}^{\Lambda_A}$};
		\node [style=right label] (10) at (0, -1) {$A$};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1) {};
		\node [style=none] (16) at (-1.5, 1) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, -2) {};
		\node[style=none] (19) at (0.5,0.25) {c};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=BurntOrange!20,draw=BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\draw [qWire] (8.center) to (7.center);
		\draw (8.center) to (18.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\
\tikzfig{Diagrams/23_Ont3} \ =\
\mathbf{1}.\]
\item It reproduces the operational predictions of the operational theory. That is, for all closed diagrams:
\[\tikzfig{Diagrams/24_Ont4}\ =\ \tikzfig{Diagrams/25_Ont5}\ =\mathrm{Pr}(E,P).\]
\item It preserves the convex and coarse-graining relations between operational procedures. E.g., if $T_1$ is a procedure
that is a mixture of $T_2$ and $T_3$ with weights $\omega$ and $1-\omega$, respectively, then it must hold that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
{T_1}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=BurntOrange!20,draw=BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
{T_2}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=BurntOrange!20,draw=BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {${T_3}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=BurntOrange!20,draw=BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
\end{enumerate}
\end{definition}

This diagrammatic definition of an ontological model reproduces the usual notions~\cite{Spekkens2005} of ontological representations of preparation procedures and of operational effects. In particular, an operational preparation procedure is an operational process with a trivial input, and by diagram preservation of $\xi$, this is mapped to a process in $\SubS$ with a trivial input, that is, to a probability distribution over the ontic states:
$P \mapsto \xi(P) : \Lambda \to \mathds{R}^+ \text{ s.t. } \sum_\lambda \xi(P)(\lambda)=1$. Similarly, an operational effect is an operational process with a trivial output, and by diagram preservation of $\xi$ is mapped to a substochastic process with a trivial output, that is, to a response function over the ontic states: $E \mapsto \xi(E) : \Lambda \to [0,1] \text{ s.t. }  \xi(E)(\lambda) \leq 1$.

\begin{definition}[Ontological models of GPTs] \label{defnontgpt}
An ontological model $\widetilde{\xi}$ of a GPT $\widetilde{\Op}$ is a diagram-preserving map \colorbox{Red!20}{$\widetilde{\xi}: \widetilde{\Op} \to \SubS$}, depicted as
\[\widetilde{\xi}:: \ \tikzfig{Diagrams/26b_GPT1b}\ \mapsto \ \tikzfig{Diagrams/26_GPT1},\]
from the GPT to the process theory $\SubS$,
where the map satisfies three properties:
\begin{enumerate}
\item It represents the deterministic effect appropriately: \[
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=upground] (0) at (0, 0) {};
		\node [style=none] (7) at (0, -0.25) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=right label] (9) at (0, -2) {$\mathds{R}^{\Lambda_A}$};
		\node [style=right label] (10) at (0, -1) {$A$};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\widetilde{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1) {};
		\node [style=none] (16) at (-1.5, 1) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, -2) {};
		%\node[style=none] (19) at (0.5,0.25) {c};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\draw [qWire] (8.center) to (7.center);
		\draw (8.center) to (18.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\ \tikzfig{Diagrams/23_Ont3} =\ \mathbf{1}.\]
\item It reproduces the operational predictions of the GPT, so that for all closed diagrams,
\beq\label{eq:EmpAdeq}\tikzfig{Diagrams/24_empadG}\ =\ \tikzfig{Diagrams/25_empadG}\ =\mathrm{Pr}(\widetilde{E},\widetilde{P}).\eeq
\item It preserves the convex and coarse-graining relations between operational procedures. E.g., if
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_1$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_2$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ + (1-\omega)\
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_3$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
then it must hold that
 \beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_1$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\widetilde{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_2$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\widetilde{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_3$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\widetilde{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
\end{enumerate}
\end{definition}

In analogy with the discussion above, one has that normalized GPT states on some system are represented in an ontological model by probability distributions over the ontic state space associated with that system, while GPT effects are represented by response functions.

The state spaces in $\SubS$ form simplices, and so we will sometimes refer to an ontological model of a GPT as a simplex embedding. This terminology is a natural extension of the definition of simplex embedding in \cite{schmid2019characterization}.
\subsection{Quasiprobabilistic models}

We now introduce quasiprobabilistic models of a GPT. One could analogously define quasiprobabilistic models of an operational theory (as diagram-preserving maps from $\Op$ to $\QSS$).  However, given that the expressive freedom offered by the possibility of context-dependence is sufficient to ensure that every operational theory admits of an ontological model, and hence a {\em positive} quasiprobabilistic model, there is no need to make use of the additional expressive freedom offered by allowing negative quasiprobabilities, and hence no motivation to introduce such models.
%However, the additional expressive freedom offered by quasiprobabilities relative to probabilities is unnecessary since the freedom offered by context-dependence is already sufficient
%as we already know that
%there always exists ontological models of an operational theory.
%This added flexibility does not seem a conceptually or mathematically useful tool, so we will not do so here.
On the other hand, in the case of GPTs, there does not always exist an ontological model, hence quasiprobabilistic models are a useful conceptual and mathematical tool for assessing the classicality of a GPT.

\begin{definition}[Quasiprobabilistic models of GPTs]\label{def:quasi}
A quasiprobabilistic model of a GPT $\widetilde{\Op}$, is a diagram-preserving map \colorbox{purple!20}{$\hat{\xi}: \widetilde{\Op} \to \QSS$}, depicted as
\[\hat{\xi}::\ \tikzfig{Diagrams/26b_GPT1b}\ \mapsto \ \tikzfig{Diagrams/26c_GPT_hat},\]
%from the GPT to $\QSS$,
where the map satisfies three properties:
\begin{enumerate}
\item It represents the deterministic effect appropriately:
\begin{equation}
\tikzfig{Diagrams/22b_Ont2_hat}\ =\ \tikzfig{Diagrams/23_Ont3} =\
\mathbf{1}. \label{eq:quasinorm}
\end{equation}
\item It reproduces the operational predictions of the GPT, so that for all closed diagrams,
\[\tikzfig{Diagrams/24_empadQrepn}\ = \ \tikzfig{Diagrams/25_empadQrepn}\ =\mathrm{Pr}(\widetilde{E},\widetilde{P}).\]
\item It preserves the convex and coarse-graining relations between operational procedures. E.g., if
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_1$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_2$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ + (1-\omega)\
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_3$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (4.center);
		\draw (4.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
 then it must hold that
 \beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_1$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\hat{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=purple!20,draw=purple!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_2$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\hat{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=purple!20,draw=purple!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{T}_3$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\hat{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=purple!20,draw=purple!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
\end{enumerate}
\end{definition}

One can see that the only technical distinction between an ontological model of a GPT and a quasiprobabilistic model of a GPT is that in the latter, the probabilities are replaced by quasiprobabilities, which are allowed to go negative.

In analogy with the discussion at the end of Section~\ref{subsec:ont}, one has that GPT states on some system are represented in a quasiprobabilistic model by quasidistributions over the sample space associated with that system, that is, functions on $\Lambda$ normalised to $1$ but where the values can be negative, while GPT effects are represented by arbitrary real-valued functions over the sample space.

\section{Three equivalent notions of classicality} \label{threenotions}

%\sout{Every operational theory admits }\john{Many operational theories admit} of some ontological model, if one does not restrict attention to ontological models satisfying additional properties. However, only those ontological models that {\em do} satisfy additional assumptions constitute good explanations. 
The only ontological models that constitute good classical explanations are those that satisfy additional assumptions.
One such principle is that of (generalized) noncontextuality~\cite{Spekkens2005}. It was argued in Refs.~\cite{Spekkens2005,Pirsa_nc,Spekkens2008,schmid2019characterization}
that an ontological model of an operational theory should be deemed a good classical explanation only if it is noncontextual.
We now provide the definition of a noncontextual ontological model in the framework we have introduced here.

\begin{definition}[A noncontextual ontological model of an operational theory]
An ontological model of an operational theory \colorbox{black!30!BurntOrange!30}{$\xiNC:\Op\to\SubS$} satisfies the principle of {\em generalized noncontextuality} if and only if every two operationally equivalent procedures in the operational theory are mapped to the same substochastic map in the ontological model.
That is, if
\begin{equation} \tikzfig{Diagrams/32_NC1} \simeq \tikzfig{Diagrams/33_NC2} \implies \tikzfig{Diagrams/34_NC3} = \tikzfig{Diagrams/35_NC4}. \label{eq:nonctx}
\end{equation}
\end{definition}
Another way of stating this condition is that the map $\xiNC$ does not depend functionally on the context of any processes in the operational theory, so that for all $T := (\widetilde{T},c_{T})$ one has $\xiNC(T)=\xiNC(\widetilde{T})$.


As pointed out in Ref.~\cite{schmid2019characterization}, ontological models of GPTs, unlike those of operational theories, cannot be said to be either generalized-contextual or generalized-noncontextual. This is because there is no notion of a context in a GPT on which the ontological representation could conceivably depend.
%\footnote{Accordingly the Beltrametti-Bujaski model~\cite{Beltrametti_1995} constitutes a (contextual) ontological model of the single qubit subtheory only when the latter is viewed as an operational theory rather than as a GPT. Similarly, the $8$-state model of Ref.~\cite{8state} constitutes a (contextual) ontological model of the stabilizer qubit subtheory only when the latter is viewed as an operational theory rather than as a GPT, since in both cases, the representation of a given quantum process depends on the particular realization of that process. } 
However, Ref.~\cite{schmid2019characterization} showed (in the context of prepare-and-measure scenarios) that the principle of noncontextuality nonetheless induces a notion of classicality within the framework of GPTs: namely, the GPT is said to have a classical explanation if and only if it admits of an ontological model. (Not all GPTs admit of an ontological model, even if the operational theory from which they are obtained as a quotiented theory do. This is a consequence of the representational inflexibility resulting from the lack of contexts on which the representation might depend.\footnote{
Accordingly, the Beltrametti-Bujaski model~\cite{Beltrametti_1995} can be viewed as an ontological model of the single qubit subtheory {\em qua operational theory}, but not as an ontological model of the single qubit subtheory {\em qua GPT}.  This can be seen by noting that this model is explicitly contextual while the single qubit subtheory qua GPT has no contexts.  Equivalently, it can be seen by nothing that  the single qubit subtheory qua GPT does not admit of {\em any} ontological model.  The same can be said of the $8$-state model of Ref.~\cite{8state} relative to the stabilizer qubit subtheory: it is an ontological model of the stabilizer qubit subtheory {\em qua operational theory} (a {\em contextual} ontological model) but not of the stabilizer qubit subtheory qua GPT.  The latter has no contexts and does not admit of any ontological model.}) We now extend this result (Theorem~$1$ of Ref.~\cite{schmid2019characterization}) from prepare-and-measure scenarios to arbitrary scenarios.

\begin{theorem}\label{thm:NCOMandOM}
There is a one-to-one correspondence between noncontextual ontological models of an operational theory, \colorbox{black!30!BurntOrange!30}{$\xiNC:\Op \to \SubS$}, and ontological models of the associated GPT, \colorbox{Red!20}{$\widetilde{\xi}:\widetilde{\Op}\to\SubS$}.
\end{theorem}
\begin{proof}[Proof sketch]
The idea of the proof is captured by the following diagram:
\[
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-2, 1) {$\Op$};
		\node [style=none] (1) at (2.25, 1) {$\widetilde{\Op}$};
		\node [style=none] (2) at (0, -1.25) {$\SubS$};
		\node [style=none] (3) at (1.5, 1) {};
		\node [style=none] (4) at (-1.5, 1) {};
		\node [style=none] (5) at (-1.75, 0.5) {};
		\node [style=none] (6) at (-0.5, -0.75) {};
		\node [style=none] (7) at (1.75, 0.5) {};
		\node [style=none] (8) at (0.5, -0.75) {};
		\node [style=none] (9) at (0, 1.25) {$\sim$};
		\node [style=none] (10) at (-0.75, 0.25) {$\xiNC$};
		\node [style=none] (11) at (1.5, -0.25) {$\widetilde{\xi}$};
		\node [style=none] (12) at (-1.5, 1.25) {};
		\node [style=none] (13) at (1.5, 1.25) {};
		\node [style=none] (14) at (0, 2.25) {$C$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [arrow plain] (5.center) to (6.center);
		\draw [arrow plain] (4.center) to (3.center);
		\draw [arrow plain] (7.center) to (8.center);
		\draw [arrow plain, bend left=315] (13.center) to (12.center);
	\end{pgfonlayer}
\end{tikzpicture},
\]
where $C$ is defined as a map which takes any process $\widetilde{T}$ in the GPT $\widetilde{\Op}$ to some process $T= (\widetilde{T},c_{T})$ in the operational theory. There always exists at least one such map $C$ (in general, there exist many), and all of these satisfy ${\sim} \circ C = {\rm Id}$ (in general, no choice of $C$ will satisfy  $ C \circ {\sim} = {\rm Id}$).

Now, consider an operational theory $\Op$ and the GPT $\widetilde{\Op}$ it defines.

Given an ontological model $\widetilde{\xi}$ of $\widetilde{\Op}$, one can define a noncontextual model $\xiNC$ of $\Op$ via $\xiNC :=   \widetilde{\xi} \circ {\sim}$. The map constructed in this manner cannot depend on the contexts of processes in the operational theory, since these are removed by the quotienting map $\sim$. As such, the map $\xiNC$ necessarily satisfies Eq.~\eqref{eq:nonctx}, and hence is indeed noncontextual.

Given a noncontextual ontological model $\xiNC$ of $\Op$, one can define an ontological model $\widetilde{\xi}$ of $\widetilde{\Op}$ via $\widetilde{\xi}:=\xiNC \circ C$. Because the map $\xiNC$ does not depend on the context, the map constructed in this manner does not depend on the choice of $C$, and is unique.

For completeness, we prove in Appendix~\ref{comptheproof} that $\xiNC :=   \widetilde{\xi} \circ {\sim}$ indeed satisfies the relevant constraints to be an ontological model of an operational theory, and similarly, that $\widetilde{\xi}:=\xiNC \circ C$ satisfies the relevant constraints to be a valid ontological model of a GPT.
\end{proof}

Finally, we note that this notion of classicality of a GPT is closely linked to the positivity of quasiprobabilistic models. This result can be seen as an extension of the equivalence in Ref.~\cite{Spekkens2008} from the prepare-and-measure scenario to arbitrary compositional scenarios.

\begin{definition}[Positive quasiprobabilistic model of a tomographically local GPT] A positive quasiprobabilistic model of a tomographically local GPT $\widetilde{\Op}$ is a quasiprobabilistic model \colorbox{black!30!purple!30}{$\hat{\xi}^+:\widetilde{\Op}\to\QSS$} in which all of the matrix elements of the quasisubstochastic maps in the image of $\hat{\xi}^+$ are positive, that is, if and only if all of the quasisubstochastic maps in the image of $\hat{\xi}^+$ are substochastic.
\end{definition}

Simply by examining the definitions, it is clear that a {\em positive} quasiprobabilistic model \colorbox{black!30!purple!30}{$\hat{\xi}^+:\widetilde{\Op}\to\QSS$} of a GPT is equivalent to an ontological model \colorbox{Red!20}{$\widetilde{\xi}:\widetilde{\Op}\to\SubS$} of that GPT. It follows that:
\begin{proposition}\label{prop:PQRandOM}
There exists a positive quasiprobabilistic model of a GPT $\widetilde{\Op}$ if and only if there exists an ontological model of $\widetilde{\Op}$.
\end{proposition}

Putting  Thm.~\ref{thm:NCOMandOM} and Prop.~\ref{prop:PQRandOM} together, one has that:
\begin{corollary}[Three equivalent notions of classicality]\label{cor:three}
Let $\Op$ be an operational theory and $\widetilde{\Op}$ the GPT obtained from $\Op$ by quotienting. Then, the following are equivalent:\\
(i) There exists a noncontextual ontological model of $\Op$, that is, a map \colorbox{black!30!BurntOrange!30}{$\xiNC:\Op\to\SubS$}. \\
(ii) There exists an ontological model (a.k.a. simplex embedding) of $\widetilde{\Op}$, that is, a map \colorbox{Red!20}{$\widetilde{\xi}:\widetilde{\Op}\to\SubS$}.
%Geometrically, this corresponds to $\widetilde{\Op}$ being embeddable in a simplicial~\cite{hardy2001quantum,barrett2007} GPT.\footnote{ A simplicial GPT is one for which the state spaces of each system is a simplex (where the simplex associated to a composite system has a set of vertices corresponding to the Cartesian product of the sets of vertices of the simplices describing the components), the space of effects on each system is the hypercube containing all effects which are logically possible on the associated simplex, and the space of reversible transformations on each system is the set of permutations of the vertices of the associated simplex.}\\
(iii) There exists a positive quasiprobabilistic model of $\widetilde{\Op}$, that is, a map \colorbox{black!30!purple!30}{$\hat{\xi}^+:\widetilde{\Op}\to\QSS$}.
\end{corollary}
%This generalises results which were known for the special case of prepare-measure scenarios \cite{Spekkens2008,schmid2019characterization,shahandeh2019contextuality} to now apply to scenarios with arbitrary causal structures. \david That is, it shows that in arbitrary scenarios, the following three notions of classicality are equivalent: existence of a noncontextual ontological model, existence of an embedding into a simplicial GPT, and existence of a positive quasiprobabilistic model. \blk

This generalizes the results of Refs.~\cite{Spekkens2008,schmid2019characterization,shahandeh2019contextuality} from prepare-measure scenarios to arbitrary compositional scenarios.
%the equivalence between three notions of classicality---existence of a noncontextual ontological model, existence of an embedding into a simplicial GPT, and existence of a positive quasiprobabilistic model---from prepare-measure scenarios~\cite{Spekkens2008,schmid2019characterization,shahandeh2019contextuality} to the case of \rob arbitrary compositional scenarios.\blk
%scenarios with arbitrary causal structure.

\section{Structure theorem} \label{mainresults}

With this framework in place, we can prove our main results.
We start with a general theorem, leveraging the fact that $\widetilde{\Op} \subset \RL$, as stated in Theorem~\ref{OpinRL}.
We then specialize to the various physically relevant cases.
% (using the facts that $\SS \subset \QSS \subset \RL$ and $\widetilde{\Op} \subset \RL$).

\begin{theorem}\label{mainthm}
Any convex-linear, empirically adequate and diagram-preserving map (eq.~\eqref{eq:DPM}), \colorbox{green!20}{$M:\widetilde{\Op}\to \RL$}, where $\widetilde{\Op}$ is tomographically local can be represented as
\begin{equation}\label{eq:repTrans}
\tikzfig{Diagrams/50_Proof2}\quad = \quad \tikzfig{Diagrams/42_QuasiRep2},
\end{equation}
where for each system $A$, $\chi_A:A\to V_A$ is an invertible linear map within $\RL$.
\label{thm:structure}
\end{theorem}

Note that we have colored the linear maps $\chi_A$ to make it immediately apparent that they came from the associated diagram-preserving map.

The proof consists of three main arguments, provided explicitly in Appendix~\ref{mainproof} and sketched here.

First, we leverage tomographic locality of the GPT, as well as convex-linearity and diagram preservation of the map, to prove that one can represent the action of the map on a generic process in terms of its action on states and effects
\begin{equation}
	\tikzfig{Diagrams/50_Proof2}\ =\ \tikzfig{Diagrams/51_Proof3}\ = \sum_{ij} r_{ij}\ \tikzfig{Diagrams/55_Proof7}.
\label{step1}
\end{equation}

Second,
using convex-linearity of the map, we prove that one can represent the action of $M$ on states and effects simply as some linear maps within $\mathbf{RLinear}$; that is,
\begin{equation}
\tikzfig{Diagrams/63_Proof15}\ =\ \tikzfig{Diagrams/64_Proof16}
\qquad\text{and}\qquad
\tikzfig{Diagrams/65_Proof17}\ =\ \tikzfig{Diagrams/66_Proof18}.
\label{step2}
\end{equation}

Finally, we leverage empirical adequacy and the representation of the identity (a consequence of diagram preservation) to prove that these two %GPT processes
linear maps are inverses of each other; that is,
\begin{equation}
\tikzfig{Diagrams/77_DimBound1}\ =\ \ \tikzfig{Diagrams/78_DimBound2}
\qquad\text{and}\qquad
\tikzfig{Diagrams/75_Proof27}\ =\ \ \tikzfig{Diagrams/76_Proof28}.
\label{step3}
\end{equation}

This shows that the only freedom in the representation is in representation of the states, via the choice of linear maps $\chi_S$, of the theory; after specifying these, one can uniquely extend to the representation of arbitrary processes.

One key consequence of this result is the following corollary, whose significance we investigate in Section~\ref{subsec:conseq}.

\begin{corollary}
The dimension of the codomain, $V_A$ of the  map $\chi_A$ is given by the dimension of the GPT vector space $A$.
\label{cor:dimbound}
\end{corollary}
\proof
The linear map $\chi_A$ is invertible, so the dimension of its domain and of its codomain must be equal, and its domain is the GPT state space.
\endproof

Note that the proof of the structure theorem and this subsequent corollary do not require the full generality of diagram preservation, only the (mathematically) much weaker conditions that:
\begin{equation}
	\tikzfig{Diagrams/70_Proof22}\ =\ \tikzfig{Diagrams/69_Proof21}
	\quad \text{,}\quad
	\tikzfig{Diagrams/54_Proof6}\ =\ \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 2) {};
		\node [style=none] (1) at (0, -2) {};
		\node [style=none] (2) at (0.75, -1.75) {\tiny$M$};
		\node [style=none] (3) at (0, 2.75) {};
		\node [style=none] (4) at (0, -2.75) {};
		\node [style=none] (5) at (-1, -0.25) {};
		\node [style=none] (6) at (1, -0.25) {};
		\node [style=none] (7) at (1, -2) {};
		\node [style=none] (8) at (-1, -2) {};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_j$};
		\node [style=point] (10) at (0, 1.25) {$\widetilde{P}_i$};
		\node [style=none] (11) at (0.75, 0.5) {\tiny$M$};
		\node [style=none] (12) at (-1, 2) {};
		\node [style=none] (13) at (-1, 0.25) {};
		\node [style=none] (14) at (1, 0.25) {};
		\node [style=none] (15) at (1, 2) {};
        %\node[style=right label](16) at (0,2.5){$V_B$};
        %\node[style=right label](17) at (0,-2.5){$V_A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=green!20,draw=green!40](5.center) to (6.center) to (7.center) to (8.center) to cycle;
		\filldraw[fill=green!20,draw=green!40](12.center) to (13.center) to (14.center) to (15.center) to cycle;
		\draw (3.center) to (0.center);
		\draw (1.center) to (4.center);
		\draw [style=qWire] (9) to (1.center);
		\draw [style=qWire] (10) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
,
    \quad \text{and}\quad
    \tikzfig{Diagrams/73b_oneM}\ =\ \tikzfig{Diagrams/73_Proof25}.
\end{equation}
We will give justifications of these (for the case of ontological models and quasiprobabilistic models) in Sec.~\ref{revisassump}, and will
%return to discussing the full
discuss further
consequences of general diagram preservation in Sec.~\ref{onticseparability}.

\subsection{Diagram-preserving quasiprobabilistic models are exact frame representations}

As mentioned in the introduction, $\SubS$ and $\QSS$ are subprocess theories of $\RL$, $\SubS\subset \QSS \subset \RL$. This implies that our main theorem applies to these special cases. The fact that the codomain is restricted can then equivalently be expressed as a constraint on the linear maps $\chi_A$. In the case of quasiprobabilistic representations we obtain:
\begin{proposition} \label{qrepngptstruct}
Any diagram-preserving quasiprobabilistic model of a tomographically local GPT can be written as
\begin{equation}
  \tikzfig{Diagrams/41_QuasiRep1}\quad = \quad \tikzfig{Diagrams/42b_QuasiRep2hat}\label{eq:quasichi}
\end{equation}
for invertible linear maps $\{\chi_S:S\to \mathds{R}^{\Lambda_S}\}$ within $\RL$ for each system, where these satisfy
\begin{equation}\label{eq:quasidiscard}
\tikzfig{Diagrams/43b_QuasiRep3hat}\quad =\quad  \tikzfig{Diagrams/44_QuasiRep4}.
\end{equation}
\end{proposition}
\proof
Since $\hat{\xi}$ satisfies the requirements of Theorem~\ref{thm:structure} we immediately obtain Eq.~\eqref{eq:quasichi}. For the particular case of the deterministic effect, we have that
\begin{equation} \tikzfig{Diagrams/22c_Ont2_hat_nolbl}\quad =\quad \tikzfig{Diagrams/chi_inv_ground}. \end{equation}
Recall that, by definition, a quasiprobabilistic model satisfies Eq.~\eqref{eq:quasinorm}:
\begin{equation} \tikzfig{Diagrams/22c_Ont2_hat_nolbl}\quad =\quad \tikzfig{Diagrams/23b_Ont3_nolbl}. \end{equation}
Combining these gives
\begin{equation}\label{eq:simplexEmbed1} \tikzfig{Diagrams/23b_Ont3_nolbl}\quad =\quad \tikzfig{Diagrams/chi_inv_ground}.\end{equation}
Composing both sides of this with $\chi_S$ gives Eq.~\eqref{eq:quasidiscard}.
\endproof

The extra constraint of Eq.~\eqref{eq:quasidiscard} is not part of the general structure theorem because an abstract vector space does not have a natural notion of discarding. Such a privileged notion is found within, for example, $\mathbf{SubStoch}$, as the all ones covector, which represents marginalization.\footnote{Even within vector spaces with an associated physical interpretation of vectors as processes, there is not always a unique discarding map; for example, in the vector space of quantum channels, applying the channel to {\em any} fixed input state and tracing the output constitutes a discarding operation.}

Since the $\chi_S$ are just invertible linear maps, this map can be seen as merely transforming from one representation of the GPT to another. Critically, however, one must note that the vector spaces in $\QSS$ are all of the form $\mathds{R}^\Lambda$, and so they come equipped with extra structure---namely, a preferred basis and dual basis. Hence, these representations are effectively singling out this preferred basis for the GPT.

To see this more explicitly, denote the preferred basis and cobasis for $\mathds{R}^\Lambda$ as \blk
\beq
\left\{\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -.25) {$\lambda$};
		\node [style=none] (1) at (0, .75) {};
		\node [style=right label] (2) at (0, 0.5) {$\mathds{R}^\Lambda$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}\right\}_{\lambda\in\Lambda}
\quad\text{and}\quad
\left\{\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, .25) {$\lambda$};
		\node [style=none] (1) at (0, -.75) {};
		\node [style=right label] (2) at (0, -0.75) {$\mathds{R}^\Lambda$};
		\node [style=none] (3) at (0, -0.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}\right\}_{\lambda\in\Lambda}\quad\text{respectively,}
\eeq
which, in particular, means we can decompose identities as
\begin{equation}
	\tikzfig{Diagrams/69_Proof21}\  = \sum_{\lambda \in \Lambda} \tikzfig{Diagrams/lamlam}.
\end{equation}
This means that, for any system $A$ in the GPT, we can write $\chi_A$ as:
\beq\label{eq:frameDecomp}
\tikzfig{Diagrams/61_Proof13Qrepn}\ =
\sum_{\lambda\in\Lambda_A}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1) {};
		\node [style=small box, fill={purple!20}] (1) at (0, 0) {$\chi_A$};
		\node [style=copoint] (2) at (0, 1.25) {$\lambda$};
		\node [style=none] (4) at (0, 3.75) {};
		\node [style=point] (5) at (0, 2.75) {$\lambda$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2);
		\draw (4.center) to (5);
	\end{pgfonlayer}
\end{tikzpicture}
\ =: \sum_{\lambda\in\Lambda_A} \tikzfig{Diagrams/62_Proof14},\eeq
As $\chi_A$ is invertible, then $\{\widetilde{D}_\lambda^A\}_{\lambda\in\Lambda_A}$ is a cobasis for the GPT:
\beq
\left\{\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -0.75) {};
		\node [style=copoint, fill={purple!20}] (1) at (0, 0.25) {$\widetilde{D}_\lambda^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
	\end{pgfonlayer}
\end{tikzpicture}\right\}_{\lambda\in\Lambda_A},
\eeq
whereby condition \eqref{eq:quasidiscard} becomes
\beq
\sum_{\lambda \in \Lambda_A} \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -0.75) {};
		\node [style=copoint, fill={purple!20}] (1) at (0, 0.25) {$\widetilde{D}_\lambda^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
	\end{pgfonlayer}
    \end{tikzpicture}\ =\ \tikzfig{Diagrams/44_QuasiRep4}.\label{eq:cobasisdiscard}
\eeq

Similarly, we could run the same argument using $\chi^{-1}_A$ to single out a basis, $\{\widetilde{F}_\lambda^A\}_{\lambda\in\Lambda_A}$ for the GPT:
\beq 
\left\{
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0.75) {};
		\node [style=point, fill={purple!20}] (1) at (0, -0.25) {$\widetilde{F}_\lambda^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
	\end{pgfonlayer}
\end{tikzpicture}
\right\}_{\lambda\in\Lambda_A},
\eeq
where (by Eq.~\eqref{eq:simplexEmbed1}) $\forall \lambda$,
%\beq
%\sum_{\lambda \in \Lambda_A} \begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (0) at (0, -0.75) {};
%		\node [style=copoint, fill={purple!20}] (1) at (0, 0.25) {$\widetilde{F}_\lambda^A$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [qWire] (0.center) to (1);
%	\end{pgfonlayer}
%    \end{tikzpicture}\ =\ \tikzfig{Diagrams/44_QuasiRep4}.\label{eq:cobasisdiscard}
%\eeq
\beq \label{eq:cobasisdiscard2}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0.75) {};
		\node [style=point, fill={purple!20}] (1) at (0, -0.25) {$\widetilde{F}_\lambda^A$};
		\node [style=upground] (2) at (0, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
	\end{pgfonlayer}
\end{tikzpicture} = 1.
\eeq
Moreover, this decomposition, together with reversibility of $\chi_A$ means that
\begin{align}
\sum_{\lambda,\lambda'\in\Lambda_A}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {};
		\node [style=copoint, fill={purple!20}] (1) at (0, .75) {$\widetilde{D}_{\lambda'}^A$};
		\node [style=point, fill={purple!20}] (2) at (0, -.75) {$\widetilde{F}_\lambda^A$};
		\node [style=point] (3) at (2, 0.75) {$\lambda'$};
		\node [style=copoint] (4) at (2, -0.75) {$\lambda$};
		\node [style=none] (5) at (2, -2) {};
		\node [style=none] (6) at (2, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2) to (0.center);
		\draw [qWire] (0.center) to (1);
		\draw (3) to (6.center);
		\draw (4) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad &= \quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box, fill={purple!20}] (0) at (0, -1) {$\chi^{-1}_A$};
		\node [style=small box, fill={purple!20}] (1) at (0, 1) {$\chi_A$};
		\node [style=none] (2) at (0, 2) {};
		\node [style=none] (3) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
		\draw (3.center) to (0);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture} \nonumber \\
&= \quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1) {};
		\node [style=none] (1) at (0, -1) {};
		\node [style=none] (7) at (0, -1.5) {};
		\node [style=none] (8) at (0, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture} \nonumber \\
&=
\sum_{\lambda,\lambda'\in\Lambda_A}\delta_{\lambda\lambda'}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (3) at (0, 0.75) {$\lambda'$};
		\node [style=copoint] (4) at (0, -0.75) {$\lambda$};
		\node [style=none] (5) at (0, -2) {};
		\node [style=none] (6) at (0, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3) to (6.center);
		\draw (4) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture},
\end{align}
and hence
\beq \label{revimplies}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0.25) {};
		\node [style=point, fill={purple!20}] (1) at (0, -0.75) {$\widetilde{F}_\lambda^A$};
		\node [style=none] (2) at (0, 0) {};
		\node [style=copoint, fill={purple!20}] (3) at (0, 1) {$\widetilde{D}_{\lambda'}^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw [qWire] (2.center) to (3);
	\end{pgfonlayer}
\end{tikzpicture}\ =\ \delta_{\lambda\lambda'}.
\eeq
That is, $\{\widetilde{F}_\lambda^A\}_\lambda$ defines a basis of $V_A$ and $\{\widetilde{D}_{\lambda'}^A\}_{\lambda'}$ defines a dual basis of $V_A^*$.

We can then represent the action of $\hat{\xi}$ as:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (0, 1.5) {};
		\node [style=none] (2) at (0, -1.5) {};
		\node [style=none] (3) at (0.75, -1.25) {\tiny$\hat{\xi}$};
		\node [style=none] (4) at (0, 2.5) {};
		\node [style=none] (5) at (0, -2.5) {};
		\node [style=none] (6) at (-1, 1.5) {};
		\node [style=none] (7) at (1, 1.5) {};
		\node [style=none] (8) at (1, -1.5) {};
		\node [style=none] (9) at (-1, -1.5) {};
		\node [style=right label] (10) at (0, -2.25) {$\mathds{R}^{\Lambda_A}$};
		\node [style=right label] (11) at (0, -1) {$A$};
		\node [style=right label] (12) at (0, 0.75) {$B$};
		\node [style=right label] (13) at (0, 2) {$\mathds{R}^{\Lambda_B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=purple!20,draw=purple!40](9.center) to (6.center) to (7.center) to (8.center) to cycle;
		\draw [style=qWire] (2.center) to (0);
		\draw [style=qWire] (0) to (1.center);
		\draw (4.center) to (1.center);
		\draw (2.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
= \sum_{\lambda\in \Lambda_A,\lambda'\in \Lambda_B}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=copoint, fill={purple!20}] (1) at (0, 1.25) {$\widetilde{D}_{\lambda'}^B$};
		\node [style=point, fill={purple!20}] (2) at (0, -1.25) {$\widetilde{F}_\lambda^A$};
		\node [style=point] (3) at (2, 0.75) {$\lambda'$};
		\node [style=copoint] (4) at (2, -0.75) {$\lambda$};
		\node [style=none] (5) at (2, -2.75) {};
		\node [style=none] (6) at (2, 2.75) {};
		\node [style=right label] (7) at (2, -1.75) {$\mathds{R}^{\Lambda_A}$};
		\node [style=right label] (8) at (2, 1.75) {$\mathds{R}^{\Lambda_B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2) to (0);
		\draw [qWire] (0) to (1);
		\draw (3) to (6.center);
		\draw (4) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
which can be viewed as a quasistochastic map defined by the conditional quasiprobability distribution
\beq
\hat{\xi}(\widetilde{T})({\lambda'}|\lambda)= \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=copoint, fill={purple!20}] (1) at (0, 1.25) {$\widetilde{D}_{\lambda'}^B$};
		\node [style=point, fill={purple!20}] (2) at (0, -1.25) {$\widetilde{F}_\lambda^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2) to (0);
		\draw [qWire] (0) to (1);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq


\subsubsection{Diagram-preserving quasiprobabilistic models of quantum theory }
We now consider the case of quantum theory as a GPT. The basis $\{\widetilde{F}_{\lambda}\}_{\lambda\in\Lambda}$ is a basis for the real vector space of Hermitian operators for the system while the cobasis, $\{\widetilde{D}_{\lambda}\}_{\lambda\in\Lambda}$ is a basis for the space of linear functionals on the vector space of Hermitian operators.  The Riesz representation theorem~\cite{riesz1914demonstration} guarantees that every element $\widetilde{D}_{\lambda}$ of the cobasis can be represented via the Hilbert-Schmidt inner product with some Hermitian operator, which we will denote as $\widetilde{D}^*_{\lambda}$, such that for all $\rho$:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0.25) {};
		\node [style=point, none] (1) at (0, -0.75) {$\rho$};
		\node [style=none] (2) at (0, 0) {};
		\node [style=copoint, fill={purple!20}] (3) at (0, 1) {$\widetilde{D}_{\lambda'}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw [qWire] (2.center) to (3);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \
\widetilde{D}_{\lambda}\circ \rho = \mathsf{tr}(\widetilde{D}^*_{\lambda} \rho).
\eeq
The condition in Eq.~\eqref{eq:cobasisdiscard} becomes $\sum_\lambda \widetilde{D}^*_\lambda = \mathds{1}$, the condition in Eq.~\eqref{eq:cobasisdiscard2} becomes $\mathsf{tr}(\widetilde{F}_\lambda)=1$, and the condition of Eq.~\eqref{revimplies} becomes
\beq\label{eq:dualFrame}
\mathsf{tr}(\widetilde{D}^*_{\lambda'} \widetilde{F}_\lambda)=\delta_{\lambda\lambda'}.
\eeq
It is clear, therefore, that $\{ \widetilde{F}_\lambda \}_\lambda$ and $\{ \widetilde{D}^*_\lambda \}_\lambda$ constitute a  minimal frame and its dual (in the language of, for example, Refs.~\cite{ferrie2008frame}). Hence, this representation is nothing but an exact frame representation, that is, one which is not overcomplete.
That is, a transformation $\widetilde{T}$, represented by a completely positive trace preserving map $\mathcal{E}_{\widetilde{T}}$, will be represented as a quasistochastic map defined by the conditional quasiprobability distribution:
\beq
\hat{\xi}(\widetilde{T})({\lambda'}|\lambda) = \mathsf{tr}(\widetilde{D}^*_{\lambda'}\mathcal{E}_{\widetilde{T}}(\widetilde{F}_\lambda))
\eeq
It is easy to see that any set of spanning and linearly independent vectors summing to identity will define a suitable dual frame $\{\widetilde{D}^*_\lambda\}$, and then the frame $\{\widetilde{F}_\lambda\}$ itself is uniquely defined by Eq.~\eqref{eq:dualFrame}. (Note in particular that the elements of the frame need not be pairwise orthogonal, nor must those of the dual frame.)

It has previously been shown that all quasiprobabilistic models of quantum theory are frame representations~\cite{ferrie2008frame}. What we learn here is that {\em diagram-preserving} quasiprobabilistic models are necessarily the simplest possible frame representations, namely those that are not overcomplete.


\subsection{Structure theorems for ontological models}

In the case of ontological models of a GPT, we obtain:
\begin{proposition}
Any diagram-preserving ontological model of a tomographically local GPT can be written as
\begin{equation}
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (0, 1.5) {};
		\node [style=none] (2) at (0, -1.5) {};
		\node [style=none] (3) at (0.75, -1.25) {\tiny$\widetilde{\xi}$};
		\node [style=none] (4) at (0, 2.5) {};
		\node [style=none] (5) at (0, -2.5) {};
		\node [style=none] (6) at (-1, 1.5) {};
		\node [style=none] (7) at (1, 1.5) {};
		\node [style=none] (8) at (1, -1.5) {};
		\node [style=none] (9) at (-1, -1.5) {};
		\node [style=right label] (10) at (0, -2.25) {$\mathds{R}^{\Lambda_A}$};
		\node [style=right label] (11) at (0, -1) {$A$};
		\node [style=right label] (12) at (0, 0.75) {$B$};
		\node [style=right label] (13) at (0, 2) {$\mathds{R}^{\Lambda_B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](9.center) to (6.center) to (7.center) to (8.center) to cycle;
		\draw [style=qWire] (2.center) to (0);
		\draw [style=qWire] (0) to (1.center);
		\draw (4.center) to (1.center);
		\draw (2.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad = \quad \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=small box, fill={Red!20}] (1) at (0, 1.75) {$\chi_B$};
		\node [style=small box, fill={Red!20}] (2) at (0, -1.75) {$\chi_A^{-1}$};
		\node [style=none] (3) at (0, 3.25) {};
		\node [style=none] (4) at (0, -3.25) {};
		\node [style=right label] (5) at (0, -3) {$\mathds{R}^{\Lambda_A}$};
		\node [style=right label] (6) at (0, -1) {$A$};
		\node [style=right label] (7) at (0, 0.75) {$B$};
		\node [style=right label] (8) at (0, 2.75) {$\mathds{R}^{\Lambda_B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2) to (0);
		\draw [qWire] (0) to (1);
		\draw (4.center) to (2);
		\draw (1) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
,
  \label{eq:ontchi}
\end{equation}
where
\begin{equation}\label{eq:ontchidiscard}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.5, -1) {};
		\node [style=small box,fill={Red!20}] (1) at (-0.5, -0) {$\chi_A$};
		\node [style=none] (2) at (-0.5, 1) {};
		\node [style=upground] (3) at (-0.5, 1.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1.center);
		\draw  (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\  \tikzfig{Diagrams/44_QuasiRep4}
\end{equation}
and where moreover every pair $(\chi_A^{-1},\chi_B)$ defines a {\em positive} map from the cone of transformations from $A$  to $B$ in the GPT $\widetilde{\Op}$ to the cone of substochastic maps from $\Lambda_A$ to $\Lambda_B$ in $\SubS$.
\label{prop:structureOM}
\end{proposition}

The proof is given in Appendix~\ref{propstructureOMproof}. Apart from positivity, the proof follows immediately from Proposition~\ref{qrepngptstruct}.

One can interpret this map from the GPT to the ontological model as an explicit embedding into a simplicial GPT as discussed in \cite{schmid2019characterization}, but generalized to the case in which both the GPT under consideration and the simplicial GPT have arbitrary processes, not just states and effects. This follows from the positivity conditions, empirical adequacy, and the preservation of the deterministic effect.

As in the case of quasiprobabilistic models, we can write out $\chi_A$ as:
\begin{equation}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1) {};
		\node [style=small box, fill={Red!20}] (1) at (0, -0) {$\chi_A$};
		\node [style=none] (2) at (0, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \sum_{\lambda\in\Lambda_A} \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1.75) {};
		\node [style=copoint,fill=Red!20] (1) at (0, -.875) {$\widetilde{D}_\lambda^A$};
		\node [style=point] (2) at (0, 1) {$\lambda$};
		\node [style=none] (3) at (0, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (3.center) to (2);
	\end{pgfonlayer}
\end{tikzpicture}
,
\label{eq:chidecomp}
\end{equation}
where $\{ \widetilde{D}_\lambda^A\}_\lambda$ forms a basis for the vector space of the GPT defined by the operational theory. The positivity condition for $\chi_A$ discussed above immediately implies that $\widetilde{D}_{\lambda}^A$ is a linear functional which is positive on the state cone, and the normalization condition immediately implies that their sum over $\lambda$ is the deterministic effect. By a similar argument, each $\widetilde{F}_\lambda^A$ is a vector in the vector space of states which is positive on all GPT effects.

In the case of a GPT which satisfies the no-restriction hypothesis \cite{chiribella2010probabilistic} (e.g., quantum theory and the classical probabilistic theory),  this means that the $\widetilde{D}_\lambda^A$  are effects (forming a measurement) and that the $\widetilde{F}_\lambda^A$ are states.
In the quantum case, the notion of positivity that we have expressed here
 reduces to  positivity of the eigenvalues of the Hermitian operators. This provides another immediate proof that quantum theory, as a GPT, does not admit an ontological model---it would require an exact frame and dual frame for the space of Hermitian operators which are all positive, but it is known that such a basis and dual do not exist \cite{ferrie2008frame}.

We have shown (Theorem~\ref{thm:NCOMandOM}) that every noncontextual ontological model of an operational theory is equivalent to an ontological model of the GPT defined by the operational theory.
Combining this with proposition~\ref{prop:structureOM}, it immediately follows that:
\begin{corollary}
 For operational theories whose corresponding GPT satisfies tomographic locality, any noncontextual ontological model can be written as
%Any noncontextual ontological model of a operational theory whose corresponding GPT satisfies tomographic locality can be written as\blk
\[\tikzfig{Diagrams/45_NCRep1}\quad =\quad\tikzfig{Diagrams/45b_NCRep1b} \quad =\quad \tikzfig{Diagrams/46_NCRep2}\]
for
\[\tikzfig{Diagrams/61_Proof13}\ = \sum_{\lambda\in\Lambda_A} \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -2) {};
		\node [style=copoint,fill=Red!20] (1) at (0, -0.875) {$\widetilde{D}_\lambda^A$};
		\node [style=point] (2) at (0, 1) {$\lambda$};
		\node [style=none] (3) at (0, 2) {};
        \node [style=right label] (16) at (0, 1.75) {$\mathds{R}^{\Lambda_A}$};
        \node [style=right label] (18) at (0, -1.75) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (3.center) to (2);
	\end{pgfonlayer}
\end{tikzpicture},\]
where $\{ \widetilde{D}_\lambda^A\}_\lambda$ forms a basis for the vector space of the GPT defined by the operational theory.
\end{corollary}

Previously, the notion of a noncontextual ontological representation seemed to be a highly flexible concept, but this corollary demonstrates that it in fact has a very rigid structure. Every noncontextual ontological model can be constructed in two steps: i) quotient to the associated GPT, ii) pick a basis for the GPT such that it is manifestly an ontological model. Furthermore, the only freedom in the representation is in representation of the {\em states} in the theory (via this choice of basis); after specifying this, one can uniquely extend to the representation of arbitrary processes.


\subsection{Consequences of the dimension bound}\label{subsec:conseq}

 Corollary~\ref{cor:dimbound} implies that any noncontextual ontological model of an operational theory whose corresponding GPT is tomographically local must have the same number of ontic states as the dimension of the GPT state space. In the language of Hardy \cite{Hardy2004}, this exactly means that the ``ontological excess baggage factor'' $\gamma$ must be exactly $1$.  In other words, demanding {\em  noncontextuality rules out ontological excess baggage}. Since Hardy showed that all ontological models of a qubit must in fact have an unbounded ontological excess baggage factor, his result can immediately be combined with ours to give a new proof that the full statistics of processes on a qubit do not admit a noncontextual model.

In particular, our result implies that a diagram-preserving noncontextual ontological model of a {\em qubit} must have exactly $4$ ontic states. This extends to 
%any tomographically complete subtheory of a qubit, such as the stabilizer subtheory.
any subtheory of a qubit whose corresponding GPT is tomographically local, e.g. the stabilizer subtheory. Hence, it constitutes a stringent constraint on ontological models of the qubit stabilizer subtheory qua operational theory. 
%\rob For the stabilizer case, this result\blk is extremely restrictive. 
%E.g.,
For instance, it immediately guarantees that the $8$-state model of Ref.~\cite{8state}---which, as the name suggests, has 8 ontic states---
%$8$-state model~\cite{8state}
must be contextual.   Indeed, the $8$-state model was previously shown to be contextual by a different argument which focused on the representation of transformation procedures in prepare-transform-measure scenarios
%established that it was transformation-contextual
~\cite{lillystone2019single}.

%Furthermore, one can combine our bound on the number of ontic states to resolve a question raised in Ref.~\cite{schmid2019characterization}, yielding a powerful new method for testing whether a given GPT (or set of experimental data) admits of an ontological model or not. That is, Ref.~\cite{schmid2019characterization} provides an algorithm for determining if a GPT admits of an ontological model by testing whether or not the GPT embeds in a simplicial GPT of arbitrary dimension, but with the limitation
%that the test for embedding must be repeated for every possible dimension of the simplicial GPT until an embedding is found (with no guarantee that the algorithm will ever terminate). However, our dimension bound simplifies this algorithm dramatically: rather than testing for embedding in a sequence of simplicial GPTs of increasing dimension, one can simply perform a single test for embedding in a simplicial GPT of the same dimension as the GPT (or set of data) being tested.

Furthermore, our bound improves an algorithm first proposed in Ref.~\cite{schmid2019characterization}.
In particular,  Ref.~\cite{schmid2019characterization} gave an algorithm for determining if a GPT admits of an ontological model by testing whether or not the GPT embeds in a simplicial GPT of arbitrary dimension.
%but with the limitation that the test for embedding must be repeated for every possible dimension of the simplicial GPT until an embedding is found (
The lack of a bound on this dimension means that there is no guarantee that the algorithm will ever terminate.
%However, Ref.~\cite{gitton2020solvable} proved that such an embedding, if it exists, can always be achieved in a simplicial GPT of dimension at most the square of the given GPT's dimension. This simplifies the algorithm dramatically: rather than testing for embedding in a sequence of simplicial GPTs of increasing dimension, one can simply perform a single test for embedding in a simplicial GPT of  dimension given by the square of that of the GPT being tested.
%Our dimension bound strengthens this result by showing that one need in fact only test for embedding up to the same dimension as the GPT being tested. In fact, our bound is tight, as there can never be an embedding of the GPT into a lower dimensional space.
Ref.~\cite{gitton2020solvable} solves this problem by providing such a bound, namely, the square of the given GPT's dimension. Our result strengthens this bound, reducing it to the given GPT's dimension. In fact, our bound is tight, as there can never be an embedding of the GPT into a lower dimensional space.
These results simplify the algorithm dramatically: rather than testing for embedding in a sequence of simplicial GPTs of increasing dimension, one can simply perform a single test for embedding in a simplicial GPT of the same dimension as the given GPT.



\subsection{Diagram preservation implies ontic separability}\label{onticseparability}


Returning to representations of a GPT by some \colorbox{green!20}{$M:\widetilde{\Op}\to \RL$} satisfying the conditions of Thm.~\ref{thm:structure}: 
 if we make use of additional instances of diagram preservation beyond the three instances which we used in proving Thm.~\ref{thm:structure}, then we can derive additional constraints on the representation.
%we can derive constraints coming from diagram preservation beyond the three particular instances which we used in proving Thm.~\ref{thm:structure}. 
In particular, by considering parallel composition we obtain the following:
\begin{proposition}
%Applying the assumption of diagram preservation to
Via diagram preservation, parallel composition implies an additional constraint on the linear maps, $\chi_A$, namely,
\begin{equation}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.5, -1.25) {};
		\node [style=small box, fill={green!20}] (1) at (-0.5, 0) {$\chi_{AB}$};
		\node [style=none] (2) at (-0.5, 1.25) {};
		\node [style=none] (6) at (-0.5, -1) {};
		\node [style=right label] (7) at (-0.5, -1.25) {$A\otimes B$};
		\node [style=right label] (9) at (-0.5, 1) {$V_A\otimes V_B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
=\quad\tikzfig{Diagrams/39_LinRep3}\quad = \quad \tikzfig{Diagrams/40_LinRep4}.
\label{parconst}
\end{equation}
\end{proposition}
\proof
Recall that for any system $S$, one has
\begin{equation}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -0.75) {$\widetilde{P}$};
		\node [style={small box}, fill={green!20}] (1) at (0, 0.75) {$\chi_S$};
		\node [style=none] (2) at (0, 2) {};
		\node [style={right label}] (3) at (0, -0.25) {$S$};
		\node [style={right label}] (4) at (0, 1.75) {$V_S$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0) to (1);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad =\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1) {};
		\node [style=none] (1) at (0, 1.75) {};
		\node [style=point] (2) at (0, 0) {$\widetilde{P}$};
		\node [style=none] (3) at (0.75, -0.75) {\tiny$M$};
		\node [style=none] (4) at (-1, 1) {};
		\node [style=none] (5) at (-1, -1) {};
		\node [style=none] (6) at (1, -1) {};
		\node [style=none] (7) at (1, 1) {};
		\node [style=right label] (8) at (0, 1.5) {$V_S$};
		\node [style=right label] (9) at (0, 0.5) {$S$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=green!20,draw=green!40](5.center) to (6.center) to (7.center) to (4.center) to cycle;
		\draw (1.center) to (0.center);
		\draw [style=qWire] (2) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
.
\end{equation}
Hence if we apply $\chi_{AB}$ to a product state we have
\begin{equation} \tikzfig{Diagrams/prod_chi}\quad =\quad \tikzfig{Diagrams/prod_M}.
\end{equation}
Since $M$ is diagram-preserving, we have
\begin{equation} \tikzfig{Diagrams/prod_M}\quad =\quad \tikzfig{Diagrams/prod_M2}.
\end{equation}
Recalling the definition of $\chi_S$ again, we conclude that
\begin{equation} \tikzfig{Diagrams/prod_chi}\quad =\quad \tikzfig{Diagrams/prod_chi2}. \label{forPBR}
\end{equation}
In a tomographically local GPT, the product states span the entire state space, and so this implies Eq.~\eqref{parconst}.
\endproof

Now, if we consider the case of quasiprobabilistic representations, \colorbox{purple!20}{$\hat{\xi}: \widetilde{\Op} \to \QSS$}, we obtain that:
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1.5) {};
		\node [style=small box, fill={purple!20}] (1) at (0, -0) {$\chi_{AB}$};
		\node [style=none] (2) at (0, 1.5) {};
        \node[style=right label] (3) at (0,1.25) {$\mathds{R}^{\Lambda_{AB}}$};
        \node[style=right label] (4) at (0,-1.25) {${A\otimes B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad =\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1.5) {};
		\node [style=small box, fill={purple!20}] (1) at (0, -0) {$\chi_{A}$};
		\node [style=none] (2) at (0, 1.5) {};
        \node[style=right label] (3) at (0,1.25) {$\mathds{R}^{\Lambda_{A}}$};
        \node[style=right label] (4) at (0,-1.25) {${A}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1.5) {};
		\node [style=small box, fill={purple!20}] (1) at (0, -0) {$\chi_{B}$};
		\node [style=none] (2) at (0, 1.5) {};
        \node[style=right label] (3) at (0,1.25) {$\mathds{R}^{\Lambda_{B}}$};
        \node[style=right label] (4) at (0,-1.25) {${B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
.
\eeq
 Given Eq.~\eqref{eq:frameDecomp}, this is equivalent to
\beq\label{parallelcomposition}
\sum_{\lambda \in \Lambda_{AB}}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -2.5) {};
		\node [style=copoint,fill=purple!20] (1) at (0, -1) {$\widetilde{D}_\lambda^{AB}$};
		\node [style=point] (2) at (0, 1.5) {$\lambda$};
		\node [style=none] (3) at (0, 2.5) {};
        \node[style=right label] (4) at (0,2.25) {$\mathds{R}^{\Lambda_{AB}}$};
        \node[style=right label] (5) at (0,-2.25) {${A\otimes B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (3.center) to (2);
	\end{pgfonlayer}
\end{tikzpicture}
\quad
=
\sum_{\lambda'\in \Lambda_A,\lambda''\in\Lambda_B}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -2.5) {};
		\node [style=copoint,fill=purple!20] (1) at (0, -1) {$\widetilde{D}_{\lambda'}^{A}$};
		\node [style=point] (2) at (0, 1.5) {$\lambda'$};
		\node [style=none] (3) at (0, 2.5) {};
        \node[style=right label] (4) at (0,2.25) {$\mathds{R}^{\Lambda_{A}}$};
        \node[style=right label] (5) at (0,-2.25) {${A}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (3.center) to (2);
	\end{pgfonlayer}
\end{tikzpicture}
\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -2.5) {};
		\node [style=copoint,fill=purple!20] (1) at (0, -1) {$\widetilde{D}_{\lambda''}^{B}$};
		\node [style=point] (2) at (0, 1.5) {$\lambda''$};
		\node [style=none] (3) at (0, 2.5) {};
        \node[style=right label] (4) at (0,2.25) {$\mathds{R}^{\Lambda_{B}}$};
        \node[style=right label] (5) at (0,-2.25) {${B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (3.center) to (2);
	\end{pgfonlayer}
\end{tikzpicture}
.
\eeq
That is, diagram preservation implies that the frame representation must factorize across subsystems. In other words, the vector basis defining the frame representation must be a product basis.\footnote{This can be seen as a more restrictive version of Thm.~(11) in \cite{van2017quantum} where we consider strict monoidal rather than strong monoidal functors.}

We can also note that this means that $\mathds{R}^{\Lambda_{AB}} = \mathds{R}^{\Lambda_A}\otimes \mathds{R}^{\Lambda_B}$ which in turn means that $\Lambda_{AB} = \Lambda_A \times \Lambda_B$. That is, the sample space of a composite system is the \emph{Cartesian product} of the sample spaces of the components.\footnote{This result can also be seen as an immediate consequence of diagram preservation for composite {\em systems} (rather than processes).}

This constraint has particular significance if we consider the case of ontological models, \colorbox{Red!20}{$\widetilde{\xi}:\widetilde{\Op}\to\SubS$}, as this means that for an ontological model, the ontic state space of a composite system is the Cartesian product of the ontic state spaces of the components.  
%\rob This assumption is termed \blk
We term the latter condition
 {\em ontic separability} (See Refs.~\cite{Spekkens2015,Harrigan}).  It is a species of reductionism, asserting, in effect, that composite systems have no holistic properties.  More precisely, the property ascriptions to composite systems are all and only the property ascriptions to their components. Yet another way of expressing the condition is that the properties of the whole supervene on the properties of the parts.

The assumption of ontic separability for ontological models has been discussed in many prior works \cite{Spekkens2015,Harrigan}, and has been a substantive assumption in certain arguments.  For instance, in Ref.~\cite{Spekkens2014}, ontic separability was used to demonstrate that  in a noncontextual ontological model, all and only projective measurements are represented outcome-deterministically.


 It is also worth noting that the assumption of preparation independence in the PBR theorem~\cite{Pusey2012} follows from diagram preservation (e.g. Eq.~\eqref{forPBR}).
This connection between PBR and preservation of compositional structure has been previously explored in Sec.~4 of \cite{gheorghiu2019ontological}, in which they use this connection to derive a categorical version of the PBR theorem.

\subsection{Converses to structure theorems}

In the above section we showed how all diagram-preserving quasiprobabilistic and ontological representations must have a particularly simple form given by a collection of invertible linear maps $\{\chi_A\}$ satisfying certain constraints. We now prove what is essentially the converse to each of these results.

Consider defining a map from $\widetilde{\Op}$ to $\RL$ by
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (0, 1.5) {};
		\node [style=none] (2) at (0, -1.5) {};
		\node [style=right label] (11) at (0, -1) {$A$};
		\node [style=right label] (12) at (0, 0.75) {$B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (2.center) to (0);
		\draw [style=qWire] (0) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad \mapsto \quad \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=small box, fill={black!20}] (1) at (0, 1.75) {$\chi_B$};
		\node [style=small box, fill={black!20}] (2) at (0, -1.75) {$\chi_A^{-1}$};
		\node [style=none] (3) at (0, 3.25) {};
		\node [style=none] (4) at (0, -3.25) {};
		\node [style=right label] (5) at (0, -3) {$V_A$};
		\node [style=right label] (6) at (0, -1) {$A$};
		\node [style=right label] (7) at (0, 0.75) {$B$};
		\node [style=right label] (8) at (0, 2.75) {$V_B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2) to (0);
		\draw [qWire] (0) to (1);
		\draw (4.center) to (2);
		\draw (1) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}. \label{mapwconstr}
\eeq
Under what conditions on the set $\{\chi_A\}$ is this map a quasiprobabilistic or ontological representation?

To ensure that Eq.~\eqref{mapwconstr} defines a diagram-preserving map one must simply impose that:
\begin{equation}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\chi_{AB}$};
		\node [style=none] (1) at (-1, 0.5) {};
		\node [style=none] (2) at (1, 0.5) {};
		\node [style=none] (3) at (1, -0.5) {};
		\node [style=none] (4) at (-1, -0.5) {};
		\node [style=none] (5) at (-0.5, 0.5) {};
		\node [style=none] (6) at (-0.5, 1.25) {};
		\node [style=none] (7) at (0.5, 1.25) {};
		\node [style=none] (8) at (0.5, 0.5) {};
		\node [style=none] (9) at (-0.5, -0.5) {};
		\node [style=none] (10) at (-0.5, -1.25) {};
		\node [style=none] (11) at (0.5, -0.5) {};
		\node [style=none] (12) at (0.5, -1.25) {};
		\node [style=right label] (13) at (-0.5, -1.25) {$A$};
		\node [style=right label] (14) at (0.5, -1.25) {$B$};
		\node [style=right label] (15) at (-0.5, 1) {$V_A$};
		\node [style=right label] (16) at (0.5, 1) {$V_B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!20,draw=black](1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw (6.center) to (5.center);
		\draw (7.center) to (8.center);
		\draw [qWire] (9.center) to (10.center);
		\draw [qWire] (11.center) to (12.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad = \quad \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.5, -1.25) {};
		\node [style=small box, fill={black!20}] (1) at (-0.5, 0) {$\chi_A$};
		\node [style=none] (2) at (-0.5, 1.25) {};
		\node [style=none] (3) at (1, 1.25) {};
		\node [style=small box, fill={black!20}] (4) at (1, 0) {$\chi_B$};
		\node [style=none] (5) at (1, -1.25) {};
		\node [style=none] (6) at (-0.5, -1) {};
		\node [style=right label] (7) at (-0.5, -1.25) {$A$};
		\node [style=right label] (8) at (1, -1.25) {$B$};
		\node [style=right label] (9) at (-0.5, 1) {$V_A$};
		\node [style=right label] (10) at (1, 1) {$V_B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2.center);
		\draw [qWire] (5.center) to (4);
		\draw (4) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
.
\end{equation}
This condition, together with invertibility and linearity of the $\chi_A$, easily implies that diagram preservation and indeed all the assumptions of Theorem~\ref{mainthm} are satisfied.

To ensure that Eq.~\eqref{mapwconstr} defines a linear representation that is moreover a quasiprobabilistic representation, as in Def.~\ref{def:quasi}, one must impose that $V_A=\mathds{R}^{\Lambda_A}$ and that
\begin{equation}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.5, -1) {};
		\node [style={small box}, fill={black!20}] (1) at (-0.5, -0) {$\chi_A$};
		\node [style=none] (2) at (-0.5, 1.25) {};
		\node [style=upground] (3) at (-0.5, 1.5) {};
		\node [style=right label] (4) at (-0.5, -1) {$A$};
		\node [style=right label] (5) at (-0.5, 0.75) {$\mathds{R}^{\Lambda_A}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1);
		\draw (1) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad =\quad  \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -0.75) {};
		\node [style=none] (1) at (0, 0.25) {};
		\node [style=upground] (2) at (0, 0.5) {};
		\node [style=right label] (3) at (0, -0.5) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture},
\end{equation}
which implies that the conditions in Def.~\ref{def:quasi} are satisfied.

Finally, to ensure that Eq.~\eqref{mapwconstr} defines a quasiprobabilistic representation that is moreover an ontological representation, as in Def.~\ref{defnontgpt}, one must introduce a positivity constraint for this map. Specifically, one must have that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style={small box}, fill={black!20}] (0) at (0, 1.75) {$\chi_B$};
		\node [style={small box}, fill={black!20}] (1) at (0, -1.75) {$\chi_A^{-1}$};
		\node [style=none] (2) at (0, 3.25) {};
		\node [style=none] (3) at (0, -3.25) {};
		\node [style={right label}] (4) at (0, -3) {$\mathds{R}^{\Lambda_A}$};
		\node [style={right label}] (5) at (0, -1) {$A$};
		\node [style={right label}] (6) at (0, 0.75) {$B$};
		\node [style={right label}] (7) at (0, 2.75) {$\mathds{R}^{\Lambda_B}$};
		\node [style=none] (8) at (0, 0.5) {};
		\node [style=none] (9) at (0, -0.5) {};
		\node [style=none] (10) at (-0.5, 0.5) {};
		\node [style=none] (11) at (0.5, 0.5) {};
		\node [style=none] (12) at (0.5, -0.5) {};
		\node [style=none] (13) at (-0.5, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.center) to (1);
		\draw (0) to (2.center);
		\draw [qWire] (0) to (8.center);
		\draw [qWire] (9.center) to (1);
		\draw[thick gray dashed edge] (10.center) to (11.center);
		\draw [thick gray dashed edge](11.center) to (12.center);
		\draw[thick gray dashed edge] (12.center) to (13.center);
		\draw [thick gray dashed edge](13.center) to (10.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad :: \quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (3) at (0, 1) {};
		\node [style=none] (4) at (0, -1) {};
		\node [style=right label] (6) at (0, -1) {$A$};
		\node [style=right label] (7) at (0, 0.75) {$B$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (4) to (0);
		\draw [qWire] (0) to (3);
	\end{pgfonlayer}
\end{tikzpicture}
\quad  \mapsto \quad\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=small box, fill={black!20}] (1) at (0, 1.75) {$\chi_B$};
		\node [style=small box, fill={black!20}] (2) at (0, -1.75) {$\chi_A^{-1}$};
		\node [style=none] (3) at (0, 3.25) {};
		\node [style=none] (4) at (0, -3.25) {};
		\node [style=right label] (5) at (0, -3) {$\mathds{R}^{\Lambda_A}$};
		\node [style=right label] (6) at (0, -1) {$A$};
		\node [style=right label] (7) at (0, 0.75) {$B$};
		\node [style=right label] (8) at (0, 2.75) {$\mathds{R}^{\Lambda_B}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2) to (0);
		\draw [qWire] (0) to (1);
		\draw (4.center) to (2);
		\draw (1) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
defines a positive map from the cone of transformations from $A$ to $B$ in $\widetilde{\Op}$ to the cone of stochastic maps from $\Lambda_A$ to $\Lambda_B$.

This provides a simple recipe for constructing linear representations: one simply needs to choose a family of invertible linear maps for each fundamental system (i.e., one that cannot be further decomposed into subsystems),
%for each system which cannot decompose into subsystems,
 and then define the others as the tensor product of these (so that general $\chi_A$ factorise over subsystems). Similarly, it provides a simple recipe for constructing quasiprobabilistic representations, using the same construction but where the $\chi_A$ preserve the deterministic effect. In the case of noncontextual ontological models, however, the recipe is less simple: one must not only choose invertible linear maps which  factorise over subsystems and preserve the deterministic effect; one must also check the positivity condition (which is nontrivial, since for any particular map $\chi_A$, one must check the condition for every $\chi_B$).

\section{Revisiting our assumptions} \label{revisassump}

We have derived surprisingly strong constraints on the form of noncontextual ontological models of operational theories,
and so it is important to examine the assumptions that went into deriving these constraints.
These concerned both the types of operational theories under consideration and the types of ontological representations of these,
and were summarized in Section~\ref{secassumptions}. The majority of these are ubiquitous and well-motivated.
The only notable restriction on the scope of operational theories we consider is the one induced by our  assumption of tomographic locality  (as discussed further in Section~\ref{neclt}).
Similarly, the only notable restriction
on ontological (and quasiprobabilistic) models that is warranting of further discussion is that they are diagram-preserving.

%In the case of ontological models, we provide a motivation for the assumption of diagram preservation below.  We believe that the best motivation for making this assumption for quasiprobabilistic models is simply that these are best understood as representations of operational theories wherein the {\em only} difference from an ontological model is that the probabilities are allowed to become quasiprobabilities (i.e., drawn from the reals rather than the interval $[0,1]$).  Indeed, this is the definition we have proposed in this work.
%Although one {\em could} pursue a notion of quasiprobabilistic model that did not follow this proposal, we note that it fits well with much previous work.
%The quasiprobabilistic representations pursued in the quantum optics community, such as the Wigner representation, as well as the Q~\cite{Husimi} and P representations~\cite{Pfunc1,Pfunc2}, have this feature \rnote{I need to double-check this}.
%%Similarly, both Hardy \cite{} and Fuchs \cite{} adopt this approach. \rnote{I need to double-check this.}.
%There are exceptions, however. For instance, Wootters' proposal \cite{} for a discrete Wigner function uses a frame that does not factorize across subsystems.  The discrete Wigner function proposed by Gross \cite{}, however, does use a factorizing frame, and this is the one that has found more widespread use in the study of nonclassicality of Clifford subtheories of quantum theory \david[citations??]\blk.
\subsection{Revisiting diagram preservation}

%In the case of ontological models, we provide a motivation for the instances of diagram preservation that we required for our proofs below. Since we have defined quasiprobabilistic models as representations of operational theories wherein the {\em only} difference from an ontological model is that the probabilities are allowed to become quasiprobabilities (i.e., drawn from the reals rather than the interval $[0,1]$), it follows that these same motivations are also applicable to them.
%It is worth noting that among the quasiprobabilistic representations studied in the literature, the Wigner representation and the discrete Wigner functions proposed by Gross~\cite{gross2006hudson} satisfy our definition. The Q~\cite{Husimi} and P representations~\cite{Pfunc1,Pfunc2}  do not satisfy our definition, as they are defined by overcomplete frames. Wootters' proposal \cite{} for a discrete Wigner function also does not satisfy our definition, as it is defined by a frame that does not factorize across subsystems. Notably, the representations which have found the most widespread use (especially in the study of nonclassicality) are those which satisfy our definition---the Wigner and discrete Wigner representations.
%%The discrete Wigner function proposed by Gross \cite{}, however, does use a factorizing frame, and this is the one that has found more widespread use in the study of nonclassicality of Clifford subtheories of quantum theory \david[citations??]\blk.

In the case of ontological models, we will provide below a motivation for the instances of diagram preservation that we required for our proofs. Since we have defined quasiprobabilistic models as representations of operational theories wherein the {\em only} difference from an ontological model is that the probabilities are allowed to become quasiprobabilities (i.e., drawn from the reals rather than the interval $[0,1]$), it follows that these same motivations are also applicable to them.
It is worth noting that among the quasiprobabilistic representations for continuous variable quantum systems that are most studied in the literature, the Wigner representation satisfies our definition\footnote{Strictly speaking, one would need to generalize our definition to the case of infinite-dimensional GPTs.} while the Q~\cite{Husimi} and P representations~\cite{Pfunc1,Pfunc2} do not (as they are defined by overcomplete frames).  There are also examples of both types among quasiprobabilistic representations of finite-dimensional systems in quantum theory.
In particular, Ref.~\cite{citeGHW} defines a family of discrete Wigner representations, some of which satisfy the assumption of diagram preservation, and some of which do not. Of special note among those that satisfy the assumption is Gross' discrete Wigner representation~\cite{gross2006},  which is the unique representation in this family that satisfies a natural covariance property (which we conjecture follows from the assumption of noncontextuality).
%~\cite{Grossunique}).  \david Are we confident enough in the conjecture to keep the current title for this hopefully-forthcoming work?\blk
%For $n$ $d$-dimensional systems, he notes that one can define two different discrete Wigner representations: the first considers the discrete symplectic group defined for each $d$-level system and the second considers the one defined for the full $d^n$-dimensional system. Only the first corresponds to a frame representation that factorizes across systems and fits our definition, 
% Notably, the representations which have found the most widespread use (especially in the study of negativity in quasiprobability representations as a resource for information processing) are the ones that fit our definition.


Although we endorse diagram preservation in its most general form, it is worth noting that
our main results (given in Section~\ref{mainresults}) require only the following very specific {\em instances} of that assumption:
\begin{enumerate}[label=(\roman*)]
\item diagram preservation for prepare-measure scenarios,
\begin{equation}\label{dp1}
\widetilde{\xi}::\
	\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, .75) {$\widetilde{E}$};
		\node [style=point] (1) at (0, -.75) {$\widetilde{P}$};
		\node [style=none] (4) at (0.75, 0.25) {};
		\node [style=none] (13) at (0, -0.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire](1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\quad \mapsto\quad \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, 1) {$\widetilde{E}$};
		\node [style=point] (1) at (0, -1) {$\widetilde{P}$};
		\node [style=none] (2) at (0.5, 0.375) {\tiny$\widetilde{\xi}$};
		\node [style=none] (3) at (0.5, -1.5) {\tiny$\widetilde{\xi}$};
		\node [style=none] (4) at (0.75, 0.125) {};
		\node [style=none] (5) at (0.75, 1.75) {};
		\node [style=none] (6) at (-0.75, 1.75) {};
		\node [style=none] (7) at (-0.75, 0.125) {};
		\node [style=none] (8) at (-0.75, -0.25) {};
		\node [style=none] (9) at (-0.75, -1.75) {};
		\node [style=none] (10) at (0.75, -1.75) {};
		\node [style=none] (11) at (0.75, -0.25) {};
		\node [style=none] (12) at (0, 0.25) {};
		\node [style=none] (13) at (0, -0.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=Red!20,draw=Red!40](5.center) to (6.center) to (7.center) to (4.center) to cycle;
		\filldraw[fill=Red!20,draw=Red!40](8.center) to (9.center) to (10.center) to (11.center) to cycle;
		\draw [qWire](1) to (13.center);
		\draw (13.center) to (12.center);
		\draw [qWire](12.center) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
.
\end{equation}
and diagram preservation for measure-and-reprepare processes
\beq \label{dp2}
\widetilde{\xi}::\
	\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 2) {};
		\node [style=none] (1) at (0, -2) {};
		\node [style=copoint] (10) at (0, -1) {$\widetilde{E}$};
		\node [style=point] (11) at (0, 1) {$\widetilde{P}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (10) to (1.center);
		\draw [style=qWire] (11) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad \mapsto\quad \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 2) {};
		\node [style=none] (1) at (0, -2) {};
		\node [style=none] (2) at (0.75, -1.75) {\tiny$\widetilde{\xi}$};
		\node [style=none] (3) at (0, 2.75) {};
		\node [style=none] (4) at (0, -2.75) {};
		\node [style=none] (5) at (-1, -0.25) {};
		\node [style=none] (6) at (1, -0.25) {};
		\node [style=none] (7) at (1, -2) {};
		\node [style=none] (8) at (-1, -2) {};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}$};
		\node [style=point] (10) at (0, 1.25) {$\widetilde{P}$};
		\node [style=none] (11) at (0.75, 0.5) {\tiny$\widetilde{\xi}$};
		\node [style=none] (12) at (-1, 2) {};
		\node [style=none] (13) at (-1, 0.25) {};
		\node [style=none] (14) at (1, 0.25) {};
		\node [style=none] (15) at (1, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=Red!20,draw=Red!40](5.center) to (6.center) to (7.center) to (8.center) to cycle;
		\filldraw[fill=Red!20,draw=Red!40](12.center) to (13.center) to (14.center) to (15.center) to cycle;
		\draw (3.center) to (0.center);
		\draw (1.center) to (4.center);
		\draw [style=qWire] (9) to (1.center);
		\draw [style=qWire] (10) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
,
\eeq
\item  diagram preservation for the identity process
\begin{equation}\label{dp3}
\widetilde{\xi}::\ \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1) {};
		\node [style=none] (1) at (0, -1) {};
		\node [style=right label] (2) at (0, -.5) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire](0.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad \mapsto\quad \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1) {};
		\node [style=none] (1) at (0, -1) {};
		\node [style=right label] (2) at (0, -.5) {$\Lambda_A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\end{equation}
\end{enumerate}

These are easily justified.

Eq.~\eqref{dp1} captures the idea that the ontic state is the complete causal mediary between the preparation and the effect.  This assumption is built into the very definition of the standard ontological models framework
%~\cite{Spekkens2005,Harrigan}
(implicitly in early work~\cite{Spekkens2005,Harrigan} and explicitly in later work~\cite{Krishna_2017,Schmid2018}), and is 
%explicitly
 assumed in virtually every past work on ontological models.

Eq.~\eqref{dp2} is a similarly natural assumption.
The natural view of the process
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 2) {};
		\node [style=none] (1) at (0, -2) {};
		%\node [style=none] (2) at (0.75, -1.75) {\tiny$M$};
		\node [style=none] (3) at (0, 2.75) {};
		\node [style=none] (4) at (0, -2.75) {};
		\node [style=none] (5) at (-1, -0.25) {};
		\node [style=none] (6) at (1, -0.25) {};
		\node [style=none] (7) at (1, -2) {};
		\node [style=none] (8) at (-1, -2) {};
		\node [style=copoint] (9) at (0, -1) {$\widetilde{E}$};
		\node [style=point] (10) at (0, 1) {$\widetilde{P}$};
		%\node [style=none] (11) at (0.75, 0.5) {\tiny$M$};
		\node [style=none] (12) at (-1, 2) {};
		\node [style=none] (13) at (-1, 0.25) {};
		\node [style=none] (14) at (1, 0.25) {};
		\node [style=none] (15) at (1, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=qWire] (9) to (1.center);
		\draw [style=qWire] (10) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
is that one has observed effect $\widetilde{E}$ and then one has independently implemented the preparation $\widetilde{P}$. There need not be any system acting as a causal mediary between $\widetilde{E}$ and $\widetilde{P}$.
  The natural ontological representation, therefore,
is one wherein
there is no ontic state mediating the two processes,
as depicted in Eq.~\eqref{dp2}.  Although we are not aware of this assumption having been made in previous works, it is directly analogous to the
%ontic separability assumption described in Sec. ??, and hence to the
preparation-independence assumption made in Ref.~\cite{Pusey2012} (which involved two independent states, rather than an independent effect and state).

Eq.~\eqref{dp3} can be justified by noting that within the equivalence class of procedures associated to the identity operation in the GPT, there is the one which corresponds to waiting for a vanishing amount of time.
In any reasonable physical theory, no evolution is possible in vanishing time, and hence the only valid ontological representation of such an equivalence class of procedures is the identity map on the ontic state space.

Because we consider the full assumption of diagram preservation to be a natural generalization of all of these specific assumptions, we have endorsed it in our definitions.
 See Appendix B of Ref.~\cite{schmid2020unscrambling} for a more thorough defense of this full assumption.
%In particular, it is shown that this assumption follows from a stipulation that one chooses the operational diagram (whose structure we demand be preserved by the mapping) to represent one's hypothesis about the fundamental causal-inferential structure.


\subsection{Necessity of tomographic locality} \label{neclt}
The assumption of tomographic locality is common in the GPT literature, so we will not attempt a defense of it here. Nevertheless, it is natural to ask if the assumption is actually necessary to obtain our structure theorems. Here we provide an example which shows that it is. The operational theory we consider in our example is the real-amplitude version of the qutrit stabilizer subtheory of quantum theory\footnote{Note that in order for this to be an operational theory according to our definitions herein, we are here referring to the `convexified' stabilizer subtheory in which all convex combinations of, for example, the pure stabilizer states are permitted.}. In this subtheory, two systems are described by $45$ parameters, whereas only $6^2 = 36$ parameters are available from local measurements, which immediately implies that the theory is not tomographically local (just as the real-amplitude version of the full quantum theory fails to be tomographically local~\cite{hardy2012limited}).
%\rob [PROBLEM: I'm not sure it is possible to make an argument based on parameter-counting for the stabilizer theory since there is only a finite number of states therein.  Is the idea to ask how many $\mathbb{Z}_3$-valued parameters are necessary?  If so, does the counting come out as we claim?  Might it be better to give the parameter-based argument for the full real-amplitude theory and merely state that tomographical locality also fails for the stabilizer subtheory thereof?] \blk

To begin with, consider the standard (complex-amplitude) qutrit stabilizer subtheory. Gross's discrete Wigner function~\cite{gross2006} 
%(in particular, the one that fits our definition) 
provides a (diagram-preserving) quasiprobability representation for qutrits for which the stabilizer subtheory is positively represented.  By Corollary~\ref{cor:three}, this corresponds to a noncontextual ontological model of the subtheory. 
%(In fact, this is the {\em unique} noncontextual ontological model for qutrit the stabilizer subtheory.) 
Indeed, this ontological model has been examined in Ref.~\cite{epistricted}, where it is shown that it can be reconstructed from an ``epistemic restriction''. Since the standard qutrit stabilizer subtheory is tomographically local, these models obey our structure theorems. In particular, the representation of $n$ qutrits uses $9^n$ ontic states, matching the dimension of the relevant space of density matrices.

Now consider the subtheory consisting of only those qutrit stabilizer procedures that can be represented using real amplitudes. This does not introduce any new operational equivalences, and so the model discussed above is still noncontextual when restricted to this subtheory. But now our structure theorem does not hold, because this model still uses $9^n$ ontic states even though the density matrices now live in a $\frac12 3^n(3^n+1)$-dimensional space.

Moreover, we can show that this sort of example is rather generic, that is, that there is no hope of obtaining a structure theorem with our dimension bound for any theory that is not tomographically local. 

%Suppose that we have any ontological representation $\widetilde{\xi}$ of some GPT $\widetilde{\Op}$, in which the main corollary of our structure theorem (namely, the dimension bound) holds, then the GPT $\widetilde{\Op}$ is necessarily tomographically local. 
Suppose that we have any ontological representation $\widetilde{\xi}$ of some GPT wherein each GPT system of dimension $d$ is represented by an ontic state space of cardinality $d$. Then the GPT is necessarily tomographically local.

To see this, consider the representation of GPT transformations from this state space to itself. Then, the map $\widetilde{\xi}$ is a linear map from the space of transformations to
$d\times d$ substochastic matrices, which are $d^2$ dimensional. By empirical
adequacy $\xi$ is injective, and so the space of GPT transformations is at most $d^2$
dimensional. But the effect-prepare channels already span $d^2$
dimensions, so there cannot be any channels outside this span. Hence,
by Corollary~\ref{corolTL}, the theory is tomographically local.

%To see that this is the case, suppose the GPT state space of a given system is $d$
%dimensional, so that by assumption $\widetilde{\xi}$ uses $d$ ontic states to represent this state space. Now consider
%$\widetilde{\xi}$ on the space of GPT transformations from this state space to itself. $\widetilde{\xi}$ is a linear map from the space of transformations to
%$d\times d$ substochastic matrices, which are $d^2$ dimensional. By empirical
%adequacy $\xi$ is injective. Hence the space of GPT transformations is at most $d^2$
%dimensional. But the effect-prepare channels already span $d^2$
%dimensions, so there cannot be any channels outside this span. Hence,
%by Corollary~\ref{corolTL} the theory is tomographically local.}

\section{Outlook}


These results can be directly applied to the study of contextuality in specific scenarios and theories. For instance, we have already seen that our dimension bound is a useful tool for obtaining novel proofs of contextuality (e.g., via Hardy's ontological excess baggage theorem \cite{Hardy2004} or for the 8-state model of Ref.~\cite{8state}), and for providing novel algorithms for deriving noise-robust noncontextuality inequalities (namely, the algorithm in Ref.~\cite{schmid2019characterization} but informed by our dimension bound).
%\rob for deriving noncontextuality inequalities\blk (which are more noise-robust than previous methods, as argued in Ref.~\cite{schmid2019characterization}).
 It remains to be seen whether other algorithms for witnessing nonclassicality, such as those in Ref.~\cite{Schmid2018} or Ref~\cite{Krishna_2017}, could be extended within our framework to more general compositional scenarios.

Our formalism is also ideally suited to understanding the information-theoretic advantages afforded by  contextual operational theories, such as for computational speedup, since it has the compositional flexibility to describe arbitrary scenarios, such as families of circuits which arise in the gate-based model of computation.
%In fact, our structure theorem is a major first step in simplifying the proof that contextuality is the resource powering the state-injection model of quantum computing. Such a proof would proceed by applying our structure theorem to show that the {\em only} positive quasiprobabilistic models of the (classically-simulable) stabilizer subtheory for prime dimensions are given by Gross's discrete Wigner function~\cite{Grossunique}; then, the known fact that the injected resource states in the model are represented negatively would establish the result in a direct and elegant fashion.
In fact, our structure theorem is a major first step in simplifying the proof that contextuality is a necessary resource for the state-injection model of quantum computing~\cite{magic}. Such a proof would proceed by applying our structure theorem to show that the {\em only} positive quasiprobabilistic models of the (classically-simulable) stabilizer subtheory for prime dimensions are given by Gross's discrete Wigner function~\cite{Grossunique}; then, the known fact that the injected resource states necessarily have negative representation in this particular model would establish the result in a direct and elegant fashion.


The key limitation of our results is the assumption that the  GPT associated to the operational theory under consideration is tomographically local.
There are two potential approaches to dealing with this limitation. On the one hand, one could provide an argument that theories which are not tomographically local are undesirable in some principled sense. For example, it seems likely that one can rule them out on the grounds that they violate Leibniz's methodological principle~\cite{Leibniz}. From a practical perspective, wherein the goal is to experimentally verify nonclassicality in a theory-independent manner, one would instead be motivated to seek experimental evidence that nature truly satisfies tomographic locality, independent of the validity of quantum theory. One possible approach to this end would be to extend
%further develop
 the techniques introduced in \cite{bootstraptomography} to composite systems.



\section*{Acknowledgements}
We thank Matt Leifer, Lorenzo Catani, Shane Mansfield, and Martti Karvonen for useful discussions.
We thank Giulio Chiribella for useful discussions on quotiented operational theories and their relation to GPTs.
RWS thanks Bob Coecke for early discussions on the topic of understanding noncontextuality in a category-theoretic way. JHS thanks Lucien Hardy for many discussions on tomographic locality and the duotensor formalism during PSI and since, and thanks John van de Wetering for helpful discussions on his work on quasistochastic representations of quantum theory. We also acknowledge the First Perimeter Institute-Chapman Workshop on Quantum Foundations (PIMan) as the venue that spawned this collaborative project.
DS is supported by a Vanier Canada Graduate Scholarship. MFP is supported by the Royal Commission for the Exhibition of 1851. This research was supported in part by the Foundation for Polish Science (IRAP project,
ICTQT, contract no. 2018/MAB/5, co-financed by EU
within Smart Growth Operational Programme). This research was supported by Perimeter Institute for Theoretical Physics. Research at Perimeter Institute is supported in part by the Government of Canada through the Department of Innovation, Science and Economic Development Canada and by the Province of Ontario through the Ministry of Colleges and Universities.

\bibliographystyle{apsrev4-1}
\bibliography{context}





\appendix
\onecolumngrid

\section{Proof that quotienting is diagram-preserving} \label{app:quotDP}


In order to see that the quotienting map is diagram-preserving, we must first define what it means for processes in the quotiented theory to be composed. That is, given a suitable pair of equivalence class $\widetilde{T}$ and $\widetilde{R}$, we must define $\widetilde{R}\circ \widetilde{T}$ (assuming that the relevant type matching constraint is satisfied) and  $\widetilde{R}\otimes \widetilde{T}$. We define these via composition of some choice of representative elements, $r \in \widetilde{R}$ and $t\in \widetilde{T}$, for each equivalence class, as
\beq
\tikzfig{Diagrams/n1-seqComp1}\ \ :=\ \ \tikzfig{Diagrams/n2-seqComp2} \qquad \text{and}\qquad \tikzfig{Diagrams/n3-parComp1}\ \ :=\ \ \tikzfig{Diagrams/n4-parComp2}. 
\eeq
For this to be well defined, it must be independent of the choices of representatives, i.e. for any $t_1, t_2 \in \widetilde{T}$ and $r_1, r_2\in \widetilde{R}$, one has
\beq 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{r_1\circ t_1}$};
		\node [style=none] (2) at (0, -1.25) {};
		\node [style=none] (3) at (0, 1.25) {};
		\node [style=none] (4) at (-1.25, 0.75) {};
		\node [style=none] (5) at (1.25, 0.75) {};
		\node [style=none] (6) at (1.25, -0.75) {};
		\node [style=none] (7) at (-1.25, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (2.center);
		\draw [qWire] (3.center) to (0.center);
		\draw [fill=white] (6.center)
			 to (7.center)
			 to (4.center)
			 to (5.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture}
\ \ = \ \ 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{r_2\circ t_2}$};
		\node [style=none] (2) at (0, -1.25) {};
		\node [style=none] (3) at (0, 1.25) {};
		\node [style=none] (4) at (-1.25, 0.75) {};
		\node [style=none] (5) at (1.25, 0.75) {};
		\node [style=none] (6) at (1.25, -0.75) {};
		\node [style=none] (7) at (-1.25, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (2.center);
		\draw [qWire] (3.center) to (0.center);
		\draw [fill=white] (6.center)
			 to (7.center)
			 to (4.center)
			 to (5.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture}
\qquad\text{and}\qquad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (7) at (-0.75, -0.75) {};
		\node [style=none] (8) at (-0.75, -1.5) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (0.75, -1.5) {};
		\node [style=none] (12) at (-0.75, 1.5) {};
		\node [style=none] (13) at (-0.75, 0.75) {};
		\node [style=none] (14) at (0.75, 1.5) {};
		\node [style=none] (15) at (0.75, 0.75) {};
		\node [style=none] (16) at (0, 0) {$\widetilde{r_1\otimes t_1}$};
		\node [style=none] (17) at (-1.25, 0.75) {};
		\node [style=none] (18) at (-1.25, -0.75) {};
		\node [style=none] (19) at (1.25, -0.75) {};
		\node [style=none] (20) at (1.25, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (7.center) to (8.center);
		\draw [qWire] (10.center) to (11.center);
		\draw [qWire] (12.center) to (13.center);
		\draw [qWire] (14.center) to (15.center);
		\draw [fill=white] (18.center)
			 to (17.center)
			 to (20.center)
			 to (19.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture}
\ \ = \ \ 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (7) at (-0.75, -0.75) {};
		\node [style=none] (8) at (-0.75, -1.5) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (0.75, -1.5) {};
		\node [style=none] (12) at (-0.75, 1.5) {};
		\node [style=none] (13) at (-0.75, 0.75) {};
		\node [style=none] (14) at (0.75, 1.5) {};
		\node [style=none] (15) at (0.75, 0.75) {};
		\node [style=none] (16) at (0, 0) {$\widetilde{r_2\otimes t_2}$};
		\node [style=none] (17) at (-1.25, 0.75) {};
		\node [style=none] (18) at (-1.25, -0.75) {};
		\node [style=none] (19) at (1.25, -0.75) {};
		\node [style=none] (20) at (1.25, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (7.center) to (8.center);
		\draw [qWire] (10.center) to (11.center);
		\draw [qWire] (12.center) to (13.center);
		\draw [qWire] (14.center) to (15.center);
		\draw [fill=white] (18.center)
			 to (17.center)
			 to (20.center)
			 to (19.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
or equivalently
\beq \label{LHEappone}
\tikzfig{Diagrams/n10-cong1}\ \  \sim \ \  \tikzfig{Diagrams/n11-cong2} \qquad \text{and} \qquad \tikzfig{Diagrams/n12-cong3}\ \  \sim \ \  \tikzfig{Diagrams/n14-cong4}.
\eeq
If this is the case, then the quotienting map is a structure-preserving equivalence relation, or \emph{congruence relation}, for the process theory.



It is straightforward to show that the first equality in Eq.~\eqref{LHEappone} is equivalent to the conditions
\beq \label{firstequivappone}
\forall\ r \quad \tikzfig{Diagrams/n19-congSeq1} \ \sim  \ \tikzfig{Diagrams/n20-congSeq2}
\quad \text{and}  \quad \forall\ t \quad 
\tikzfig{Diagrams/n21-congSeq3} \ \sim  \ \tikzfig{Diagrams/n22-congSeq4}
\ . 
\eeq
To verify the nontrivial direction of this equivalence, consider the special case of these where $r=r_1$ (in the first) and where $t=t_2$ (in the second); then, one has
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, -0.75) {$t_1$};
		\node [style=small box] (1) at (0, 0.75) {$r_1$};
		\node [style=none] (2) at (0, -1.75) {};
		\node [style=none] (3) at (0, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (1);
		\draw [qWire] (1) to (0);
		\draw [qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ \sim \ \ 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, -0.75) {$t_2$};
		\node [style=small box] (1) at (0, 0.75) {$r_1$};
		\node [style=none] (2) at (0, -1.75) {};
		\node [style=none] (3) at (0, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (1);
		\draw [qWire] (1) to (0);
		\draw [qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ = \ \ 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, -0.75) {$t_2$};
		\node [style=small box] (1) at (0, 0.75) {$r_1$};
		\node [style=none] (2) at (0, -1.75) {};
		\node [style=none] (3) at (0, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (1);
		\draw [qWire] (1) to (0);
		\draw [qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ \sim \ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, -0.75) {$t_2$};
		\node [style=small box] (1) at (0, 0.75) {$r_2$};
		\node [style=none] (2) at (0, -1.75) {};
		\node [style=none] (3) at (0, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (1);
		\draw [qWire] (1) to (0);
		\draw [qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
Similarly, the second equality in Eq.~\eqref{LHEappone} is equivalent to the conditions
\beq
\forall\ r\quad \tikzfig{Diagrams/n15-congPar1} \ \sim  \ \tikzfig{Diagrams/n16-congPar2}
\quad \text{and} \quad \forall\ t \quad
\tikzfig{Diagrams/n17-congPar3} \ \sim  \ \tikzfig{Diagrams/n18-congPar4}\ .
\eeq
We now prove that the first of these four conditions (namely, the first equivalence in Eq.~\eqref{firstequivappone}) holds:
\begin{align}
\tikzfig{Diagrams/n23-proof1}\ \sim\ \tikzfig{Diagrams/n24-proof2} \quad &\iff \quad \forall \tau \ \ \tikzfig{Diagrams/n25-proof3} \  = \  \tikzfig{Diagrams/n26-proof4} \\
                    & \implies \quad \forall \tau' \ \ \tikzfig{Diagrams/n27-proof5} \  = \  \tikzfig{Diagrams/n28-proof6} \\
                    & \iff \quad \tikzfig{Diagrams/n19-congSeq1} \ \sim  \ \tikzfig{Diagrams/n20-congSeq2}
\end{align}
where in the second step we are noting that
\beq
\tikzfig{Diagrams/n29-proof7}
\eeq
is an example of a tester $\tau$ for any $\tau'$ and $r$. 
%Note that this step is not an if and only if, as, in general, not every tester $\tau$ can be written in this form.
The argument for the other three conditions is analogous.

This establishes that the notion of composition that we have defined is independent of the choice of representative elements, and so we can simply write 
\beq
\tikzfig{Diagrams/n1-seqComp1}\ \ =\ \ \tikzfig{Diagrams/n2-seqComp2}\ \ = \ \ 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{R\circ T}$};
		\node [style=none] (2) at (0, -1.25) {};
		\node [style=none] (3) at (0, 1.25) {};
		\node [style=none] (4) at (-1.25, 0.75) {};
		\node [style=none] (5) at (1.25, 0.75) {};
		\node [style=none] (6) at (1.25, -0.75) {};
		\node [style=none] (7) at (-1.25, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (2.center);
		\draw [qWire] (3.center) to (0.center);
		\draw [fill=white] (6.center)
			 to (7.center)
			 to (4.center)
			 to (5.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture}
 \qquad \text{and}\qquad \tikzfig{Diagrams/n3-parComp1}\ \ =\ \ \tikzfig{Diagrams/n4-parComp2} \ \ = \ \ 
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (7) at (-0.75, -0.75) {};
		\node [style=none] (8) at (-0.75, -1.5) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (0.75, -1.5) {};
		\node [style=none] (12) at (-0.75, 1.5) {};
		\node [style=none] (13) at (-0.75, 0.75) {};
		\node [style=none] (14) at (0.75, 1.5) {};
		\node [style=none] (15) at (0.75, 0.75) {};
		\node [style=none] (16) at (0, 0) {$\widetilde{R\otimes T}$};
		\node [style=none] (17) at (-1.25, 0.75) {};
		\node [style=none] (18) at (-1.25, -0.75) {};
		\node [style=none] (19) at (1.25, -0.75) {};
		\node [style=none] (20) at (1.25, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (7.center) to (8.center);
		\draw [qWire] (10.center) to (11.center);
		\draw [qWire] (12.center) to (13.center);
		\draw [qWire] (14.center) to (15.center);
		\draw [fill=white] (18.center)
			 to (17.center)
			 to (20.center)
			 to (19.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
Now, recalling that
\beq
\tikzfig{Diagrams/n30-proofextra1}\ \ := \ \ \tikzfig{Diagrams/n31-proofextra2}
\eeq
it follows that the quotienting map is diagram-preserving:
\begin{align}
\tikzfig{Diagrams/n5-seqCompPres1}\ \  
&= \ \ \tikzfig{Diagrams/n6-seqCompPres3}\ \ = \ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{R\circ T}$};
		\node [style=none] (2) at (0, -1.25) {};
		\node [style=none] (3) at (0, 1.25) {};
		\node [style=none] (4) at (-1.25, 0.75) {};
		\node [style=none] (5) at (1.25, 0.75) {};
		\node [style=none] (6) at (1.25, -0.75) {};
		\node [style=none] (7) at (-1.25, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0.center) to (2.center);
		\draw [qWire] (3.center) to (0.center);
		\draw [fill=white] (6.center)
			 to (7.center)
			 to (4.center)
			 to (5.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture}\ \ = \ \ \ \ \ \tikzfig{Diagrams/n1-seqComp1} \ \ \ \ \ \ = \ \ \ \ \ \ \tikzfig{Diagrams/n6-seqCompPres2}\ , \\
\tikzfig{Diagrams/n9-parCompPres1} \ \  &= \ \ \tikzfig{Diagrams/n8-parCompPres2} \ \ = \ \  \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (7) at (-0.75, -0.75) {};
		\node [style=none] (8) at (-0.75, -1.5) {};
		\node [style=none] (10) at (0.75, -0.75) {};
		\node [style=none] (11) at (0.75, -1.5) {};
		\node [style=none] (12) at (-0.75, 1.5) {};
		\node [style=none] (13) at (-0.75, 0.75) {};
		\node [style=none] (14) at (0.75, 1.5) {};
		\node [style=none] (15) at (0.75, 0.75) {};
		\node [style=none] (16) at (0, 0) {$\widetilde{R\otimes T}$};
		\node [style=none] (17) at (-1.25, 0.75) {};
		\node [style=none] (18) at (-1.25, -0.75) {};
		\node [style=none] (19) at (1.25, -0.75) {};
		\node [style=none] (20) at (1.25, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (7.center) to (8.center);
		\draw [qWire] (10.center) to (11.center);
		\draw [qWire] (12.center) to (13.center);
		\draw [qWire] (14.center) to (15.center);
		\draw [fill=white] (18.center)
			 to (17.center)
			 to (20.center)
			 to (19.center)
			 to cycle;
	\end{pgfonlayer}
\end{tikzpicture} \ \ = \ \  \tikzfig{Diagrams/n3-parComp1} \ \ = \ \ \tikzfig{Diagrams/n7-parCompPres3}\ .
\end{align}
\blk


\section{Proof of Lemma~\ref{bilinearityprf}}\label{sec:bilinearity}
We now prove Lemma~\ref{bilinearityprf}, restated here:
\begin{lemma}
The operation $\smallsquare$ induces a bilinear map
\beq
\smallsquare:\left(\mathds{R}^{m^{B\to C}},\mathds{R}^{m^{A\to B}}\right)\to \mathds{R}^{m^{A\to C}},
\eeq
and the operation $\smallboxtimes$ induces a bilinear map
\beq
\smallboxtimes : \left(\mathds{R}^{m^{A\to B}}, \mathds{R}^{m^{C\to D}}\right)\to \mathds{R}^{m^{{AC}\to{BD}}}.
\eeq
\end{lemma}

\proof
We will only prove linearity of $\smallsquare$ in the second argument, as the rest of the proof is analogous.

Consider the case that
\begin{equation} \label{linconstraint2}
\mathbf{R}_{\widetilde{T}} = \sum_i r_i \mathbf{R}_{\widetilde{T}_i},
\end{equation}
 which by Eq.~\eqref{linearityconst} means that for all $\widetilde{\tau}$,
\beq \label{eq:proofII1}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (2.25, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (2.25, 0.75) {};
		\node [style=none] (2) at (2.25, -0.75) {};
		\node [style=none] (3) at (1.75, 0.75) {};
		\node [style=none] (4) at (1.75, 1.25) {};
		\node [style=none] (5) at (3.5, 1.25) {};
		\node [style=none] (6) at (3.5, -1.25) {};
		\node [style=none] (7) at (1.75, -1.25) {};
		\node [style=none] (8) at (1.75, -0.75) {};
		\node [style=none] (9) at (3, 0.75) {};
		\node [style=none] (10) at (3, -0.75) {};
		\node [style=none] (11) at (3.25, 0) {$\widetilde{\tau}$};
		\node [style=none] (17) at (6.5, 0.75) {};
		\node [style=none] (19) at (7, 0.75) {};
		\node [style=none] (20) at (8.25, 1.25) {};
		\node [style=none] (21) at (7.75, 0.75) {};
		\node [style=small box] (22) at (7, 0) {$\widetilde{T}_i$};
		\node [style=none] (23) at (6.5, -0.75) {};
		\node [style=none] (25) at (7, -0.75) {};
		\node [style=none] (26) at (8.25, -1.25) {};
		\node [style=none] (27) at (6.5, 1.25) {};
		\node [style=none] (29) at (6.5, -1.25) {};
		\node [style=none] (30) at (7.75, -0.75) {};
		\node [style=none] (31) at (8, 0) {$\widetilde{\tau}$};
		\node [style=none] (34) at (5, 0) {$=\sum_i r_i$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	\filldraw[fill=white,draw=black] (7.center) to (6.center) to (5.center) to (4.center) to (3.center) to (9.center) to (10.center) to (8.center) to cycle;	
\filldraw[fill=white,draw=black] (29.center) to (26.center) to (20.center) to (27.center) to (17.center) to (21.center) to (30.center) to (23.center) to cycle;
		\draw [style=qWire] (0) to (1.center);
		\draw [style=qWire] (0) to (2.center);
		\draw [style=qWire] (22) to (19.center);
		\draw [style=qWire] (22) to (25.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
Now, define
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (-1, 1.25) {};
		\node [style=none] (4) at (-1, 1.75) {};
		\node [style=none] (5) at (1, 1.25) {};
		\node [style=none] (6) at (1, -1.25) {};
		\node [style=none] (7) at (2, 1.75) {};
		\node [style=none] (8) at (2, -1.75) {};
		\node [style=none] (9) at (-1, -1.75) {};
		\node [style=none] (10) at (-1, -1.25) {};
		\node [style=none] (11) at (1.5, 0) {$\widetilde{\tau}'$};
		\node [style=none] (12) at (0, -1.25) {};
		\node [style=none] (13) at (0, -0.75) {};
		\node [style=none] (14) at (0, 0.75) {};
		\node [style=none] (15) at (0, 1.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (4.center) to (3.center);
		\draw (3.center) to (5.center);
		\draw (5.center) to (6.center);
		\draw (6.center) to (10.center);
		\draw (10.center) to (9.center);
		\draw (9.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (4.center);
		\draw [qWire] (13.center) to (12.center);
		\draw [qWire] (15.center) to (14.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ :=\ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0.75) {$\widetilde{T}'$};
		\node [style=none] (1) at (0, -0.25) {};
		\node [style=none] (2) at (0, 1.75) {};
		\node [style=none] (3) at (-1, 1.75) {};
		\node [style=none] (4) at (-1, 2.25) {};
		\node [style=none] (5) at (1, 1.75) {};
		\node [style=none] (6) at (1, -1.75) {};
		\node [style=none] (7) at (2, 2.25) {};
		\node [style=none] (8) at (2, -2.25) {};
		\node [style=none] (9) at (-1, -2.25) {};
		\node [style=none] (10) at (-1, -1.75) {};
		\node [style=none] (11) at (1.5, -0.25) {$\widetilde{\tau}$};
		\node [style=none] (12) at (0, -1.75) {};
		\node [style=none] (13) at (0, -1.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1.center) to (0);
		\draw [qWire] (0) to (2.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (5.center);
		\draw (5.center) to (6.center);
		\draw (6.center) to (10.center);
		\draw (10.center) to (9.center);
		\draw (9.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (4.center);
		\draw [qWire] (13.center) to (12.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
for some arbitrary $\widetilde{\tau}$ and transformation $\widetilde{T}'$. Substituting tester $\widetilde{\tau}'$ into Eq.~\eqref{eq:proofII1} we find that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0.75) {$\widetilde{T}'$};
		\node [style=small box] (1) at (0, -0.75) {$\widetilde{T}$};
		\node [style=none] (2) at (0, 1.75) {};
		\node [style=none] (3) at (-1, 1.75) {};
		\node [style=none] (4) at (-1, 2.25) {};
		\node [style=none] (5) at (1, 1.75) {};
		\node [style=none] (6) at (1, -1.75) {};
		\node [style=none] (7) at (2, 2.25) {};
		\node [style=none] (8) at (2, -2.25) {};
		\node [style=none] (9) at (-1, -2.25) {};
		\node [style=none] (10) at (-1, -1.75) {};
		\node [style=none] (11) at (1.5, -0.25) {$\widetilde{\tau}$};
		\node [style=none] (12) at (0, -1.75) {};
		\node [style=none] (13) at (0, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
		\draw [qWire] (0) to (2.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (5.center);
		\draw (5.center) to (6.center);
		\draw (6.center) to (10.center);
		\draw (10.center) to (9.center);
		\draw (9.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (4.center);
		\draw [qWire] (13.center) to (12.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ = \sum_i r_i
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0.75) {$\widetilde{T}'$};
		\node [style=small box] (1) at (0, -0.75) {$\widetilde{T}_i$};
		\node [style=none] (2) at (0, 1.75) {};
		\node [style=none] (3) at (-1, 1.75) {};
		\node [style=none] (4) at (-1, 2.25) {};
		\node [style=none] (5) at (1, 1.75) {};
		\node [style=none] (6) at (1, -1.75) {};
		\node [style=none] (7) at (2, 2.25) {};
		\node [style=none] (8) at (2, -2.25) {};
		\node [style=none] (9) at (-1, -2.25) {};
		\node [style=none] (10) at (-1, -1.75) {};
		\node [style=none] (11) at (1.5, -0.25) {$\widetilde{\tau}$};
		\node [style=none] (12) at (0, -1.75) {};
		\node [style=none] (13) at (0, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
		\draw [qWire] (0) to (2.center);
		\draw (4.center) to (3.center);
		\draw (3.center) to (5.center);
		\draw (5.center) to (6.center);
		\draw (6.center) to (10.center);
		\draw (10.center) to (9.center);
		\draw (9.center) to (8.center);
		\draw (8.center) to (7.center);
		\draw (7.center) to (4.center);
		\draw [qWire] (13.center) to (12.center);
	\end{pgfonlayer}
\end{tikzpicture}
.
\eeq
As this holds for all $\widetilde{\tau}$,
%we therefore have that:
 tomography implies that
\beq
\mathbf{R}_{\widetilde{T}'\circ \widetilde{T}} = \sum_i r_i \mathbf{R}_{\widetilde{T}'\circ\widetilde{T}_i}
\eeq
Using the fact that $\mathbf{R}_{\widetilde{T}'\circ \widetilde{T}} = \mathbf{R}_{\widetilde{T}'}\smallsquare \mathbf{R}_{\widetilde{T}}$ and similarly that $\mathbf{R}_{\widetilde{T}'\circ \widetilde{T}_i} = \mathbf{R}_{\widetilde{T}'}\smallsquare \mathbf{R}_{\widetilde{T}_i}$ we find that:
\beq
\mathbf{R}_{\widetilde{T}'}\smallsquare \mathbf{R}_{\widetilde{T}} = \sum_i r_i\left(\mathbf{R}_{\widetilde{T}'}\smallsquare \mathbf{R}_{\widetilde{T}_i}\right)
\eeq
and hence, by substituting Eq.~\eqref{linconstraint2} on the LHS, one has
\beq
\mathbf{R}_{\widetilde{T}'}\smallsquare \left(\sum_i r_i \mathbf{R}_{\widetilde{T}_i}\right) = \sum_i r_i(\mathbf{R}_{\widetilde{T}'}\smallsquare \mathbf{R}_{\widetilde{T}_i})
\eeq
This proves that $\smallsquare$ is linear in the second argument.
\endproof

\section{Proof of Lemma~\ref{lemmadecomp}} \label{proofTL}

We now prove Lemma~\ref{lemmadecomp}, restated here:
\begin{lemma}
 A GPT is tomographically local if and only if one can decompose the identity process for every system $A$, denoted $\widetilde{\mathds{1}}_A$, as
\begin{equation}
\tikzfig{Diagrams/identityA}
\quad = \quad \sum_{ij} [\mathbf{M}_{\widetilde{\mathds{1}}_A}]_i^j
\tikzfig{Diagrams/measprepA},
\label{eq:identitydecomp2}
\end{equation}
where $\mathbf{M}_{{\widetilde{\mathds{1}}}_A}$ is the matrix inverse of the transition matrix $\mathbf{N}_{{\widetilde{\mathds{1}}}_A}$ of the identity process, that is,
\beq
\mathbf{M}_{{\widetilde{\mathds{1}}}_A}:= \mathbf{N}_{\widetilde{\mathds{1}}_A}^{-1}.
\eeq
\label{lem:identitydecomp2}
\end{lemma}


\begin{proof}
First, we prove that if a GPT satisfies tomographic locality, then the identity has a decomposition of the form in Eq.~\eqref{eq:identitydecomp2}. We do this by defining a particular process $f$ as a linear expansion into states and effects with the carefully chosen set of coefficients $[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j$, and then we prove that $f=\widetilde{\mathds{1}}_A$.

Take any minimal spanning set $\{ \widetilde{P}_i^A \}_i$ of GPT states and spanning set $\{ \widetilde{E}_j^A \}_j$ of GPT effects, and consider the transition matrix $\mathbf{N}_{\widetilde{\mathds{1}}_A}$ with entries given by
\beq
[\mathbf{N}_{\widetilde{\mathds{1}}_A}]_i^j:= \ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -0.75) {$\widetilde{P}_i^A$};
		\node [style=copoint] (1) at (0, 0.75) {$\widetilde{E}_j^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}.
\label{eq:gdef}
\eeq
%\includegraphics[width=0.13\textwidth]{Diagrams/fig1}.
Next, define $\mathbf{M}_{{\widetilde{\mathds{1}}}_A}^{-1} := \mathbf{N}_{\widetilde{\mathds{1}}_A}$, that is the inverse\footnote{The matrix inverse of $\mathbf{N}_{\widetilde{\mathds{1}}_A}$ exists, since the rows of $\mathbf{N}_{\widetilde{\mathds{1}}_A}$ are linearly independent, as we now prove by contradiction. Suppose there were a linear dependence, given by a nontrivial set of $\{a_i\}_i$ such that $\sum_i a_i [\mathbf{N}_{\widetilde{\mathds{1}}_A}]_i^j=0$. Then, one could multiply each side of Eq.~\eqref{eq:gdef} by $a_i$ and sum over $i$, obtaining
$0=\sum_ia_i[\mathbf{N}_{\widetilde{\mathds{1}}_A}]_i^j = \sum_i a_i \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -0.5) {$\widetilde{P}_i^A$};
		\node [style=copoint] (1) at (0, 0.5) {$\widetilde{E}_j^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}.
$
%\includegraphics[width=0.13\textwidth]{Diagrams/fig12}.
Since this holds for all effects $\widetilde{E}_j$ in a spanning set, it also holds for an arbitrary effect $\widetilde{E}$, so that
$0 = \sum_i a_i \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -0.5) {$\widetilde{P}_i^A$};
		\node [style=copoint] (1) at (0, 0.5) {$\widetilde{E}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}.
$
 But by the principle of tomography, this gives $\sum_i a_i \widetilde{P}_i^A = 0$, contradicting the claim that the set of GPT states were linearly independent.} $\mathbf{N}_{\widetilde{\mathds{1}}_A}$ with matrix elements  $[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j$ satisfying
\begin{equation} \label{invertgf}
\sum_j [\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j [\mathbf{N}_{{\widetilde{\mathds{1}}}_A}]_j^k = \delta_{ik},
\end{equation}
and define a process $f$ as
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1.5) {};
		\node [style=small box] (2) at (0, 0) {$f$};
		\node [style=none] (3) at (0, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (2);
		\draw [qWire](2) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ :=\sum_{ij} [\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -2) {};
		\node [style=copoint] (1) at (0, -1.125) {$\widetilde{E}_i^A$};
		\node [style=point] (2) at (0, 1.125) {$\widetilde{P}_j^A$};
		\node [style=none] (3) at (0, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0.center);
		\draw [qWire] (3.center) to (2);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
A priori, there is no reason why this process must be a physical GPT process; however, it turns out to be the identity process, as we will now show.
Consider the expression
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -1.5) {$\widetilde{P}_k^A$};
		\node [style=small box] (2) at (0, 0) {$f$};
		\node [style=copoint] (3) at (0, 1.5) {$\widetilde{E}_l^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3) to (2);
		\draw [qWire] (2) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
for some $\widetilde{P}_k^A$ and some $\widetilde{E}_l^A$ from the minimal spanning sets above. Substituting the expansion of $f$ followed by applying the definition of $\mathbf{M}_{{\widetilde{\mathds{1}}}_A}$ and $\mathbf{N}_{{\widetilde{\mathds{1}}}_A}$, one has
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -1.5) {$\widetilde{P}_k^A$};
		\node [style=small box] (2) at (0, 0) {$f$};
		\node [style=copoint] (3) at (0, 1.5) {$\widetilde{E}_l^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3) to (2);
		\draw [qWire] (2) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\ =
\sum_{ij}[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -2.5) {$\widetilde{P}_k^A$};
		\node [style=copoint] (1) at (0,-1.125) {$\widetilde{E}_i^A$};
		\node [style=point] (2) at (0, 1.125) {$\widetilde{P}_j^A$};
		\node [style=copoint] (3) at (0, 2.5) {$\widetilde{E}_l^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
		\draw [qWire] (3) to (2);
	\end{pgfonlayer}
\end{tikzpicture}
\ =\sum_{ij}[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j [\mathbf{N}_{{\widetilde{\mathds{1}}}_A}]_j^l [\mathbf{N}_{{\widetilde{\mathds{1}}}_A}]_k^i.
\eeq

But now it follows from Eq.~\eqref{invertgf} that
\begin{equation}
\sum_{ij} [\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j [\mathbf{N}_{{\widetilde{\mathds{1}}}_A}]_j^l [\mathbf{N}_{{\widetilde{\mathds{1}}}_A}]_k^i = \sum_i \delta_{il} [\mathbf{N}_{{\widetilde{\mathds{1}}}_A}]_k^i = [\mathbf{N}_{{\widetilde{\mathds{1}}}_A}]_k^l= \ \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -0.75) {$\widetilde{P}_k^A$};
		\node [style=copoint] (1) at (0, 0.75) {$\widetilde{E}_l^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
	\end{pgfonlayer}
\end{tikzpicture}.
\end{equation}
Hence, it holds that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -1.5) {$\widetilde{P}_k^A$};
		\node [style=small box] (2) at (0, 0) {$f$};
		\node [style=copoint] (3) at (0, 1.5) {$\widetilde{E}_l^A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3) to (2);
		\draw [qWire] (2) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\quad =\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -1.5) {$\widetilde{P}_k^A$};
		\node [style=copoint] (1) at (0, 1.5) {$\widetilde{E}_l^A$};
		\node [style=none] (2) at (-0.5, 0.5) {};
		\node [style=none] (3) at (0.5, 0.5) {};
		\node [style=none] (4) at (0.5, -0.5) {};
		\node [style=none] (5) at (-0.5, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
		\draw[thick gray dashed edge] (2.center) to (5.center);
		\draw[thick gray dashed edge] (5.center) to (4.center);
		\draw[thick gray dashed edge] (4.center) to (3.center);
		\draw[thick gray dashed edge] (3.center) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
  for all $\widetilde{P}_k^A$ and $\widetilde{E}_l^A$ in the minimal spanning sets above. By the fact that these sets span the state and effect spaces respectively, it follows that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -1.5) {$\widetilde{P}$};
		\node [style=small box] (2) at (0, 0) {$f$};
		\node [style=copoint] (3) at (0, 1.5) {$\widetilde{E}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3) to (2);
		\draw [qWire] (2) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\quad =\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, -1.5) {$\widetilde{P}$};
		\node [style=copoint] (1) at (0, 1.5) {$\widetilde{E}$};
		\node [style=none] (2) at (-0.5, 0.5) {};
		\node [style=none] (3) at (0.5, 0.5) {};
		\node [style=none] (4) at (0.5, -0.5) {};
		\node [style=none] (5) at (-0.5, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0);
		\draw[thick gray dashed edge] (2.center) to (5.center);
		\draw[thick gray dashed edge] (5.center) to (4.center);
		\draw[thick gray dashed edge] (4.center) to (3.center);
		\draw[thick gray dashed edge] (3.center) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
for all $\widetilde{P}$ and $\widetilde{E}$.
Now, in any GPT which satisfies tomographic locality, namely Eq.~\eqref{loctom}, two channels which give the same statistics on all local inputs and outputs are equal, and hence $f$ is in fact the identity transformation. Hence, the identity transformation has a linear expansion, of the form given by Eq.~\eqref{eq:identitydecomp2}, namely
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1.5) {};
		\node [style=small box] (2) at (0, 0) {$f$};
		\node [style=none] (3) at (0, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (2);
		\draw [qWire](2) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ =\ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -1.5) {};
		\node [style=none] (3) at (0, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\ \ =\sum_{ij} [\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^j
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -2) {};
		\node [style=copoint] (1) at (0, -1.125) {$\widetilde{E}_i^A$};
		\node [style=point] (2) at (0, 1.125) {$\widetilde{P}_j^A$};
		\node [style=none] (3) at (0, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (0.center);
		\draw [qWire] (3.center) to (2);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq

Next, we prove the converse: if the identity has a linear expansion as in Eq.~\eqref{eq:identitydecomp2} in a given GPT, then that GPT satisfies tomographic locality. To see this, consider two bipartite processes $\widetilde{T}$ and $\widetilde{T}'$ which give rise to the same statistics on all local inputs, so that
\beq
\forall P_1,P_2,E_1,E_2\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -0) {$\widetilde{T}$};
		\node [style=none] (1) at (-1.25, 0.5) {};
		\node [style=none] (2) at (1.25, 0.5) {};
		\node [style=none] (3) at (1.25, -0.5) {};
		\node [style=none] (4) at (0.75, 0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=copoint] (6) at (-0.75, 1.75) {$\widetilde{E}_1$};
		\node [style=copoint] (7) at (0.75, 1.75) {$\widetilde{E}_2$};
		\node [style=none] (8) at (-2, 2) {};
		\node [style=none] (9) at (2, 2) {};
		\node [style=none] (10) at (2, -2) {};
		\node [style=none] (11) at (-2, -2) {};
		\node [style=none] (13) at (0.75, -0.5) {};
		\node [style=none] (14) at (-0.75, -0.5) {};
		\node [style=point] (15) at (-0.75, -1.75) {$\widetilde{P}_1$};
		\node [style=point] (16) at (0.75, -1.75) {$\widetilde{P}_2$};
		\node [style=none] (17) at (-1.25, -0.5) {};
        \node [style=right label] (18) at (-0.75,-1) {$A$};
        \node [style=right label] (19) at (-0.75,.75) {$B$};
        \node [style=right label] (20) at (0.75,-1) {$C$};
        \node [style=right label] (21) at (0.75,.75) {$D$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (17.center) to cycle;
		\draw [qWire] (6) to (5.center);
		\draw [qWire] (7) to (4.center);
		\draw [qWire] (15) to (14.center);
		\draw [qWire] (16) to (13.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, -0) {$\widetilde{T}'$};
		\node [style=none] (1) at (-1.25, 0.5) {};
		\node [style=none] (2) at (1.25, 0.5) {};
		\node [style=none] (3) at (1.25, -0.5) {};
		\node [style=none] (4) at (0.75, 0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=copoint] (6) at (-0.75, 1.75) {$\widetilde{E}_1$};
		\node [style=copoint] (7) at (0.75, 1.75) {$\widetilde{E}_2$};
		\node [style=none] (8) at (-2, 2) {};
		\node [style=none] (9) at (2, 2) {};
		\node [style=none] (10) at (2, -2) {};
		\node [style=none] (11) at (-2, -2) {};
%		\node [style=none] (12) at (1.75, -1.75) {\tiny $\sim_p$};
		\node [style=none] (13) at (0.75, -0.5) {};
		\node [style=none] (14) at (-0.75, -0.5) {};
		\node [style=point] (15) at (-0.75, -1.75) {$\widetilde{P}_1$};
		\node [style=point] (16) at (0.75, -1.75) {$\widetilde{P}_2$};
		\node [style=none] (17) at (-1.25, -0.5) {};
        \node [style=right label] (18) at (-0.75,-1) {$A$};
        \node [style=right label] (19) at (-0.75,.75) {$B$};
        \node [style=right label] (20) at (0.75,-1) {$C$};
        \node [style=right label] (21) at (0.75,.75) {$D$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
%		\filldraw[fill=red!20,draw=red!40](8.center) to (9.center) to (10.center) to (11.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (17.center) to cycle;
		\draw [qWire] (6) to (5.center);
		\draw [qWire] (7) to (4.center);
		\draw [qWire] (15) to (14.center);
		\draw [qWire] (16) to (13.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\label{eq:samelocal}
\eeq

For any tester $\widetilde{\tau}$ of the appropriate type, one can write the probability generated by composing with $\widetilde{T}$ as
\beq \label{diagsplits1}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (-1.25, 0.5) {};
		\node [style=none] (2) at (1.25, 0.5) {};
		\node [style=none] (3) at (1.25, -0.5) {};
		\node [style=none] (4) at (0.75, 0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=none] (13) at (0.75, -0.5) {};
		\node [style=none] (14) at (-0.75, -0.5) {};
		\node [style=none] (17) at (-1.25, -0.5) {};
		\node [style=none] (22) at (0.75, -3.25) {};
		\node [style=none] (23) at (-0.75, -3.25) {};
		\node [style=none] (26) at (0.75, 3.25) {};
		\node [style=none] (27) at (-0.75, 3.25) {};
		\node [style=none] (30) at (1.5, 3.25) {};
		\node [style=none] (31) at (1.5, 3.75) {};
		\node [style=none] (32) at (-2, 3.25) {};
		\node [style=none] (33) at (-2, -3.25) {};
		\node [style=none] (34) at (1.5, -3.25) {};
		\node [style=none] (35) at (1.5, -3.75) {};
		\node [style=none] (36) at (-3, -3.75) {};
		\node [style=none] (37) at (-3, 3.75) {};
		\node [style=none] (38) at (-2.5, 0) {$\widetilde{\tau}$};
        \node [style=right label] (39) at (-0.75,-1.5) {$A$};
        \node [style=right label] (40) at (-0.75,1.25) {$B$};
        \node [style=right label] (41) at (0.75,-1.5) {$C$};
        \node [style=right label] (42) at (0.75,1.25) {$D$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (17.center);
		\draw (17.center) to (1.center);
		\draw (37.center) to (31.center);
		\draw (31.center) to (30.center);
		\draw (30.center) to (32.center);
		\draw (32.center) to (33.center);
		\draw (33.center) to (34.center);
		\draw (34.center) to (35.center);
		\draw (35.center) to (36.center);
		\draw (36.center) to (37.center);
		\draw[qWire] (27.center) to (5.center);
		\draw[qWire] (14.center) to (23.center);
		\draw[qWire] (26.center) to (4.center);
		\draw[qWire] (13.center) to (22.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad = \sum_{ijkli'j'k'l'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^{i'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_C}]_j^{j'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_B}]_k^{k'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_D}]_l^{l'}\ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (-1.5, 0.5) {};
		\node [style=none] (2) at (1.5, 0.5) {};
		\node [style=none] (3) at (1.5, -0.5) {};
		\node [style=none] (4) at (1, 0.5) {};
		\node [style=none] (5) at (-1, 0.5) {};
		\node [style=copoint] (6) at (-1, 1.25) {$\widetilde{E}_k^B$};
		\node [style=copoint] (7) at (1, 1.25) {$\widetilde{E}_l^D$};
		\node [style=none] (8) at (1, -0.5) {};
		\node [style=none] (9) at (-1, -0.5) {};
		\node [style=point] (10) at (-1, -1.25) {$\widetilde{P}_{i'}^A$};
		\node [style=point] (11) at (1, -1.25) {$\widetilde{P}_{j'}^C$};
		\node [style=none] (12) at (-1.5, -0.5) {};
		\node [style=none] (13) at (1, -4.5) {};
		\node [style=none] (14) at (-1, -4.5) {};
		\node [style=copoint] (15) at (-1, -3.5) {$\widetilde{E}_{i}^A$};
		\node [style=copoint] (16) at (1, -3.5) {$\widetilde{E}_{j}^C$};
		\node [style=none] (17) at (1, 4.5) {};
		\node [style=none] (18) at (-1, 4.5) {};
		\node [style=point] (19) at (-1, 3.5) {$\widetilde{P}_{k'}^B$};
		\node [style=point] (20) at (1, 3.5) {$\widetilde{P}_{l'}^D$};
		\node [style=none] (21) at (1.75, 4.5) {};
		\node [style=none] (22) at (1.75, 5) {};
		\node [style=none] (23) at (-2.5, 4.5) {};
		\node [style=none] (24) at (-2.5, -4.5) {};
		\node [style=none] (25) at (1.75, -4.5) {};
		\node [style=none] (26) at (1.75, -5) {};
		\node [style=none] (27) at (-3.5, -5) {};
		\node [style=none] (28) at (-3.5, 5) {};
		\node [style=none] (29) at (-3, -0) {$\widetilde{\tau}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (6) to (5.center);
		\draw [qWire] (7) to (4.center);
		\draw [qWire] (10) to (9.center);
		\draw [qWire] (11) to (8.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (12.center);
		\draw (12.center) to (1.center);
		\draw [qWire] (15) to (14.center);
		\draw [qWire] (16) to (13.center);
		\draw [qWire] (19) to (18.center);
		\draw [qWire] (20) to (17.center);
		\draw (28.center) to (22.center);
		\draw (22.center) to (21.center);
		\draw (21.center) to (23.center);
		\draw (23.center) to (24.center);
		\draw (24.center) to (25.center);
		\draw (25.center) to (26.center);
		\draw (26.center) to (27.center);
		\draw (27.center) to (28.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
simply by inserting the linear expansion of the identity on each system.
Similarly, one can write
\beq \label{diagsplits2}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{T}'$};
		\node [style=none] (1) at (-1.25, 0.5) {};
		\node [style=none] (2) at (1.25, 0.5) {};
		\node [style=none] (3) at (1.25, -0.5) {};
		\node [style=none] (4) at (0.75, 0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=none] (13) at (0.75, -0.5) {};
		\node [style=none] (14) at (-0.75, -0.5) {};
		\node [style=none] (17) at (-1.25, -0.5) {};
		\node [style=none] (22) at (0.75, -3.25) {};
		\node [style=none] (23) at (-0.75, -3.25) {};
		\node [style=none] (26) at (0.75, 3.25) {};
		\node [style=none] (27) at (-0.75, 3.25) {};
		\node [style=none] (30) at (1.5, 3.25) {};
		\node [style=none] (31) at (1.5, 3.75) {};
		\node [style=none] (32) at (-2, 3.25) {};
		\node [style=none] (33) at (-2, -3.25) {};
		\node [style=none] (34) at (1.5, -3.25) {};
		\node [style=none] (35) at (1.5, -3.75) {};
		\node [style=none] (36) at (-3, -3.75) {};
		\node [style=none] (37) at (-3, 3.75) {};
		\node [style=none] (38) at (-2.5, 0) {$\widetilde{\tau}$};
        \node [style=right label] (39) at (-0.75,-1.5) {$A$};
        \node [style=right label] (40) at (-0.75,1.25) {$B$};
        \node [style=right label] (41) at (0.75,-1.5) {$C$};
        \node [style=right label] (42) at (0.75,1.25) {$D$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (17.center);
		\draw (17.center) to (1.center);
		\draw (37.center) to (31.center);
		\draw (31.center) to (30.center);
		\draw (30.center) to (32.center);
		\draw (32.center) to (33.center);
		\draw (33.center) to (34.center);
		\draw (34.center) to (35.center);
		\draw (35.center) to (36.center);
		\draw (36.center) to (37.center);
		\draw[qWire] (27.center) to (5.center);
		\draw[qWire] (14.center) to (23.center);
		\draw[qWire] (26.center) to (4.center);
		\draw[qWire] (13.center) to (22.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad = \sum_{ijkli'j'k'l'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_i^{i'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_C}]_j^{j'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_B}]_k^{k'}
[\mathbf{M}_{{\widetilde{\mathds{1}}}_D}]_l^{l'}\ \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{T}'$};
		\node [style=none] (1) at (-1.5, 0.5) {};
		\node [style=none] (2) at (1.5, 0.5) {};
		\node [style=none] (3) at (1.5, -0.5) {};
		\node [style=none] (4) at (1, 0.5) {};
		\node [style=none] (5) at (-1, 0.5) {};
		\node [style=copoint] (6) at (-1, 1.25) {$\widetilde{E}_k^B$};
		\node [style=copoint] (7) at (1, 1.25) {$\widetilde{E}_l^D$};
		\node [style=none] (8) at (1, -0.5) {};
		\node [style=none] (9) at (-1, -0.5) {};
		\node [style=point] (10) at (-1, -1.25) {$\widetilde{P}_{i'}^A$};
		\node [style=point] (11) at (1, -1.25) {$\widetilde{P}_{j'}^C$};
		\node [style=none] (12) at (-1.5, -0.5) {};
		\node [style=none] (13) at (1, -4.5) {};
		\node [style=none] (14) at (-1, -4.5) {};
		\node [style=copoint] (15) at (-1, -3.5) {$\widetilde{E}_{i}^A$};
		\node [style=copoint] (16) at (1, -3.5) {$\widetilde{E}_{j}^C$};
		\node [style=none] (17) at (1, 4.5) {};
		\node [style=none] (18) at (-1, 4.5) {};
		\node [style=point] (19) at (-1, 3.5) {$\widetilde{P}_{k'}^B$};
		\node [style=point] (20) at (1, 3.5) {$\widetilde{P}_{l'}^D$};
		\node [style=none] (21) at (1.75, 4.5) {};
		\node [style=none] (22) at (1.75, 5) {};
		\node [style=none] (23) at (-2.5, 4.5) {};
		\node [style=none] (24) at (-2.5, -4.5) {};
		\node [style=none] (25) at (1.75, -4.5) {};
		\node [style=none] (26) at (1.75, -5) {};
		\node [style=none] (27) at (-3.5, -5) {};
		\node [style=none] (28) at (-3.5, 5) {};
		\node [style=none] (29) at (-3, -0) {$\widetilde{\tau}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (6) to (5.center);
		\draw [qWire] (7) to (4.center);
		\draw [qWire] (10) to (9.center);
		\draw [qWire] (11) to (8.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (12.center);
		\draw (12.center) to (1.center);
		\draw [qWire] (15) to (14.center);
		\draw [qWire] (16) to (13.center);
		\draw [qWire] (19) to (18.center);
		\draw [qWire] (20) to (17.center);
		\draw (28.center) to (22.center);
		\draw (22.center) to (21.center);
		\draw (21.center) to (23.center);
		\draw (23.center) to (24.center);
		\draw (24.center) to (25.center);
		\draw (25.center) to (26.center);
		\draw (26.center) to (27.center);
		\draw (27.center) to (28.center);
	\end{pgfonlayer}
\end{tikzpicture}
.
\eeq
Noting that the RHS of Eq.~\eqref{diagsplits1} splits into two disconnected diagrams, and the same holds for the RHS of Eq.~\eqref{diagsplits2}, it follows from Eq.~\eqref{eq:samelocal} that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{T}$};
		\node [style=none] (1) at (-1.25, 0.5) {};
		\node [style=none] (2) at (1.25, 0.5) {};
		\node [style=none] (3) at (1.25, -0.5) {};
		\node [style=none] (4) at (0.75, 0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=none] (13) at (0.75, -0.5) {};
		\node [style=none] (14) at (-0.75, -0.5) {};
		\node [style=none] (17) at (-1.25, -0.5) {};
		\node [style=none] (22) at (0.75, -1.5) {};
		\node [style=none] (23) at (-0.75, -1.5) {};
		\node [style=none] (26) at (0.75, 1.5) {};
		\node [style=none] (27) at (-0.75, 1.5) {};
		\node [style=none] (30) at (1.5, 1.5) {};
		\node [style=none] (31) at (1.5, 2) {};
		\node [style=none] (32) at (-2, 1.5) {};
		\node [style=none] (33) at (-2, -1.5) {};
		\node [style=none] (34) at (1.5, -1.5) {};
		\node [style=none] (35) at (1.5, -2) {};
		\node [style=none] (36) at (-3, -2) {};
		\node [style=none] (37) at (-3, 2) {};
		\node [style=none] (38) at (-2.5, 0) {$\widetilde{\tau}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (17.center);
		\draw (17.center) to (1.center);
		\draw (37.center) to (31.center);
		\draw (31.center) to (30.center);
		\draw (30.center) to (32.center);
		\draw (32.center) to (33.center);
		\draw (33.center) to (34.center);
		\draw (34.center) to (35.center);
		\draw (35.center) to (36.center);
		\draw (36.center) to (37.center);
		\draw [qWire] (27.center) to (5.center);
		\draw [qWire] (14.center) to (23.center);
		\draw [qWire] (26.center) to (4.center);
		\draw [qWire] (13.center) to (22.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$\widetilde{T}'$};
		\node [style=none] (1) at (-1.25, 0.5) {};
		\node [style=none] (2) at (1.25, 0.5) {};
		\node [style=none] (3) at (1.25, -0.5) {};
		\node [style=none] (4) at (0.75, 0.5) {};
		\node [style=none] (5) at (-0.75, 0.5) {};
		\node [style=none] (13) at (0.75, -0.5) {};
		\node [style=none] (14) at (-0.75, -0.5) {};
		\node [style=none] (17) at (-1.25, -0.5) {};
		\node [style=none] (22) at (0.75, -1.5) {};
		\node [style=none] (23) at (-0.75, -1.5) {};
		\node [style=none] (26) at (0.75, 1.5) {};
		\node [style=none] (27) at (-0.75, 1.5) {};
		\node [style=none] (30) at (1.5, 1.5) {};
		\node [style=none] (31) at (1.5, 2) {};
		\node [style=none] (32) at (-2, 1.5) {};
		\node [style=none] (33) at (-2, -1.5) {};
		\node [style=none] (34) at (1.5, -1.5) {};
		\node [style=none] (35) at (1.5, -2) {};
		\node [style=none] (36) at (-3, -2) {};
		\node [style=none] (37) at (-3, 2) {};
		\node [style=none] (38) at (-2.5, 0) {$\widetilde{\tau}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (17.center);
		\draw (17.center) to (1.center);
		\draw (37.center) to (31.center);
		\draw (31.center) to (30.center);
		\draw (30.center) to (32.center);
		\draw (32.center) to (33.center);
		\draw (33.center) to (34.center);
		\draw (34.center) to (35.center);
		\draw (35.center) to (36.center);
		\draw (36.center) to (37.center);
		\draw [qWire] (27.center) to (5.center);
		\draw [qWire] (14.center) to (23.center);
		\draw [qWire] (26.center) to (4.center);
		\draw [qWire] (13.center) to (22.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
Since this is true for any two processes satisfying Eq.~\eqref{eq:samelocal}, the principle of tomographic locality (Eq.~\eqref{loctom}) is satisfied.
\end{proof}

\section{Proof of Eqs.~\eqref{parallelcompr} and \eqref{nastycomp}} \blk \label{comprepn}


To prove Eq.~\eqref{parallelcompr}, one can decompose the four identities in the diagram and perform some simple manipulations of the resulting expression.
\allowdisplaybreaks
\begin{align}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1.5) {};
		\node [style=none] (1) at (0, 1.25) {};
		\node [style={small box}] (2) at (0, -0) {$\widetilde{T}$};
		\node [style={right label}] (3) at (0, 1) {$B$};
		\node [style=none] (4) at (0, -1.25) {};
		\node [style={right label}] (5) at (0, -1.25) {$A$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1.center) to (2);
		\draw [qWire] (2) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 1.5) {};
		\node [style=none] (1) at (0, 1.25) {};
		\node [style={small box}] (2) at (0, -0) {$\widetilde{T}'$};
		\node [style={right label}] (3) at (0, 1) {$D$};
		\node [style=none] (4) at (0, -1.25) {};
		\node [style={right label}] (5) at (0, -1.25) {$C$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1.center) to (2);
		\draw [qWire] (2) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad &=\qquad
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, 1.25) {$\widetilde{E}_k^B$};
		\node [style={small box}] (1) at (0, 0) {$\widetilde{T}$};
		\node [style=point] (2) at (0, -1.25) {$\widetilde{P}_j^A$};
		\node [style=none] (3) at (-2.5, -2.75) {$\displaystyle \sum_{ij}[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_{i}^{j}$};
		\node [style=none] (4) at (-2.5, 2) {$\displaystyle\sum_{kl}[\mathbf{M}_{{\widetilde{\mathds{1}}}_B}]_{k}^{l}$};
		\node [style=point] (5) at (0, 3.5) {$\widetilde{P}_l^B$};
		\node [style=copoint] (6) at (0, -3.75) {$\widetilde{E}_i^A$};
		\node [style=none] (7) at (0, -4.75) {};
		\node [style=none] (8) at (0, 4.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0) to (1);
		\draw [qWire] (1) to (2);
		\draw [qWire] (6) to (7.center);
		\draw [qWire] (5) to (8.center);
	\end{pgfonlayer}
\end{tikzpicture}
 \quad
 \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, 1.25) {$\widetilde{E}_{k'}^D$};
		\node [style={small box}] (1) at (0, 0) {$\widetilde{T}'$};
		\node [style=point] (2) at (0, -1.25) {$\widetilde{P}_{j'}^C$};
		\node [style=none] (3) at (-2.5, -2.75) {$\displaystyle \sum_{i'j'}[\mathbf{M}_{{\widetilde{\mathds{1}}}_C}]_{i'}^{j'}$};
		\node [style=none] (4) at (-2.5, 2) {$\displaystyle\sum_{k'l'}[\mathbf{M}_{{\widetilde{\mathds{1}}}_D}]_{k'}^{l'}$};
		\node [style=point] (5) at (0, 3.5) {$\widetilde{P}_{l'}^D$};
		\node [style=copoint] (6) at (0, -3.75) {$\widetilde{E}_{i'}^C$};
		\node [style=none] (7) at (0, -4.75) {};
		\node [style=none] (8) at (0, 4.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (0) to (1);
		\draw [qWire] (1) to (2);
		\draw [qWire] (6) to (7.center);
		\draw [qWire] (5) to (8.center);
	\end{pgfonlayer}
\end{tikzpicture}
\qquad = \qquad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-2, -2.25) {$\displaystyle \sum_{ij}[\mathbf{M}_{{\widetilde{\mathds{1}}}_A}]_{i}^{j}$};
		\node [style=none] (1) at (-2, 1.5) {$\displaystyle\sum_{kl}[\mathbf{M}_{{\widetilde{\mathds{1}}}_B}]_{k}^{l}$};
		\node [style=point] (2) at (0, 2.875) {$\widetilde{P}_{l}^B$};
		\node [style=copoint] (3) at (0, -3) {$\widetilde{E}_{i}^A$};
		\node [style=none] (4) at (0, -4) {};
		\node [style=none] (5) at (0, 3.75) {};
		\node [style=none] (6) at (0, -0) {$[\mathbf{N}_{\widetilde{T}}]_{j}^{k}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3) to (4.center);
		\draw [qWire] (2) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-2, -2.25) {$\displaystyle \sum_{i'j'}[\mathbf{M}_{{\widetilde{\mathds{1}}}_C}]_{i'}^{j'}$};
		\node [style=none] (1) at (-2, 1.5) {$\displaystyle\sum_{k'l'}[\mathbf{M}_{{\widetilde{\mathds{1}}}_D}]_{k'}^{l'}$};
		\node [style=point] (2) at (0, 2.875) {$\widetilde{P}_{l'}^D$};
		\node [style=copoint] (3) at (0, -3) {$\widetilde{E}_{i'}^C$};
		\node [style=none] (4) at (0, -4) {};
		\node [style=none] (5) at (0, 3.75) {};
		\node [style=none] (6) at (0, -0) {$[\mathbf{N}_{\widetilde{T}'}]_{j'}^{k'}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3) to (4.center);
		\draw [qWire] (2) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\\
& \nonumber \\
&=
\sum_{ii'll'} \left(\sum_{jj'kk'}  [\mathbf{M}_{\widetilde{\mathds{1}}_B}]_{k}^{l}[\mathbf{N}_{\widetilde{T}}]_j^k
[\mathbf{M}_{\widetilde{\mathds{1}}_A}]_{i}^{j}[\mathbf{M}_{\widetilde{\mathds{1}}_D}]_{k'}^{l'}[\mathbf{N}_{\widetilde{T}'}]_{j'}^{k'}[\mathbf{M}_{\widetilde{\mathds{1}}_C}]_{i'}^{j'}\right) \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l}^B$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i}^A$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l'}^D$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i'}^C$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
& \nonumber \\
\\ &=
\sum_{ii'll'} \left([\mathbf{M}_{\widetilde{\mathds{1}}_B}\circ\mathbf{N}_{\widetilde{T}}\circ\mathbf{M}_{\widetilde{\mathds{1}}_A}]_{i}^{l}[\mathbf{M}_{\widetilde{\mathds{1}}_D}\circ\mathbf{N}_{\widetilde{T}'}\circ\mathbf{M}_{\widetilde{\mathds{1}}_C}]_{i'}^{l'}\right) \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l}^B$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i}^A$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l'}^D$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i'}^C$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
& \nonumber \\
 \\ &=
\sum_{ii'll'} \left([(\mathbf{M}_{\widetilde{\mathds{1}}_B}\circ\mathbf{N}_{\widetilde{T}}\circ\mathbf{M}_{\widetilde{\mathds{1}}_A})\otimes(\mathbf{M}_{\widetilde{\mathds{1}}_D}\circ\mathbf{N}_{\widetilde{T}'}\circ\mathbf{M}_{\widetilde{\mathds{1}}_C})]_{ii'}^{ll'}\right) \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l}^B$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i}^A$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l'}^D$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i'}^C$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
& \nonumber \\
 \\ &=
\sum_{ii'll'} \left([\mathbf{M}_{\widetilde{T}}\otimes\mathbf{M}_{\widetilde{T}'}]_{ii'}^{ll'}\right) \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l}^B$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i}^A$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}\quad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (8) at (0, 1.25) {$\widetilde{P}_{l'}^D$};
		\node [style=copoint] (9) at (0, -1.25) {$\widetilde{E}_{i'}^C$};
		\node [style=none] (10) at (0, -2.25) {};
		\node [style=none] (11) at (0, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
.
\end{align}

To prove Eq.~\eqref{nastycomp}, one can insert four decompositions of the identity into the following diagram:
\begin{align}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, -0.875) {$\widetilde{T}$};
		\node [style=small box] (1) at (0, 0.875) {$\widetilde{T}'$};
		\node [style=none] (2) at (0, -2) {};
		\node [style=none] (3) at (0, 2) {};
		\node [style=right label] (4) at (0, -1.875) {$A$};
		\node [style=right label] (5) at (0, -0.125) {$B$};
		\node [style=right label] (6) at (0, 1.75) {$C$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (3.center) to (1);
		\draw [qWire] (1) to (0);
		\draw [qWire] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\quad &=\qquad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=point] (0) at (0, 3) {$\widetilde{P}_n^B$};
		\node [style={small box}] (1) at (0, 4.25) {$\widetilde{T}'$};
		\node [style=copoint] (2) at (0, 5.5) {$\widetilde{E}_o^C$};
		\node [style={small box}] (3) at (0, -4.25) {$\widetilde{T}$};
		\node [style=copoint] (4) at (0, -3) {$\widetilde{E}_k^B$};
		\node [style=point] (5) at (0, -5.5) {$\widetilde{P}_j^A$};
		\node [style=point] (6) at (0, -0.7499998) {$\widetilde{P}_l^B$};
		\node [style=copoint] (7) at (0, 0.7500005) {$\widetilde{E}_m^B$};
		\node [style=copoint] (8) at (0, -7.75) {$\widetilde{E}_i^A$};
		\node [style=point] (9) at (0, 7.75) {$\widetilde{P}_p^C$};
		\node [style=none] (10) at (0, 8.75) {};
		\node [style=none] (11) at (0, -8.750001) {};
		\node [style=none] (12) at (-2, -6.75) {$\displaystyle\sum_{ij}[\mathbf{M}_{\widetilde{\mathds{1}}_A}]_{i}^{j}$};
		\node [style=none] (13) at (-2, -2.25) {$\displaystyle\sum_{kl}[\mathbf{M}_{\widetilde{\mathds{1}}_B}]_{k}^{l}$};
		\node [style=none] (14) at (-2, 1.75) {$\displaystyle\sum_{mn}[\mathbf{M}_{\widetilde{\mathds{1}}_B}]_{m}^{n}$};
		\node [style=none] (15) at (-2, 6.25) {$\displaystyle\sum_{op}[\mathbf{M}_{\widetilde{\mathds{1}}_C}]_{o}^{p}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (2) to (1);
		\draw [qWire] (1) to (0);
		\draw [qWire] (4) to (3);
		\draw [qWire] (3) to (5);
		\draw [qWire] (6) to (7);
		\draw [qWire] (9) to (10.center);
		\draw [qWire] (8) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
\qquad =\qquad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (0) at (0, -5.75) {$\widetilde{E}_i^A$};
		\node [style=point] (1) at (0, 6) {$\widetilde{P}_p^C$};
		\node [style=none] (2) at (0, 7) {};
		\node [style=none] (3) at (0, -6.749999) {};
		\node [style=none] (4) at (-2, -5) {$\displaystyle\sum_{ij}[\mathbf{M}_{\widetilde{\mathds{1}}_A}]_{i}^{j}$};
		\node [style=none] (5) at (-2, -1.75) {$\displaystyle\sum_{kl}[\mathbf{M}_{\widetilde{\mathds{1}}_B}]_{k}^{l}$};
		\node [style=none] (6) at (-2, 1.5) {$\displaystyle\sum_{mn}[\mathbf{M}_{\widetilde{\mathds{1}}_B}]_{m}^{n}$};
		\node [style=none] (7) at (-2, 4.75) {$\displaystyle\sum_{op}[\mathbf{M}_{\widetilde{\mathds{1}}_C}]_{o}^{p}$};
		\node [style=none] (8) at (0, -0) {$[\mathbf{N}_{\widetilde{\mathds{1}}}]_l^m$};
		\node [style=none] (9) at (0, 3.25) {$[\mathbf{N}_{\widetilde{T}'}]_n^o$};
		\node [style=none] (10) at (0, -3.25) {$[\mathbf{N}_{\widetilde{T}}]_j^k$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (1) to (2.center);
		\draw [qWire] (0) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
\\ &=
\sum_{ip} [
\mathbf{M}_{\widetilde{\mathds{1}}_C}\circ
\mathbf{N}_{\widetilde{T}'}\circ
\mathbf{M}_{\widetilde{\mathds{1}}_B}\circ
\mathbf{N}_{\widetilde{\mathds{1}}_B}\circ
\mathbf{M}_{\widetilde{\mathds{1}}_B}\circ
\mathbf{N}_{\widetilde{T}}\circ
\mathbf{M}_{\widetilde{\mathds{1}}_A}
]_i^o
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (15) at (0, -1.125) {$\widetilde{E}_i^A$};
		\node [style=point] (16) at (0, 1.125) {$\widetilde{P}_p^C$};
		\node [style=none] (17) at (0, 2) {};
		\node [style=none] (18) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (16) to (17.center);
		\draw [qWire] (15) to (18.center);
	\end{pgfonlayer}
\end{tikzpicture}
\\ &=
\sum_{ip} [
\mathbf{M}_{\widetilde{T}'}\circ
\mathbf{N}_{\widetilde{\mathds{1}}_B}\circ
\mathbf{M}_{\widetilde{T}}
]_i^o
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=copoint] (15) at (0, -1.125) {$\widetilde{E}_i^A$};
		\node [style=point] (16) at (0,1.125) {$\widetilde{P}_p^C$};
		\node [style=none] (17) at (0, 2) {};
		\node [style=none] (18) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [qWire] (16) to (17.center);
		\draw [qWire] (15) to (18.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\end{align}

\section{Completing the proof of Theorem~\ref{thm:NCOMandOM}} \label{comptheproof}
The key argument required to establish Theorem~\ref{thm:NCOMandOM} was given just after the theorem itself, but we now complete the proof.

We now prove that $\xiNC :=   \widetilde{\xi} \circ \sim$ is indeed a valid ontological model of an operational theory if $\widetilde{\xi}$ is a valid ontological model of a GPT. To do so, we show that each of the three properties (enumerated in Definition~\ref{defnontop}) that $\xiNC$ should satisfy is implied by the corresponding property (enumerated in Definition~\ref{defnontgpt}) that $\widetilde{\xi}$ is assumed to satisfy by virtue of being an ontological model of a GPT.

First, recall that we assumed that all deterministic effects in the operational theory are operationally equivalent. Hence, the map $\sim$ will take any such deterministic effect to the unique deterministic effect in the GPT, which (by property 1 of Definition~\ref{defnontgpt}) must be represented by the unit vector $\bf{1}$. Hence, $\xiNC$ represents all deterministic effects in the operational theory appropriately, namely as the unit vector $\bf{1}$.

Second, recall that $\sim$ preserves the operational predictions of the operational theory; hence, the fact that (by property 2 of Definition~\ref{defnontgpt}) $\widetilde{\xi}$ preserves the operational predictions of the GPT implies that $\xiNC :=   \widetilde{\xi} \circ \sim$ preserves the operational predictions of the operational theory.

Third, recall that if, in the operational theory, $P_1$ is a procedure that is a mixture of $P_2$ and $P_3$ with weights $\omega$ and $1-\omega$, then it follows that under $\sim$, one has
\beq
\widetilde{P_1} = \omega \widetilde{P_2} + (1-\omega) \widetilde{P_3}.
\eeq
Hence, the fact that (by property 3 of Definition~\ref{defnontgpt}) the representations of these three processes under $\widetilde{\xi}$ satisfy
 \beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{P_1}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\widetilde{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{P_2}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\widetilde{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
\widetilde{P_3}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny $\widetilde{\xi}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=Red!20,draw=Red!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\eeq
implies that the representations of $P_1$, $P_2$, and $P_3$ satisfy
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
{P_1}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
{P_2}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0) {$
{P_3}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq

Hence $\xiNC$ satisfies all the properties of an ontological model of an operational theory.

Conversely, we prove that $\widetilde{\xi}:=\xiNC \circ C$ is a valid ontological model of a GPT if $\xiNC$ is a valid noncontextual ontological model of an operational theory. To do so, we show that each of the three properties (enumerated in Definition~\ref{defnontgpt}) that $\widetilde{\xi}$  should satisfy is implied by the corresponding property (enumerated in Definition~\ref{defnontop}) that $\xiNC$ is assumed to satisfy by virtue of being an ontological model of a GPT.

First, consider the unique deterministic effect in the GPT. Applying $C$ to this process yields one of the many deterministic effects in the operational theory. Because (by property 1 of Definition~\ref{defnontop}) $\xiNC$ maps every one of these to the unit vector $\bf{1}$, it follows that $\widetilde{\xi}:=\xiNC \circ C$ maps the unique deterministic effect to the unit vector $\bf{1}$.

Second, recall that the context of a process is irrelevant for the operational predictions it makes, and that consequently, the map $C$ preserves the operational predictions. Given that (by property 2 of Definition~\ref{defnontop}) $\xiNC$ preserves the operational predictions, $\widetilde{\xi}:=\xiNC \circ C$ also preserves the operational predictions.

Third, consider three processes $\widetilde{P}_1$, $\widetilde{P}_2$, and $\widetilde{P}_3$ such that $\widetilde{P}_1 = \omega \widetilde{P}_2 + (1-\omega)\widetilde{P}_3$ in the GPT. Under $C$, one has processes
$C(\widetilde{P}_1)=(\widetilde{P}_1,c_1)$, $C(\widetilde{P}_2)=(\widetilde{P}_1,c_2)$, and $C(\widetilde{P}_3)=(\widetilde{P}_1,c_3)$ in the operational theory, where $c_i$ are arbitrary contexts specified by the map $C$. The fact that $\widetilde{P}_1 = \omega \widetilde{P}_2 + (1-\omega)\widetilde{P}_3$ implies that $C(\widetilde{P}_1)$ is operationally equivalent to the effective procedure $P_{\rm mix}$ defined as the mixture of $C(\widetilde{P}_2)$
and $C(\widetilde{P}_3)$
with weights $\omega$ and $1-\omega$, respectively. ($C(\widetilde{P}_1)$ may not actually {\em be} this mixture, depending on its context $c_i$, which depends on one's choice of $C$.) By property 3 of Definition~\ref{defnontop}, $\xiNC$ must satisfy
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$
P_{mix}$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		%\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$
C(\widetilde{P_2})$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		%\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$
C(\widetilde{P_3})$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		%\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
But since $\xiNC$ is a noncontextual model and since $C(\widetilde{P}_1)$ is operationally equivalent to $P_{\rm mix}$, it follows that
\beq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$
C(\widetilde{P}_1)$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		%\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ = \omega\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$
C(\widetilde{P_2})$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		%\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ +(1-\omega)\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=small box] (0) at (0, 0) {$
C(\widetilde{P_3})$};
		\node [style=none] (1) at (-0.5, 0.5) {};
		\node [style=none] (2) at (0.5, 0.5) {};
		\node [style=none] (3) at (0.5, -0.5) {};
		\node [style=none] (4) at (-0.5, -0.5) {};
		\node [style=none] (5) at (0, 0.5) {};
		\node [style=none] (6) at (0, 1.5) {};
		\node [style=none] (7) at (0, -0.5) {};
		\node [style=none] (8) at (0, -1.5) {};
		\node [style=none] (13) at (1.25, -1.25) {\tiny ${\xiNC}$};
		\node [style=none] (14) at (1.5, -1.5) {};
		\node [style=none] (15) at (1.5, 1.5) {};
		\node [style=none] (16) at (-1.5, 1.5) {};
		\node [style=none] (17) at (-1.5, -1.5) {};
		\node [style=none] (18) at (0, 2) {};
		\node [style=none] (19) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
			\filldraw[fill=black!30!BurntOrange!30,draw=black!40!BurntOrange!40](14.center) to (15.center) to (16.center) to (17.center) to cycle;
		%\filldraw[fill=white,draw=black] (1.center) to (2.center) to (3.center) to (4.center) to cycle;
		\draw [qWire] (5.center) to (6.center);
		\draw [qWire] (8.center) to (7.center);
		\draw (18.center) to (6.center);
		\draw (8.center) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}.
\eeq
Hence we see that $\widetilde{\xi}:=\xiNC \circ C$ satisfies property 3 of Definition~\ref{defnontgpt}, as required.

\section{Proof of Theorem~\ref{mainthm}} \label{mainproof}

We now complete the proof of Theorem~\ref{mainthm}, as sketched in the main text.

\begin{proof}
Since we are assuming tomographic locality of the GPT, Corollary~\ref{cor:Tdecomp} immediately gives
\begin{equation}
\tikzfig{Diagrams/50_Proof2}\quad =\quad \tikzfig{Diagrams/51_Proof3}.
\end{equation}
Since $M$ is convex-linear, and the effect-state channels span the vector space, it can be uniquely extended to a linear map $\hat{M}$,  and so
\begin{equation}
\tikzfig{Diagrams/51_Proof3}\quad =\quad \tikzfig{Diagrams/51_Proof3RHS}.
\end{equation}
Now, using the linearity of $\hat{M}$, we have
\begin{equation}
\tikzfig{Diagrams/51_Proof3RHS}\quad =\ \sum_{ij} r_{ij}\ \tikzfig{Diagrams/54_Proof6hat}.
\end{equation}
Noting that in this diagram, $\hat{M}$ is only applied to objects in the domain of $M$, on which the two maps act identically (by the fact that the former is the linear extension of the latter), one has
\begin{equation}
\sum_{ij} r_{ij} \tikzfig{Diagrams/54_Proof6hat}\quad =\ \sum_{ij} r_{ij}\ \tikzfig{Diagrams/54_Proof6}\quad =\ \sum_{ij} r_{ij}\ \tikzfig{Diagrams/55_Proof7}.
\end{equation}
where the last step follows from the fact that $M$ is diagram-preserving.
In summary, we have shown that
\begin{equation}
\tikzfig{Diagrams/50_Proof2}\ =\ \sum_{ij} r_{ij} \ \tikzfig{Diagrams/55_Proof7},\label{eq:step1conc}
\end{equation}
as claimed in Eq.~\eqref{step1}.

Next, we analyse $M$ in the specific case of a state $\rho_i$:
\tikeq[.]{59_Proof11}
Since the DP map $M$ is linear and takes the vector space of GPT states to the vector space $\R^n$, and since both of these are in $\RL$, one can re-interpret the action of $M$ as a process $\chi$ within $\RL$:
\begin{equation}\tikzfig{Diagrams/59_Proof11}\quad =\quad \tikzfig{Diagrams/60_Proof12}.\label{eq:step1state}\end{equation}

Similarly, $M$ on effects $\sigma_j$ is linear and takes functionals on GPT states to functionals on $\R^n$; in other words, $M$ is the adjoint of a process $\phi$ within $\RL$:
\begin{equation}\tikzfig{Diagrams/65_Proof17}\quad =\quad \tikzfig{Diagrams/66_Proof18},\label{eq:step1effect}.\end{equation}
%as claimed in Eq.~\eqref{}.
Combining this with Eq.~\eqref{eq:step1conc}, we have
\begin{equation}
	\tikzfig{Diagrams/67_Proof19}\quad =\ \tikzfig{Diagrams/101}\quad =\quad \tikzfig{Diagrams/68_Proof20}.\label{eq:step2conc}
\end{equation}

All that remains is to show that $\chi_A$ and $\phi_A$ are inverses. Consider the special case that $\mathcal{E}$ is the identity, then Eq.~\eqref{eq:step2conc} becomes
\begin{equation}
	\tikzfig{Diagrams/70_Proof22}\quad =\quad \tikzfig{Diagrams/71_Proof23}.
\end{equation}
Since $M$ is diagram-preserving, it maps identity to identity, and so this becomes
\begin{equation}
	\tikzfig{Diagrams/69_Proof21}\quad =\quad \tikzfig{Diagrams/71_Proof23}.\label{eq:step3a}
\end{equation}

Now consider a state $\widetilde{P}$ followed by an effect $\widetilde{E}$. This gives a probability, and since $M$ is empirically adequate it must preserve this probability:
\begin{equation}
	\tikzfig{Diagrams/72_Proof24}\quad =\quad \tikzfig{Diagrams/73b_oneM},
\end{equation}
and since $M$ is diagram-preserving,
\begin{equation}
	\tikzfig{Diagrams/73b_oneM}\quad =\quad \tikzfig{Diagrams/73_Proof25}.
\end{equation}
Combining this with Eqs.~\eqref{eq:step1state} and \eqref{eq:step1effect} gives
\begin{equation}
	\tikzfig{Diagrams/72_Proof24} = \tikzfig{Diagrams/74_Proof26}.
\end{equation}
Since this holds for all $\widetilde{E}$ and $\widetilde{P}$, tomographic locality implies that
\begin{equation}
	\tikzfig{Diagrams/75_Proof27} = \tikzfig{Diagrams/76_Proof28}.
\end{equation}
Combining this with Eq.~\eqref{eq:step3a} gives that $\chi$ and $\phi$ are inverses of each other.
\end{proof}



\section{Proof of Proposition~\ref{prop:structureOM}} \label{propstructureOMproof}


\proof
Since the ontological model $\widetilde{\xi}$ satisfies the requirements of Proposition~\ref{qrepngptstruct} we immediately obtain Eqs.~\eqref{eq:ontchi} and \eqref{eq:ontchidiscard}.

We however also obtain additional constraints arising from the fact that the codomain of $\widetilde{\xi}$ is  $\mathbf{SubStoch}$ rather than $\mathbf{QuasiSubStoch}$. This additional constraint can be viewed as a set of positivity conditions as we will now explain.

 The notion of positivity we require is defined for linear maps between ordered vector spaces. Given two ordered vector spaces where the ordering is defined by a positive cone, $(V,V^+)$ and $(W,W^+)$, maps between these ordered vector spaces are  linear maps on the underlying vector spaces $L:V\to W$ and are said to be positive if and only if $L(V^+)\subseteq W^+$.

Now, the question is: what are the relevant ordered vector spaces which we want to consider here? In the GPT, $\widetilde{\Op}$, we can define an ordered vector space for each pair of systems $(A,B)$ as the vector space spanned by the transformations from $A$ to $B$, which we denote by $\mathsf{Span}[\widetilde{\Op}_A^B]$. The positive cone is defined by the vectors in this space which can be expressed as a positive linear combination of vectors in $\widetilde{\Op}_A^B$, that is, of the form $\sum_i r_i \widetilde{f}_i$ where $r_i \in \mathds{R}^+$ and $\widetilde{f}_i \in \widetilde{\Op}_A^B$. Similarly, in $\mathbf{SubStoch}$ we can defined an ordered vector space for each pair of systems $(\mathds{R}^\Lambda, \mathds{R}^{\Lambda'})$ as the vector space spanned by the substochastic maps from $\mathds{R}^\Lambda$ to $\mathds{R}^{\Lambda'}$, which we denote by $\mathsf{Span}[\mathbf{SubStoch}_\Lambda^{\Lambda'}]$. The positive cone is defined by the vectors in this space which can be expressed as a positive linear combination of vectors in $\mathbf{SubStoch}_\Lambda^{\Lambda'}$, that is, of the form $\sum_i r_i s_i$ where $r_i \in \mathds{R}^+$ and $s_i \in \mathbf{SubStoch}_\Lambda^{\Lambda'}$ .

Next, for a pair of GPT systems $(A,B)$ the action of the map $\widetilde{\xi}$ from $\widetilde{\Op}_A^B$ to $\mathbf{SubStoch}_{\Lambda_A}^{\Lambda_B}$ can be extended to a linear map from $\mathsf{Span}[\widetilde{\Op}_A^B]$ to $\mathsf{Span}[\mathbf{SubStoch}_{\Lambda_A}^{\Lambda_B}]$. Moreover, it is clear that this will be a positive linear map---in the sense that we defined above---as it maps the positive cone in $\mathsf{Span}[\widetilde{\Op}_A^B]$  into the positive cone in $\mathsf{Span}[\mathbf{SubStoch}_{\Lambda_A}^{\Lambda_B}]$.

This positivity condition is all fairly abstract so let us consider some more concrete consequences of this result. If, rather than considering transformations from one GPT system to another, we consider just the states of a single system $A$ then everything simplifies considerably. The vector space we consider in the domain is simply the vector space spanned by the GPT state space, and the positive cone is then just the standard cone of GPT states. The vector space we consider in the codomain is simply the vector space $\mathds{R}^{\Lambda_A}$ with positive cone given by the cone of unnormalised probability distributions. Moreover, the linearly extended action of $\widetilde{\xi}$ is nothing but the linear map $\chi_A$ so we find that $\chi_A$ must be a positive map in the sense defined above.

Similarly, if we consider the contravariant action of $\chi^{-1}_A$ on the space of GPT effects (that is, by composing the effect onto the outgoing wire of $\chi^{-1}_A$) then we arrive at a similar result. Here we find that the contravariant action of $\chi^{-1}_A$ is a positive linear map from the dual of the GPT vector space ordered by the effect cone to the dual of $\mathds{R}^{\Lambda_A}$ ordered by the cone of response functions.
\endproof


\end{document}












